## 2. لایه‌های معماری و نقش هر لایه

### Backend (Java)

```
┌─────────────────────────────────────────────────────────────┐
│                    Backend Architecture                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Controller Layer                        │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │   │
│  │  │ AuthController│ │OrderController│ │UserController│ │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Service Layer                           │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │   │
│  │  │ AuthService │ │OrderService │ │UserService  │ │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Repository Layer                        │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │   │
│  │  │ AuthRepository│ │OrderRepository│ │UserRepository│ │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Model Layer                             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │   │
│  │  │     User    │ │    Order    │ │ Restaurant  │ │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

- **Controller Layer:** دریافت درخواست‌های REST و ارسال به سرویس مناسب
- **Service Layer:** پیاده‌سازی منطق کسب‌وکار
- **Repository Layer:** ارتباط با پایگاه داده و مدیریت داده‌ها
- **Model Layer:** تعریف مدل‌های داده‌ای و انتیتی‌ها

### Frontend (JavaFX)

```
┌─────────────────────────────────────────────────────────────┐
│                   Frontend Architecture                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              UI Layer (FXML)                        │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │   │
│  │  │  Login.fxml │ │ Dashboard.fxml│ │ Order.fxml  │ │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Controller Layer                        │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │   │
│  │  │LoginController│ │DashboardController│ │OrderController│ │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Service Layer                           │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │   │
│  │  │ AuthService │ │OrderService │ │UserService  │ │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                              │                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Model Layer                             │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │   │
│  │  │     User    │ │    Order    │ │ Restaurant  │ │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘ │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

- **UI Layer:** نمایش و تعامل با کاربر (FXML)
- **Controller Layer:** مدیریت رویدادها و ارتباط با سرویس‌ها
- **Service Layer:** منطق سمت کلاینت و ارتباط با Backend
- **Model Layer:** مدل داده‌ای سمت کلاینت

--- 

## 3. معماری پایگاه داده

پایگاه داده سیستم به صورت رابطه‌ای (SQLite در توسعه و PostgreSQL در تولید) طراحی شده است و شامل جداول کلیدی زیر است:

- Users (کاربران)
- Restaurants (رستوران‌ها)
- Orders (سفارشات)
- Menu (منو)
- Items (آیتم‌های غذایی)
- Payments (پرداخت‌ها)
- Couriers (پیک‌ها)
- Favorites (علاقه‌مندی‌ها)
- Notifications (اعلان‌ها)
- Transactions (تراکنش‌ها)

### نمودار ساده ERD

```
Users ─────┬──── Orders ─────┬──── Payments
           │                │
           │                └──── Items
           │
           └──── Favorites

Restaurants ───── Menu ───── Items

Orders ───── Deliveries (Couriers)
```

---

## 4. معماری امنیت

- **احراز هویت JWT:** تمام درخواست‌های حساس با توکن JWT اعتبارسنجی می‌شوند.
- **رمزنگاری رمز عبور:** رمزهای عبور کاربران با الگوریتم قوی هش می‌شوند.
- **سطوح دسترسی:** نقش‌های کاربری (مشتری، فروشنده، مدیر، پیک) با سطوح دسترسی مجزا
- **بررسی ورودی:** اعتبارسنجی کامل ورودی‌ها در Backend و Frontend
- **محافظت در برابر حملات رایج:**
  - CSRF: استفاده از توکن و اعتبارسنجی
  - XSS: پاکسازی ورودی‌ها
  - SQL Injection: استفاده از ORM و Queryهای امن

--- 

## 5. معماری مقیاس‌پذیری و عملکرد

- **Thread Pool در Backend:** پردازش همزمان درخواست‌ها با ExecutorService
- **Queueهای سفارش و تحویل:** مدیریت صف سفارشات و تحویل برای جلوگیری از bottleneck
- **کَش‌گذاری:** استفاده از cache برای داده‌های پرمصرف (در صورت نیاز)
- **پروفایلینگ و مانیتورینگ:** ابزارهای مانیتورینگ و لاگ‌گیری برای تحلیل عملکرد

---

## 6. معماری استقرار و DevOps

- **Docker:** کانتینرسازی backend و frontend برای استقرار سریع
- **اسکریپت‌های استقرار:** اسکریپت‌های bash و batch برای راه‌اندازی و نگهداری
- **پایگاه داده migration:** اسکریپت‌های مهاجرت داده برای بروزرسانی schema
- **پشتیبان‌گیری و بازیابی:** اسکریپت‌های backup و restore
- **CI/CD:** امکان اتصال به ابزارهای CI برای build و تست خودکار

--- 

## 7. نمودارهای معماری و مثال‌های کد

### مثال کد Backend (Service Layer)
```java
// سرویس مدیریت سفارشات
// این کلاس منطق کسب‌وکار سفارش را پیاده‌سازی می‌کند
public class OrderService {
    // متد ثبت سفارش جدید
    public Order createOrder(CreateOrderRequest request) {
        // اعتبارسنجی ورودی
        if (request == null || request.getItems().isEmpty())
            throw new IllegalArgumentException("سفارش معتبر نیست");
        // ایجاد سفارش جدید
        Order order = new Order();
        // ... سایر منطق کسب‌وکار
        return order;
    }
}
```

### مثال کد Frontend (Controller Layer)
```java
// کنترلر صفحه ورود
public class LoginController {
    // متد ورود کاربر
    public void handleLogin(String phone, String password) {
        // اعتبارسنجی ورودی
        if (phone == null || password == null)
            throw new IllegalArgumentException("شماره یا رمز عبور وارد نشده است");
        // فراخوانی سرویس احراز هویت
        AuthService authService = new AuthService();
        boolean success = authService.login(phone, password);
        if (!success) {
            // نمایش پیام خطا به کاربر
            showError("ورود ناموفق بود");
        }
    }
}
```

---

## 8. توضیحات تکمیلی

- تمام بخش‌های سیستم دارای کامنت‌گذاری فارسی و مستندسازی کامل هستند.
- معماری سیستم به گونه‌ای طراحی شده که توسعه، نگهداری و مقیاس‌پذیری آن ساده باشد.
- برای هر نقش کاربری (مشتری، فروشنده، پیک، مدیر) مسیرهای جداگانه و سطوح دسترسی مجزا در نظر گرفته شده است.
- مستندات فنی و راهنمای توسعه‌دهندگان برای گسترش سیستم در دسترس است.

---

**آخرین بروزرسانی: تیر ۱۴۰۴ - تکمیل فاز ۳۹** 