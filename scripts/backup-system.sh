#!/bin/bash

# ================================================================
# Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¬Ø§Ù…Ø¹ Ø³ÛŒØ³ØªÙ… Ø³ÙØ§Ø±Ø´ ØºØ°Ø§
# Ø§ÛŒÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª ØªÙ…Ø§Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ØŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ… Ø±Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
# Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡: ØªÛŒÙ… ØªÙˆØ³Ø¹Ù‡
# ØªØ§Ø±ÛŒØ® Ø¢Ø®Ø±ÛŒÙ† ÙˆÛŒØ±Ø§ÛŒØ´: ØªÛŒØ± Û±Û´Û°Û´
# Ù†Ø³Ø®Ù‡: Û².Û° - Ø³ÛŒØ³ØªÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
# ================================================================

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ
set -e  # ØªÙˆÙ‚Ù Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ø®Ø·Ø§
set -u  # ØªÙˆÙ‚Ù Ø¯Ø± ØµÙˆØ±Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…ØªØºÛŒØ± ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡

# ================================================================
# Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø³ÛŒØ³ØªÙ…
# ================================================================
PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"  # Ù…Ø³ÛŒØ± Ø±ÛŒØ´Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡
BACKUP_ROOT="${PROJECT_ROOT}/backups"                           # Ù…Ø³ÛŒØ± Ø§ØµÙ„ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")                             # Ø¨Ø±Ú†Ø³Ø¨ Ø²Ù…Ø§Ù†ÛŒ
BACKUP_NAME="food_ordering_backup_${TIMESTAMP}"                # Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
BACKUP_DIR="${BACKUP_ROOT}/${BACKUP_NAME}"                     # Ù…Ø³ÛŒØ± Ú©Ø§Ù…Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
LOG_FILE="${BACKUP_DIR}/backup.log"                            # ÙØ§ÛŒÙ„ Ú¯Ø²Ø§Ø±Ø´
CONFIG_FILE="${PROJECT_ROOT}/scripts/backup.conf"              # ÙØ§ÛŒÙ„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
RETENTION_DAYS=30                                               # Ù…Ø¯Øª Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§ (Ø±ÙˆØ²)
COMPRESSION_LEVEL=9                                             # Ø³Ø·Ø­ ÙØ´Ø±Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ (Û±-Û¹)
DATABASE_FILE="food_ordering.db"                                # Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡

# ================================================================
# Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ± Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
# ================================================================
RED='\033[0;31m'      # Ù‚Ø±Ù…Ø² Ø¨Ø±Ø§ÛŒ Ø®Ø·Ø§Ù‡Ø§
GREEN='\033[0;32m'    # Ø³Ø¨Ø² Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª
YELLOW='\033[1;33m'   # Ø²Ø±Ø¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§
BLUE='\033[0;34m'     # Ø¢Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
NC='\033[0m'          # Ø¨Ø¯ÙˆÙ† Ø±Ù†Ú¯

# ================================================================
# ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯ÛŒ
# ================================================================
log_info() {
    echo -e "${BLUE}[INFO]${NC} $1" | tee -a "$LOG_FILE"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1" | tee -a "$LOG_FILE"
}

log_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1" | tee -a "$LOG_FILE"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1" | tee -a "$LOG_FILE"
}

# ================================================================
# ØªØ§Ø¨Ø¹ Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§
# ================================================================
check_prerequisites() {
    log_info "Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…..."
    
    # Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø³ØªÙˆØ±Ø§Øª Ø¶Ø±ÙˆØ±ÛŒ
    local required_commands=("tar" "gzip" "sqlite3" "rsync")
    
    for cmd in "${required_commands[@]}"; do
        if ! command -v "$cmd" &> /dev/null; then
            log_error "Ø¯Ø³ØªÙˆØ± '$cmd' ÛŒØ§ÙØª Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¢Ù† Ø±Ø§ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯."
            exit 1
        fi
    done
    
    # Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
    if [ ! -f "$PROJECT_ROOT/backend/$DATABASE_FILE" ]; then
        log_warning "ÙØ§ÛŒÙ„ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯: $PROJECT_ROOT/backend/$DATABASE_FILE"
    else
        log_success "ÙØ§ÛŒÙ„ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ ÛŒØ§ÙØª Ø´Ø¯"
    fi
    
    log_success "ØªÙ…Ø§Ù… Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§ Ù…ÙˆØ¬ÙˆØ¯ Ù‡Ø³ØªÙ†Ø¯"
}

# ================================================================
# ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
# ================================================================
create_backup_structure() {
    log_info "Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†..."
    
    # Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡ Ø§ØµÙ„ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§
    mkdir -p "$BACKUP_ROOT"
    
    # Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù† ÙØ¹Ù„ÛŒ
    mkdir -p "$BACKUP_DIR"
    
    # Ø§ÛŒØ¬Ø§Ø¯ Ø²ÛŒØ±Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
    mkdir -p "${BACKUP_DIR}/database"      # Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
    mkdir -p "${BACKUP_DIR}/code"          # Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú©Ø¯Ù‡Ø§
    mkdir -p "${BACKUP_DIR}/config"        # Ù¾Ø´ØªÛŒØ¨Ø§Ù† ØªÙ†Ø¸ÛŒÙ…Ø§Øª
    mkdir -p "${BACKUP_DIR}/logs"          # Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§
    mkdir -p "${BACKUP_DIR}/docs"          # Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø³ØªÙ†Ø¯Ø§Øª
    
    log_success "Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
}

# ================================================================
# ØªØ§Ø¨Ø¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
# ================================================================
backup_database() {
    log_info "Ø´Ø±ÙˆØ¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡..."
    
    local db_file="${PROJECT_ROOT}/backend/$DATABASE_FILE"
    local backup_db="${BACKUP_DIR}/database/food_ordering_backup.sql"
    
    if [ -f "$db_file" ]; then
        # Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ú©Ø§Ù…Ù„ Ø§Ø² Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ SQLite
        sqlite3 "$db_file" ".dump" > "$backup_db"
        
        # ÙØ´Ø±Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
        gzip -$COMPRESSION_LEVEL "$backup_db"
        
        log_success "Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯"
        log_info "Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†: $(du -h "${backup_db}.gz" | cut -f1)"
    else
        log_warning "ÙØ§ÛŒÙ„ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯: $db_file"
    fi
}

# ================================================================
# ØªØ§Ø¨Ø¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©Ø¯Ù‡Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡
# ================================================================
backup_code() {
    log_info "Ø´Ø±ÙˆØ¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©Ø¯Ù‡Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡..."
    
    # Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©Ø¯Ù‡Ø§ÛŒ Ø¨Ú©â€ŒØ§Ù†Ø¯
    if [ -d "${PROJECT_ROOT}/backend/src" ]; then
        tar -czf "${BACKUP_DIR}/code/backend_src.tar.gz" \
            -C "${PROJECT_ROOT}/backend" src/
        log_success "Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©Ø¯Ù‡Ø§ÛŒ Ø¨Ú©â€ŒØ§Ù†Ø¯ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯"
    fi
    
    # Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©Ø¯Ù‡Ø§ÛŒ ÙØ±Ø§Ù†Øªâ€ŒØ§Ù†Ø¯
    if [ -d "${PROJECT_ROOT}/frontend-javafx/src" ]; then
        tar -czf "${BACKUP_DIR}/code/frontend_src.tar.gz" \
            -C "${PROJECT_ROOT}/frontend-javafx" src/
        log_success "Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©Ø¯Ù‡Ø§ÛŒ ÙØ±Ø§Ù†Øªâ€ŒØ§Ù†Ø¯ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯"
    fi
    
    # Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Maven
    if [ -f "${PROJECT_ROOT}/backend/pom.xml" ]; then
        cp "${PROJECT_ROOT}/backend/pom.xml" "${BACKUP_DIR}/code/backend_pom.xml"
    fi
    
    if [ -f "${PROJECT_ROOT}/frontend-javafx/pom.xml" ]; then
        cp "${PROJECT_ROOT}/frontend-javafx/pom.xml" "${BACKUP_DIR}/code/frontend_pom.xml"
    fi
}

# ================================================================
# ØªØ§Ø¨Ø¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª
# ================================================================
backup_config() {
    log_info "Ø´Ø±ÙˆØ¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª..."
    
    # Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
    if [ -f "${PROJECT_ROOT}/backend/src/main/resources/application.properties" ]; then
        cp "${PROJECT_ROOT}/backend/src/main/resources/application.properties" \
           "${BACKUP_DIR}/config/application.properties"
    fi
    
    if [ -f "${PROJECT_ROOT}/backend/src/main/resources/application-production.properties" ]; then
        cp "${PROJECT_ROOT}/backend/src/main/resources/application-production.properties" \
           "${BACKUP_DIR}/config/application-production.properties"
    fi
    
    if [ -f "${PROJECT_ROOT}/backend/src/main/resources/hibernate.cfg.xml" ]; then
        cp "${PROJECT_ROOT}/backend/src/main/resources/hibernate.cfg.xml" \
           "${BACKUP_DIR}/config/hibernate.cfg.xml"
    fi
    
    # Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§
    if [ -d "${PROJECT_ROOT}/scripts" ]; then
        tar -czf "${BACKUP_DIR}/config/scripts.tar.gz" \
            -C "${PROJECT_ROOT}" scripts/
    fi
    
    log_success "Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯"
}

# ================================================================
# ØªØ§Ø¨Ø¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø³ØªÙ†Ø¯Ø§Øª
# ================================================================
backup_documentation() {
    log_info "Ø´Ø±ÙˆØ¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø³ØªÙ†Ø¯Ø§Øª..."
    
    # Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾ÙˆØ´Ù‡ Ù…Ø³ØªÙ†Ø¯Ø§Øª
    if [ -d "${PROJECT_ROOT}/docs" ]; then
        tar -czf "${BACKUP_DIR}/docs/documentation.tar.gz" \
            -C "${PROJECT_ROOT}" docs/
        log_success "Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯"
    else
        log_warning "Ù¾ÙˆØ´Ù‡ Ù…Ø³ØªÙ†Ø¯Ø§Øª ÛŒØ§ÙØª Ù†Ø´Ø¯"
    fi
    
    # Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² ÙØ§ÛŒÙ„ README
    if [ -f "${PROJECT_ROOT}/README.md" ]; then
        cp "${PROJECT_ROOT}/README.md" "${BACKUP_DIR}/docs/README.md"
    fi
}

# ================================================================
# ØªØ§Ø¨Ø¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§
# ================================================================
backup_logs() {
    log_info "Ø´Ø±ÙˆØ¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§..."
    
    # Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
    if [ -d "${PROJECT_ROOT}/backend/target/surefire-reports" ]; then
        tar -czf "${BACKUP_DIR}/logs/backend_test_reports.tar.gz" \
            -C "${PROJECT_ROOT}/backend/target" surefire-reports/
    fi
    
    if [ -d "${PROJECT_ROOT}/frontend-javafx/target/surefire-reports" ]; then
        tar -czf "${BACKUP_DIR}/logs/frontend_test_reports.tar.gz" \
            -C "${PROJECT_ROOT}/frontend-javafx/target" surefire-reports/
    fi
    
    # Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù¾ÙˆØ´Ø´ ØªØ³Øª
    if [ -d "${PROJECT_ROOT}/backend/target/site/jacoco" ]; then
        tar -czf "${BACKUP_DIR}/logs/backend_coverage_reports.tar.gz" \
            -C "${PROJECT_ROOT}/backend/target/site" jacoco/
    fi
    
    if [ -d "${PROJECT_ROOT}/frontend-javafx/target/site/jacoco" ]; then
        tar -czf "${BACKUP_DIR}/logs/frontend_coverage_reports.tar.gz" \
            -C "${PROJECT_ROOT}/frontend-javafx/target/site" jacoco/
    fi
    
    log_success "Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯"
}

# ================================================================
# ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†
# ================================================================
create_backup_info() {
    log_info "Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†..."
    
    local info_file="${BACKUP_DIR}/backup_info.txt"
    
    cat > "$info_file" << EOF
# ================================================================
# Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø³ÛŒØ³ØªÙ… Ø³ÙØ§Ø±Ø´ ØºØ°Ø§
# ================================================================
ØªØ§Ø±ÛŒØ® Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ: $(date)
Ù†Ø§Ù… Ù¾Ø´ØªÛŒØ¨Ø§Ù†: $BACKUP_NAME
Ù…Ø³ÛŒØ± Ù¾Ø´ØªÛŒØ¨Ø§Ù†: $BACKUP_DIR

# ================================================================
# Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…
# ================================================================
Ø³ÛŒØ³ØªÙ… Ø¹Ø§Ù…Ù„: $(uname -s)
Ù†Ø³Ø®Ù‡ Ù‡Ø³ØªÙ‡: $(uname -r)
Ù…Ø¹Ù…Ø§Ø±ÛŒ: $(uname -m)
Ú©Ø§Ø±Ø¨Ø±: $(whoami)
Ù…Ø³ÛŒØ± Ù¾Ø±ÙˆÚ˜Ù‡: $PROJECT_ROOT

# ================================================================
# Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
# ================================================================
$(find "$BACKUP_DIR" -type f -name "*.gz" -o -name "*.tar" | sort)

# ================================================================
# Ø­Ø¬Ù… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
# ================================================================
$(du -sh "$BACKUP_DIR"/*)

# ================================================================
# Ø®Ù„Ø§ØµÙ‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ
# ================================================================
- Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡: $(if [ -f "${BACKUP_DIR}/database/food_ordering_backup.sql.gz" ]; then echo "Ù…ÙˆÙÙ‚"; else echo "Ù†Ø§Ù…ÙˆÙÙ‚"; fi)
- Ú©Ø¯Ù‡Ø§ÛŒ Ø¨Ú©â€ŒØ§Ù†Ø¯: $(if [ -f "${BACKUP_DIR}/code/backend_src.tar.gz" ]; then echo "Ù…ÙˆÙÙ‚"; else echo "Ù†Ø§Ù…ÙˆÙÙ‚"; fi)
- Ú©Ø¯Ù‡Ø§ÛŒ ÙØ±Ø§Ù†Øªâ€ŒØ§Ù†Ø¯: $(if [ -f "${BACKUP_DIR}/code/frontend_src.tar.gz" ]; then echo "Ù…ÙˆÙÙ‚"; else echo "Ù†Ø§Ù…ÙˆÙÙ‚"; fi)
- ØªÙ†Ø¸ÛŒÙ…Ø§Øª: $(if [ -d "${BACKUP_DIR}/config" ]; then echo "Ù…ÙˆÙÙ‚"; else echo "Ù†Ø§Ù…ÙˆÙÙ‚"; fi)
- Ù…Ø³ØªÙ†Ø¯Ø§Øª: $(if [ -f "${BACKUP_DIR}/docs/documentation.tar.gz" ]; then echo "Ù…ÙˆÙÙ‚"; else echo "Ù†Ø§Ù…ÙˆÙÙ‚"; fi)
- Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§: $(if [ -d "${BACKUP_DIR}/logs" ]; then echo "Ù…ÙˆÙÙ‚"; else echo "Ù†Ø§Ù…ÙˆÙÙ‚"; fi)
EOF
    
    log_success "ÙØ§ÛŒÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
}

# ================================================================
# ØªØ§Ø¨Ø¹ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
# ================================================================
cleanup_old_backups() {
    log_info "Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ..."
    
    # Ø­Ø°Ù Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² RETENTION_DAYS Ø±ÙˆØ²
    find "$BACKUP_ROOT" -name "food_ordering_backup_*" -type d -mtime +$RETENTION_DAYS -exec rm -rf {} \;
    
    log_success "Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø´Ø¯Ù†Ø¯"
}

# ================================================================
# ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡ Ù†Ù‡Ø§ÛŒÛŒ
# ================================================================
show_summary() {
    log_info "Ø®Ù„Ø§ØµÙ‡ Ø¹Ù…Ù„ÛŒØ§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ:"
    echo "================================================================"
    echo "Ù†Ø§Ù… Ù¾Ø´ØªÛŒØ¨Ø§Ù†: $BACKUP_NAME"
    echo "Ù…Ø³ÛŒØ±: $BACKUP_DIR"
    echo "Ø­Ø¬Ù… Ú©Ù„: $(du -sh "$BACKUP_DIR" | cut -f1)"
    echo "ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: $(find "$BACKUP_DIR" -type f | wc -l)"
    echo "================================================================"
}

# ================================================================
# ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
# ================================================================
main() {
    echo "================================================================"
    echo "ðŸš€ Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¬Ø§Ù…Ø¹ Ø³ÛŒØ³ØªÙ… Ø³ÙØ§Ø±Ø´ ØºØ°Ø§"
    echo "ðŸ“… ØªØ§Ø±ÛŒØ®: $(date)"
    echo "================================================================"
    
    # Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§
    check_prerequisites
    
    # Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§
    create_backup_structure
    
    # Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø±Ø§Ø­Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ
    backup_database
    backup_code
    backup_config
    backup_documentation
    backup_logs
    
    # Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
    create_backup_info
    
    # Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
    cleanup_old_backups
    
    # Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡
    show_summary
    
    echo "================================================================"
    echo "âœ… Ø¹Ù…Ù„ÛŒØ§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯"
    echo "ðŸ“ Ù…Ø³ÛŒØ± Ù¾Ø´ØªÛŒØ¨Ø§Ù†: $BACKUP_DIR"
    echo "ðŸ“‹ Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„: $LOG_FILE"
    echo "================================================================"
}

# ================================================================
# Ø§Ø¬Ø±Ø§ÛŒ ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
# ================================================================
main "$@" 