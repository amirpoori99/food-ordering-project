<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ServerApp.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Food Ordering Backend</a> &gt; <a href="index.source.html" class="el_package">com.myapp</a> &gt; <span class="el_source">ServerApp.java</span></div><h1>ServerApp.java</h1><pre class="source lang-java linenums">package com.myapp;

import com.myapp.auth.AuthRepository;
import com.myapp.auth.AuthService;
import com.myapp.auth.AuthResult;
import com.myapp.auth.AuthMiddleware;
import com.myapp.restaurant.RestaurantRepository;
import com.myapp.restaurant.RestaurantController;
import com.myapp.admin.AdminRepository;
import com.myapp.admin.AdminService;
import com.myapp.admin.AdminController;
import com.myapp.order.OrderRepository;
import com.myapp.order.OrderController;
import com.myapp.payment.PaymentRepository;
import com.myapp.payment.PaymentController;
import com.myapp.payment.WalletController;
import com.myapp.payment.WalletService;
import com.myapp.payment.TransactionController;
import com.myapp.courier.DeliveryRepository;
import com.myapp.courier.DeliveryController;
import com.myapp.item.ItemController;
import com.myapp.menu.MenuController;
import com.myapp.vendor.VendorController;
import com.myapp.favorites.FavoritesRepository;
import com.myapp.favorites.FavoritesService;
import com.myapp.favorites.FavoritesController;
import com.myapp.notification.NotificationRepository;
import com.myapp.notification.NotificationService;
import com.myapp.notification.NotificationController;
import com.myapp.common.utils.DatabaseUtil;
import com.myapp.common.utils.PasswordUtil;
import com.myapp.common.models.User;
import com.myapp.common.constants.ApplicationConstants;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.JsonNode;
import com.sun.net.httpserver.HttpServer;
import com.sun.net.httpserver.HttpHandler;
import com.sun.net.httpserver.HttpExchange;

import java.io.IOException;
import java.io.OutputStream;
import java.net.InetSocketAddress;
import java.util.concurrent.Executors;

/**
 * Ú©Ù„Ø§Ø³ Ø§ØµÙ„ÛŒ Ø³Ø±ÙˆØ± Ù¾Ø±ÙˆÚ˜Ù‡ Ø³ÛŒØ³ØªÙ… Ø³ÙØ§Ø±Ø´ ØºØ°Ø§
 * Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù…Ø³Ø¦ÙˆÙ„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ Ø³Ø±ÙˆØ± backend Ø§Ø³Øª
 * Ø´Ø§Ù…Ù„ ØªÙ…Ø§Ù… endpoint Ù‡Ø§ÛŒ REST API Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
 */
<span class="nc" id="L50">public class ServerApp {</span>
    
    // ØªØ¹Ø±ÛŒÙ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ static Ø¨Ø±Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ Ùˆ Ú©Ù†ØªØ±Ù„Ø±Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
    private static AuthService authService;                    // Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
    private static AdminController adminController;            // Ú©Ù†ØªØ±Ù„Ø± Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª
    private static RestaurantController restaurantController;  // Ú©Ù†ØªØ±Ù„Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§
    private static OrderController orderController;            // Ú©Ù†ØªØ±Ù„Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´Ø§Øª
    private static PaymentController paymentController;        // Ú©Ù†ØªØ±Ù„Ø± Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø®Øª
    private static WalletController walletController;          // Ú©Ù†ØªØ±Ù„Ø± Ú©ÛŒÙ Ù¾ÙˆÙ„
    private static TransactionController transactionController; // Ú©Ù†ØªØ±Ù„Ø± ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
    private static DeliveryController deliveryController;      // Ú©Ù†ØªØ±Ù„Ø± Ø³ÛŒØ³ØªÙ… ØªØ­ÙˆÛŒÙ„
    private static ItemController itemController;              // Ú©Ù†ØªØ±Ù„Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§
    private static MenuController menuController;              // Ú©Ù†ØªØ±Ù„Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù†Ùˆ
    private static VendorController vendorController;          // Ú©Ù†ØªØ±Ù„Ø± Ø³ÛŒØ³ØªÙ… ÙØ±ÙˆØ´Ù†Ø¯Ú¯Ø§Ù†
    private static FavoritesController favoritesController;    // Ú©Ù†ØªØ±Ù„Ø± Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
    private static NotificationController notificationController; // Ú©Ù†ØªØ±Ù„Ø± Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§
    
    /**
     * Ù…ØªØ¯ Ø§ØµÙ„ÛŒ main Ú©Ù‡ Ù†Ù‚Ø·Ù‡ Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§Ø³Øª
     * Ù…Ø³Ø¦ÙˆÙ„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ØŒ Ú©Ù†ØªØ±Ù„Ø±Ù‡Ø§ Ùˆ Ø³Ø±ÙˆØ± HTTP
     */
    public static void main(String[] args) throws IOException {
        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø´Ø±ÙˆØ¹ Ø³Ø±ÙˆØ±
<span class="nc" id="L73">        System.out.println(&quot;ğŸš€ Starting Food Ordering Backend Server...&quot;);</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 1: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Repository Ù‡Ø§ (Ù„Ø§ÛŒÙ‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡)
<span class="nc" id="L76">        AuthRepository authRepo = new AuthRepository();                   // Repository Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</span>
<span class="nc" id="L77">        authService = new AuthService(authRepo);                          // Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</span>
        
<span class="nc" id="L79">        RestaurantRepository restaurantRepo = new RestaurantRepository(); // Repository Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§</span>
<span class="nc" id="L80">        OrderRepository orderRepo = new OrderRepository();               // Repository Ø³ÙØ§Ø±Ø´Ø§Øª</span>
<span class="nc" id="L81">        PaymentRepository paymentRepo = new PaymentRepository();         // Repository Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§</span>
<span class="nc" id="L82">        DeliveryRepository deliveryRepo = new DeliveryRepository();       // Repository ØªØ­ÙˆÛŒÙ„â€ŒÙ‡Ø§</span>
<span class="nc" id="L83">        FavoritesRepository favoritesRepo = new FavoritesRepository();   // Repository Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</span>
<span class="nc" id="L84">        NotificationRepository notificationRepo = new NotificationRepository(); // Repository Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 2: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª (Admin services)
<span class="nc" id="L87">        AdminRepository adminRepo = new AdminRepository();</span>
        // Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³ Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø§ ØªÙ…Ø§Ù… Repository Ù‡Ø§ÛŒ Ù„Ø§Ø²Ù…
<span class="nc" id="L89">        AdminService adminService = new AdminService(adminRepo, authRepo, restaurantRepo, orderRepo, paymentRepo, deliveryRepo);</span>
<span class="nc" id="L90">        adminController = new AdminController(adminService);             // Ú©Ù†ØªØ±Ù„Ø± Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 3: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆÛŒØ³ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
<span class="nc" id="L93">        FavoritesService favoritesService = new FavoritesService(favoritesRepo, authRepo, restaurantRepo);</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 4: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆÛŒØ³ Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§
<span class="nc" id="L96">        NotificationService notificationService = new NotificationService(notificationRepo, authRepo);</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 5: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆÛŒØ³ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„Ø± ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§
<span class="nc" id="L99">        WalletService walletService = new WalletService(paymentRepo, authRepo);</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 6: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø§ÛŒØ± Ú©Ù†ØªØ±Ù„Ø±Ù‡Ø§
<span class="nc" id="L102">        restaurantController = new RestaurantController();               // Ú©Ù†ØªØ±Ù„Ø± Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§</span>
<span class="nc" id="L103">        orderController = new OrderController();                        // Ú©Ù†ØªØ±Ù„Ø± Ø³ÙØ§Ø±Ø´Ø§Øª</span>
<span class="nc" id="L104">        paymentController = new PaymentController();                    // Ú©Ù†ØªØ±Ù„Ø± Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§</span>
<span class="nc" id="L105">        walletController = new WalletController();                      // Ú©Ù†ØªØ±Ù„Ø± Ú©ÛŒÙ Ù¾ÙˆÙ„</span>
<span class="nc" id="L106">        transactionController = new TransactionController(walletService, paymentRepo); // Ú©Ù†ØªØ±Ù„Ø± ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</span>
<span class="nc" id="L107">        deliveryController = new DeliveryController();                  // Ú©Ù†ØªØ±Ù„Ø± ØªØ­ÙˆÛŒÙ„â€ŒÙ‡Ø§</span>
<span class="nc" id="L108">        itemController = new ItemController();                          // Ú©Ù†ØªØ±Ù„Ø± Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§</span>
<span class="nc" id="L109">        menuController = new MenuController();                          // Ú©Ù†ØªØ±Ù„Ø± Ù…Ù†Ùˆ</span>
<span class="nc" id="L110">        vendorController = new VendorController();                      // Ú©Ù†ØªØ±Ù„Ø± ÙØ±ÙˆØ´Ù†Ø¯Ú¯Ø§Ù†</span>
<span class="nc" id="L111">        favoritesController = new FavoritesController(favoritesService); // Ú©Ù†ØªØ±Ù„Ø± Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</span>
<span class="nc" id="L112">        notificationController = new NotificationController(notificationService); // Ú©Ù†ØªØ±Ù„Ø± Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 7: ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
<span class="nc" id="L115">        System.out.println(&quot;Testing Hibernate connection...&quot;);</span>
        try {
            // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø§Ø² Ø·Ø±ÛŒÙ‚ Hibernate
<span class="nc" id="L118">            DatabaseUtil.getSessionFactory();</span>
<span class="nc" id="L119">            System.out.println(&quot;âœ… Database connection successful!&quot;);</span>
<span class="nc" id="L120">        } catch (Exception e) {</span>
            // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ØŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ùˆ Ø®Ø±ÙˆØ¬ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡
<span class="nc" id="L122">            System.err.println(&quot;âŒ Database connection failed: &quot; + e.getMessage());</span>
<span class="nc" id="L123">            e.printStackTrace();</span>
<span class="nc" id="L124">            return; // Ø®Ø±ÙˆØ¬ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³</span>
<span class="nc" id="L125">        }</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 8: Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆØ± HTTP Ø±ÙˆÛŒ Ù¾ÙˆØ±Øª Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡
<span class="nc" id="L128">        int serverPort = Integer.parseInt(System.getProperty(&quot;server.port&quot;, &quot;8081&quot;));</span>
<span class="nc" id="L129">        HttpServer server = HttpServer.create(new InetSocketAddress(serverPort), 0);</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 9: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† endpoint Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ (Authentication &amp; Health)
<span class="nc" id="L132">        server.createContext(&quot;/api/test&quot;, new TestHandler());              // endpoint ØªØ³Øª</span>
<span class="nc" id="L133">        server.createContext(&quot;/api/auth/register&quot;, new RegisterHandler()); // Ø«Ø¨Øª Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</span>
<span class="nc" id="L134">        server.createContext(&quot;/api/auth/login&quot;, new LoginHandler());       // ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</span>
<span class="nc" id="L135">        server.createContext(&quot;/api/auth/refresh&quot;, new RefreshTokenHandler()); // ØªØ¬Ø¯ÛŒØ¯ token</span>
<span class="nc" id="L136">        server.createContext(&quot;/api/auth/validate&quot;, new ValidateTokenHandler()); // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ token</span>
<span class="nc" id="L137">        server.createContext(&quot;/api/auth/logout&quot;, new LogoutHandler());     // Ø®Ø±ÙˆØ¬ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</span>
<span class="nc" id="L138">        server.createContext(&quot;/health&quot;, new HealthHandler());              // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆØ±</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 10: Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† endpoint Ù‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„Ø±Ù‡Ø§ (Business Logic)
<span class="nc" id="L141">        server.createContext(&quot;/api/admin/&quot;, adminController);              // endpoint Ù‡Ø§ÛŒ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</span>
<span class="nc" id="L142">        server.createContext(&quot;/api/restaurants/&quot;, restaurantController);   // endpoint Ù‡Ø§ÛŒ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§</span>
<span class="nc" id="L143">        server.createContext(&quot;/api/orders/&quot;, orderController);             // endpoint Ù‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´Ø§Øª</span>
<span class="nc" id="L144">        server.createContext(&quot;/api/payments/&quot;, paymentController);         // endpoint Ù‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª</span>
<span class="nc" id="L145">        server.createContext(&quot;/api/wallet/&quot;, walletController);            // endpoint Ù‡Ø§ÛŒ Ú©ÛŒÙ Ù¾ÙˆÙ„</span>
<span class="nc" id="L146">        server.createContext(&quot;/api/transactions/&quot;, transactionController); // endpoint Ù‡Ø§ÛŒ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</span>
<span class="nc" id="L147">        server.createContext(&quot;/api/deliveries/&quot;, deliveryController);      // endpoint Ù‡Ø§ÛŒ ØªØ­ÙˆÛŒÙ„</span>
<span class="nc" id="L148">        server.createContext(&quot;/api/items/&quot;, itemController);               // endpoint Ù‡Ø§ÛŒ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§</span>
<span class="nc" id="L149">        server.createContext(&quot;/api/menu/&quot;, menuController);                // endpoint Ù‡Ø§ÛŒ Ù…Ù†Ùˆ</span>
<span class="nc" id="L150">        server.createContext(&quot;/api/vendors/&quot;, vendorController);           // endpoint Ù‡Ø§ÛŒ ÙØ±ÙˆØ´Ù†Ø¯Ú¯Ø§Ù†</span>
<span class="nc" id="L151">        server.createContext(&quot;/api/favorites/&quot;, favoritesController);      // endpoint Ù‡Ø§ÛŒ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</span>
<span class="nc" id="L152">        server.createContext(&quot;/api/notifications/&quot;, notificationController); // endpoint Ù‡Ø§ÛŒ Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§</span>
<span class="nc" id="L153">        server.createContext(&quot;/api/notification/&quot;, notificationController);  // endpoint Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 11: ØªÙ†Ø¸ÛŒÙ… Thread Pool Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
<span class="nc" id="L156">        server.setExecutor(Executors.newFixedThreadPool(10)); // Ø­Ø¯Ø§Ú©Ø«Ø± 10 thread Ù‡Ù…Ø²Ù…Ø§Ù†</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 12: Ø´Ø±ÙˆØ¹ Ø³Ø±ÙˆØ± Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
<span class="nc" id="L159">        server.start();</span>
<span class="nc" id="L160">        System.out.println(&quot;ğŸš€ Server started on http://localhost:&quot; + serverPort);</span>
<span class="nc" id="L161">        System.out.println(&quot;ğŸ“‹ Available endpoints:&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… endpoint Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†
<span class="nc" id="L164">        System.out.println(&quot;   GET  /health - Health check&quot;);</span>
<span class="nc" id="L165">        System.out.println(&quot;   GET  /api/test - Simple test&quot;);</span>
<span class="nc" id="L166">        System.out.println(&quot;   POST /api/auth/register - User registration&quot;);</span>
<span class="nc" id="L167">        System.out.println(&quot;   POST /api/auth/login - User login (with JWT tokens)&quot;);</span>
<span class="nc" id="L168">        System.out.println(&quot;   POST /api/auth/refresh - Refresh access token&quot;);</span>
<span class="nc" id="L169">        System.out.println(&quot;   GET  /api/auth/validate - Validate access token&quot;);</span>
<span class="nc" id="L170">        System.out.println(&quot;   POST /api/auth/logout - User logout&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª (18+ endpoint)
<span class="nc" id="L173">        System.out.println(&quot;   ğŸ”§ Admin Dashboard (18+ endpoints):&quot;);</span>
<span class="nc" id="L174">        System.out.println(&quot;   GET  /api/admin/dashboard - Admin statistics&quot;);</span>
<span class="nc" id="L175">        System.out.println(&quot;   GET  /api/admin/users - User management&quot;);</span>
<span class="nc" id="L176">        System.out.println(&quot;   GET  /api/admin/restaurants - Restaurant management&quot;);</span>
<span class="nc" id="L177">        System.out.println(&quot;   GET  /api/admin/orders - Order management&quot;);</span>
<span class="nc" id="L178">        System.out.println(&quot;   GET  /api/admin/transactions - Transaction monitoring&quot;);</span>
<span class="nc" id="L179">        System.out.println(&quot;   GET  /api/admin/deliveries - Delivery tracking&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø³ØªÙˆØ±Ø§Ù† (16+ endpoint)
<span class="nc" id="L182">        System.out.println(&quot;   ğŸª Restaurant Management (16+ endpoints):&quot;);</span>
<span class="nc" id="L183">        System.out.println(&quot;   GET  /api/restaurants/ - All restaurants&quot;);</span>
<span class="nc" id="L184">        System.out.println(&quot;   POST /api/restaurants/ - Create restaurant&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´Ø§Øª (20+ endpoint)
<span class="nc" id="L187">        System.out.println(&quot;   ğŸ›’ Order Management (20+ endpoints):&quot;);</span>
<span class="nc" id="L188">        System.out.println(&quot;   GET  /api/orders/ - All orders&quot;);</span>
<span class="nc" id="L189">        System.out.println(&quot;   POST /api/orders/ - Create order&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø®Øª (8+ endpoint)
<span class="nc" id="L192">        System.out.println(&quot;   ğŸ’³ Payment System (8+ endpoints):&quot;);</span>
<span class="nc" id="L193">        System.out.println(&quot;   GET  /api/payments/ - Payment history&quot;);</span>
<span class="nc" id="L194">        System.out.println(&quot;   POST /api/payments/ - Process payment&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ú©ÛŒÙ Ù¾ÙˆÙ„ (6+ endpoint)
<span class="nc" id="L197">        System.out.println(&quot;   ğŸ’° Wallet System (6+ endpoints):&quot;);</span>
<span class="nc" id="L198">        System.out.println(&quot;   GET  /api/wallet/ - Wallet balance&quot;);</span>
<span class="nc" id="L199">        System.out.println(&quot;   POST /api/wallet/ - Add funds&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ (5+ endpoint)
<span class="nc" id="L202">        System.out.println(&quot;   ğŸ’¸ Transaction System (5+ endpoints):&quot;);</span>
<span class="nc" id="L203">        System.out.println(&quot;   GET  /api/transactions/wallet/history - Transaction history&quot;);</span>
<span class="nc" id="L204">        System.out.println(&quot;   GET  /api/transactions/wallet/statistics - Wallet statistics&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… ØªØ­ÙˆÛŒÙ„ (16+ endpoint)
<span class="nc" id="L207">        System.out.println(&quot;   ğŸšš Delivery System (16+ endpoints):&quot;);</span>
<span class="nc" id="L208">        System.out.println(&quot;   GET  /api/deliveries/ - All deliveries&quot;);</span>
<span class="nc" id="L209">        System.out.println(&quot;   POST /api/deliveries/ - Create delivery&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ (13+ endpoint)
<span class="nc" id="L212">        System.out.println(&quot;   ğŸ” Item Management (13+ endpoints):&quot;);</span>
<span class="nc" id="L213">        System.out.println(&quot;   GET  /api/items/ - All items&quot;);</span>
<span class="nc" id="L214">        System.out.println(&quot;   POST /api/items/ - Create item&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù†Ùˆ (6+ endpoint)
<span class="nc" id="L217">        System.out.println(&quot;   ğŸ“‹ Menu Management (6+ endpoints):&quot;);</span>
<span class="nc" id="L218">        System.out.println(&quot;   GET  /api/menu/ - Menu items&quot;);</span>
<span class="nc" id="L219">        System.out.println(&quot;   POST /api/menu/ - Add menu item&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… ÙØ±ÙˆØ´Ù†Ø¯Ú¯Ø§Ù† (10+ endpoint)
<span class="nc" id="L222">        System.out.println(&quot;   ğŸ¬ Vendor System (10+ endpoints):&quot;);</span>
<span class="nc" id="L223">        System.out.println(&quot;   GET  /api/vendors/ - All vendors&quot;);</span>
<span class="nc" id="L224">        System.out.println(&quot;   GET  /api/vendors/search - Search vendors&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ (6+ endpoint)
<span class="nc" id="L227">        System.out.println(&quot;   â­ Favorites System (6+ endpoints):&quot;);</span>
<span class="nc" id="L228">        System.out.println(&quot;   GET  /api/favorites/ - User favorites&quot;);</span>
<span class="nc" id="L229">        System.out.println(&quot;   POST /api/favorites/add - Add to favorites&quot;);</span>
<span class="nc" id="L230">        System.out.println(&quot;   DELETE /api/favorites/remove - Remove favorite&quot;);</span>
        
        // Ù†Ù…Ø§ÛŒØ´ endpoint Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ (6+ endpoint)
<span class="nc" id="L233">        System.out.println(&quot;   ğŸ”” Notification System (6+ endpoints):&quot;);</span>
<span class="nc" id="L234">        System.out.println(&quot;   GET  /api/notifications/{userId} - User notifications&quot;);</span>
<span class="nc" id="L235">        System.out.println(&quot;   POST /api/notifications/ - Create notification&quot;);</span>
<span class="nc" id="L236">        System.out.println(&quot;   PUT  /api/notification/{id}/read - Mark as read&quot;);</span>
<span class="nc" id="L237">        System.out.println(&quot;   DELETE /api/notification/{id} - Delete notification&quot;);</span>
        
        // Ù…Ø±Ø­Ù„Ù‡ 13: ØªÙ†Ø¸ÛŒÙ… Graceful Shutdown Ø¨Ø±Ø§ÛŒ Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù† ØµØ­ÛŒØ­ Ø³Ø±ÙˆØ±
<span class="nc" id="L240">        Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; {</span>
<span class="nc" id="L241">            System.out.println(&quot;ğŸ›‘ Shutting down server...&quot;);</span>
<span class="nc" id="L242">            server.stop(2); // ØªÙˆÙ‚Ù Ø³Ø±ÙˆØ± Ø¨Ø§ 2 Ø«Ø§Ù†ÛŒÙ‡ Ø§Ù†ØªØ¸Ø§Ø±</span>
<span class="nc" id="L243">            DatabaseUtil.shutdown(); // Ø¨Ø³ØªÙ† Ø§ØªØµØ§Ù„Ø§Øª Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡</span>
<span class="nc" id="L244">            System.out.println(&quot;âœ… Server stopped gracefully&quot;);</span>
<span class="nc" id="L245">        }));</span>
<span class="nc" id="L246">    }</span>
    
    /**
     * Ú©Ù„Ø§Ø³ Handler Ø¨Ø±Ø§ÛŒ endpoint Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆØ± (/health)
     * Ø§ÛŒÙ† endpoint Ø¨Ø±Ø§ÛŒ monitoringØŒ health check Ùˆ load balancer Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
     * 
     * Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§ÛŒÙ† Handler:
     * - Ø¨Ø§Ø²Ú¯Ø´Øª ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆØ± (UP/DOWN)
     * - Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø§Ù… Ø³Ø±ÙˆÛŒØ³
     * - Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
     * 
     * Ø§ÛŒÙ† endpoint Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ ØªÙˆØ³Ø·:
     * - Load balancers Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ø³Ø§Ù„Ù…
     * - Monitoring systems Ø¨Ø±Ø§ÛŒ Ù†Ø¸Ø§Ø±Øª Ø¨Ø± Ø³Ø±ÙˆØ±
     * - CI/CD pipelines Ø¨Ø±Ø§ÛŒ ØªØ³Øª deployment
     * Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
     * 
     * ÙØ±Ù…Øª Ù¾Ø§Ø³Ø®:
     * &lt;pre&gt;
     * {
     *   &quot;status&quot;: &quot;UP&quot;,
     *   &quot;service&quot;: &quot;food-ordering-backend&quot;
     * }
     * &lt;/pre&gt;
     * 
     * @author Food Ordering System Team
     * @version 1.0
     * @since 2024
     */
<span class="nc" id="L275">    static class HealthHandler implements HttpHandler {</span>
        
        /**
         * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øª health check
         * Ù‡Ù…ÛŒØ´Ù‡ ÙˆØ¶Ø¹ÛŒØª UP Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯ Ù…Ú¯Ø± Ø§ÛŒÙ†Ú©Ù‡ Ø³Ø±ÙˆØ± Ø®Ø±Ø§Ø¨ Ø¨Ø§Ø´Ø¯
         * 
         * @param exchange Ø´ÛŒØ¡ HttpExchange Ø´Ø§Ù…Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª
         * @throws IOException Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®
         */
        @Override
        public void handle(HttpExchange exchange) throws IOException {
            // Ù¾Ø§Ø³Ø® JSON Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆØ±
<span class="nc" id="L287">            String response = &quot;{\&quot;status\&quot;:\&quot;UP\&quot;,\&quot;service\&quot;:\&quot;food-ordering-backend\&quot;}&quot;;</span>
<span class="nc" id="L288">            sendResponse(exchange, 200, response);</span>
<span class="nc" id="L289">        }</span>
    }
    
    /**
     * Ú©Ù„Ø§Ø³ Handler Ø¨Ø±Ø§ÛŒ endpoint ØªØ³Øª (/api/test)
     * Ø§ÛŒÙ† endpoint Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø§ÙˆÙ„ÛŒÙ‡ Ú©Ø§Ø±Ú©Ø±Ø¯ Ø³Ø±ÙˆØ± Ùˆ API Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
     * 
     * Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§ÛŒÙ† Handler:
     * - ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ API
     * - Ù†Ù…Ø§ÛŒØ´ Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ Ø³Ø±ÙˆØ±
     * - Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ JSON response
     * - Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
     * 
     * Ø§ÛŒÙ† endpoint Ù…ÙÛŒØ¯ Ø§Ø³Øª Ø¨Ø±Ø§ÛŒ:
     * - ØªØ³Øª Ø§ÙˆÙ„ÛŒÙ‡ Ù¾Ø³ Ø§Ø² Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆØ±
     * - Ø¨Ø±Ø±Ø³ÛŒ connectivity Ú©Ù„Ø§ÛŒÙ†Øª Ø¨Ù‡ Ø³Ø±ÙˆØ±
     * - Debug Ù…Ø´Ú©Ù„Ø§Øª Ø§ØªØµØ§Ù„
     * - Ù…Ø«Ø§Ù„ Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†
     * 
     * ÙØ±Ù…Øª Ù¾Ø§Ø³Ø®:
     * &lt;pre&gt;
     * {
     *   &quot;message&quot;: &quot;Hello from Food Ordering Backend!&quot;,
     *   &quot;timestamp&quot;: &quot;2024-01-01T12:00:00.000Z&quot;
     * }
     * &lt;/pre&gt;
     * 
     * @author Food Ordering System Team
     * @version 1.0
     * @since 2024
     */
<span class="nc" id="L320">    static class TestHandler implements HttpHandler {</span>
        
        /**
         * Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªØ³Øª
         * Ù¾ÛŒØ§Ù… Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ Ø¨Ù‡ Ù‡Ù…Ø±Ø§Ù‡ timestamp ÙØ¹Ù„ÛŒ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
         * 
         * @param exchange Ø´ÛŒØ¡ HttpExchange Ø´Ø§Ù…Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª
         * @throws IOException Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®
         */
        @Override
        public void handle(HttpExchange exchange) throws IOException {
            // Ù¾Ø§Ø³Ø® JSON Ø´Ø§Ù…Ù„ Ù¾ÛŒØ§Ù… ØªØ³Øª Ùˆ Ø²Ù…Ø§Ù† ÙØ¹Ù„ÛŒ
            String response = &quot;{\&quot;message\&quot;:\&quot;Hello from Food Ordering Backend!\&quot;,\&quot;timestamp\&quot;:\&quot;&quot; + 
<span class="nc" id="L333">                            java.time.Instant.now() + &quot;\&quot;}&quot;;</span>
<span class="nc" id="L334">            sendResponse(exchange, 200, response);</span>
<span class="nc" id="L335">        }</span>
    }
    
    /**
     * Ú©Ù„Ø§Ø³ Handler Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (/api/auth/register)
     * Ù…Ø³Ø¦ÙˆÙ„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø«Ø¨Øª Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ø³ÛŒØ³ØªÙ…
     * 
     * Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§ÛŒÙ† Handler:
     * 1. Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø«Ø¨Øª Ù†Ø§Ù… (fullName, phone, password)
     * 2. Ù‡Ø´ Ú©Ø±Ø¯Ù† Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ BCrypt Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª
     * 3. Ø§ÛŒØ¬Ø§Ø¯ Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
     * 4. Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø«Ø¨Øª Ù†Ø§Ù… Ø´Ø¯Ù‡
     * 
     * ÙØ±Ù…Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª JSON:
     * &lt;pre&gt;
     * {
     *   &quot;fullName&quot;: &quot;Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±&quot;,
     *   &quot;phone&quot;: &quot;09123456789&quot;,
     *   &quot;password&quot;: &quot;Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù‚ÙˆÛŒ&quot;,
     *   &quot;email&quot;: &quot;user@example.com&quot;,     // Ø§Ø®ØªÛŒØ§Ø±ÛŒ
     *   &quot;address&quot;: &quot;Ø¢Ø¯Ø±Ø³ Ú©Ø§Ø±Ø¨Ø±&quot;          // Ø§Ø®ØªÛŒØ§Ø±ÛŒ
     * }
     * &lt;/pre&gt;
     * 
     * @author Food Ordering System Team
     * @version 1.0
     * @since 2024
     */
<span class="nc" id="L363">    static class RegisterHandler implements HttpHandler {</span>
        
        /**
         * ObjectMapper Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ JSON Ø¨Ù‡ Java objects Ùˆ Ø¨Ø±Ø¹Ú©Ø³
         * Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Jackson library Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³Ø±ÛŒØ¹ Ùˆ Ø¯Ù‚ÛŒÙ‚ JSON
         */
<span class="nc" id="L369">        private final ObjectMapper objectMapper = new ObjectMapper();</span>
        
        @Override
        public void handle(HttpExchange exchange) throws IOException {
            // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª - ÙÙ‚Ø· POST Ù‚Ø¨ÙˆÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
<span class="nc bnc" id="L374" title="All 2 branches missed.">            if (&quot;POST&quot;.equals(exchange.getRequestMethod())) {</span>
                try {
                    // Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª (request body)
<span class="nc" id="L377">                    String requestBody = new String(exchange.getRequestBody().readAllBytes());</span>
<span class="nc" id="L378">                    System.out.println(&quot;ğŸ“¥ Registration request received&quot;);</span>
                    
                    // ØªØ¨Ø¯ÛŒÙ„ JSON Ø¨Ù‡ JsonNode Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´
<span class="nc" id="L381">                    JsonNode json = objectMapper.readTree(requestBody);</span>
                    
                    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
<span class="nc bnc" id="L384" title="All 6 branches missed.">                    if (!json.has(&quot;fullName&quot;) || !json.has(&quot;phone&quot;) || !json.has(&quot;password&quot;)) {</span>
<span class="nc" id="L385">                        sendResponse(exchange, 400, &quot;{\&quot;error\&quot;:\&quot;Missing required fields: fullName, phone, password\&quot;}&quot;);</span>
<span class="nc" id="L386">                        return;</span>
                    }
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² JSON
<span class="nc" id="L390">                    String fullName = json.get(&quot;fullName&quot;).asText();          // Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</span>
<span class="nc" id="L391">                    String phone = json.get(&quot;phone&quot;).asText();                // Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">                    String email = json.has(&quot;email&quot;) ? json.get(&quot;email&quot;).asText() : &quot;&quot;; // Ø§ÛŒÙ…ÛŒÙ„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</span>
<span class="nc" id="L393">                    String password = json.get(&quot;password&quot;).asText();          // Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">                    String address = json.has(&quot;address&quot;) ? json.get(&quot;address&quot;).asText() : &quot;&quot;; // Ø¢Ø¯Ø±Ø³ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</span>
                    
                    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ - Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø§Ù„ÛŒ Ù†Ø¨ÙˆØ¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
<span class="nc bnc" id="L397" title="All 6 branches missed.">                    if (fullName.trim().isEmpty() || phone.trim().isEmpty() || password.trim().isEmpty()) {</span>
<span class="nc" id="L398">                        sendResponse(exchange, 400, &quot;{\&quot;error\&quot;:\&quot;fullName, phone, and password cannot be empty\&quot;}&quot;);</span>
<span class="nc" id="L399">                        return;</span>
                    }
                    
                    // Ù‡Ø´ Ú©Ø±Ø¯Ù† Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ BCrypt
<span class="nc" id="L403">                    String passwordHash = com.myapp.common.utils.PasswordUtil.hashPassword(password);</span>
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ø´ÛŒØ¡ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯
<span class="nc" id="L406">                    User user = User.forRegistration(fullName, phone, email, passwordHash, address);</span>
                    
                    // Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
<span class="nc" id="L409">                    User savedUser = authService.registerUser(user);</span>
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²
<span class="nc" id="L412">                    String response = &quot;{\&quot;message\&quot;:\&quot;User registered successfully!\&quot;,\&quot;status\&quot;:\&quot;success\&quot;,\&quot;userId\&quot;:&quot; + </span>
<span class="nc" id="L413">                                    savedUser.getId() + &quot;,\&quot;fullName\&quot;:\&quot;&quot; + savedUser.getFullName() + &quot;\&quot;,\&quot;phone\&quot;:\&quot;&quot; + savedUser.getPhone() + &quot;\&quot;}&quot;;</span>
<span class="nc" id="L414">                    sendResponse(exchange, 201, response);</span>
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ø³Ø±ÙˆØ±
<span class="nc" id="L417">                    System.out.println(&quot;âœ… User registered: &quot; + savedUser.getFullName() + &quot; (ID: &quot; + savedUser.getId() + &quot;)&quot;);</span>
                    
<span class="nc" id="L419">                } catch (Exception e) {</span>
                    // Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯ Ø«Ø¨Øª Ù†Ø§Ù…
<span class="nc" id="L421">                    System.err.println(&quot;âŒ Registration error: &quot; + e.getMessage());</span>
<span class="nc" id="L422">                    e.printStackTrace();</span>
<span class="nc" id="L423">                    String errorResponse = &quot;{\&quot;error\&quot;:\&quot;Registration failed\&quot;,\&quot;message\&quot;:\&quot;&quot; + e.getMessage().replace(&quot;\&quot;&quot;, &quot;'&quot;) + &quot;\&quot;}&quot;;</span>
<span class="nc" id="L424">                    sendResponse(exchange, 500, errorResponse);</span>
<span class="nc" id="L425">                }</span>
            } else {
                // Ø§Ú¯Ø± Ù†ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª POST Ù†Ø¨Ø§Ø´Ø¯ØŒ Ø®Ø·Ø§ÛŒ Method Not Allowed Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
<span class="nc" id="L428">                sendResponse(exchange, 405, &quot;{\&quot;error\&quot;:\&quot;Method not allowed\&quot;}&quot;);</span>
            }
<span class="nc" id="L430">        }</span>
    }
    
    /**
     * Ú©Ù„Ø§Ø³ Handler Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (/api/auth/login)
     * Ù…Ø³Ø¦ÙˆÙ„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ùˆ Ø§ÛŒØ¬Ø§Ø¯ JWT token Ø¨Ø±Ø§ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
     * 
     * Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§ÛŒÙ† Handler:
     * 1. Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯ (Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±)
     * 2. Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
     * 3. Ø§ÛŒØ¬Ø§Ø¯ Access Token Ùˆ Refresh Token
     * 4. Ø¨Ø§Ø²Ú¯Ø´Øª token Ù‡Ø§ Ø¨Ù‡ Ù‡Ù…Ø±Ø§Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
     * 
     * ÙØ±Ù…Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª JSON:
     * &lt;pre&gt;
     * {
     *   &quot;phone&quot;: &quot;09123456789&quot;,
     *   &quot;password&quot;: &quot;Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ú©Ø§Ø±Ø¨Ø±&quot;
     * }
     * &lt;/pre&gt;
     * 
     * ÙØ±Ù…Øª Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚:
     * &lt;pre&gt;
     * {
     *   &quot;message&quot;: &quot;Login successful!&quot;,
     *   &quot;status&quot;: &quot;success&quot;,
     *   &quot;userId&quot;: 123,
     *   &quot;fullName&quot;: &quot;Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±&quot;,
     *   &quot;phone&quot;: &quot;09123456789&quot;,
     *   &quot;role&quot;: &quot;BUYER&quot;,
     *   &quot;accessToken&quot;: &quot;eyJ0eXAi...&quot;,
     *   &quot;refreshToken&quot;: &quot;eyJ0eXAi...&quot;,
     *   &quot;tokenType&quot;: &quot;Bearer&quot;,
     *   &quot;expiresIn&quot;: 900
     * }
     * &lt;/pre&gt;
     * 
     * @author Food Ordering System Team
     * @version 1.0
     * @since 2024
     */
<span class="nc" id="L471">    static class LoginHandler implements HttpHandler {</span>
        
        /**
         * ObjectMapper Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ JSON Ø¨Ù‡ Java objects Ùˆ Ø¨Ø±Ø¹Ú©Ø³
         * Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Jackson library Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ù‚ÛŒÙ‚ JSON
         */
<span class="nc" id="L477">        private final ObjectMapper objectMapper = new ObjectMapper();</span>
        
        @Override
        public void handle(HttpExchange exchange) throws IOException {
            // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª - ÙÙ‚Ø· POST Ù‚Ø¨ÙˆÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
<span class="nc bnc" id="L482" title="All 2 branches missed.">            if (&quot;POST&quot;.equals(exchange.getRequestMethod())) {</span>
                try {
                    // Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª
<span class="nc" id="L485">                    String requestBody = new String(exchange.getRequestBody().readAllBytes());</span>
<span class="nc" id="L486">                    System.out.println(&quot;ğŸ“¥ Login request received&quot;);</span>
                    
                    // ØªØ¨Ø¯ÛŒÙ„ JSON Ø¨Ù‡ JsonNode
<span class="nc" id="L489">                    JsonNode json = objectMapper.readTree(requestBody);</span>
                    
                    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
<span class="nc bnc" id="L492" title="All 4 branches missed.">                    if (!json.has(&quot;phone&quot;) || !json.has(&quot;password&quot;)) {</span>
<span class="nc" id="L493">                        sendResponse(exchange, 400, &quot;{\&quot;error\&quot;:\&quot;Missing required fields: phone, password\&quot;}&quot;);</span>
<span class="nc" id="L494">                        return;</span>
                    }
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯
<span class="nc" id="L498">                    String phone = json.get(&quot;phone&quot;).asText();        // Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</span>
<span class="nc" id="L499">                    String password = json.get(&quot;password&quot;).asText();  // Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</span>
                    
                    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ
<span class="nc bnc" id="L502" title="All 4 branches missed.">                    if (phone.trim().isEmpty() || password.trim().isEmpty()) {</span>
<span class="nc" id="L503">                        sendResponse(exchange, 400, &quot;{\&quot;error\&quot;:\&quot;Phone and password cannot be empty\&quot;}&quot;);</span>
<span class="nc" id="L504">                        return;</span>
                    }
                    
                    // Ù‡Ø´ Ú©Ø±Ø¯Ù† Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡ (Ø¯Ø± ÙˆØ§Ù‚Ø¹ Ø¨Ø§ÛŒØ¯ Ø§Ø² verify Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯)
                    // String passwordHash = &quot;hashed_&quot; + password;
                    
                    // Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø± Ùˆ Ø¯Ø±ÛŒØ§ÙØª JWT token
<span class="nc" id="L511">                    AuthResult authResult = authService.loginWithTokens(phone, password);</span>
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
<span class="nc bnc" id="L514" title="All 2 branches missed.">                    if (!authResult.isAuthenticated()) {</span>
<span class="nc" id="L515">                        sendResponse(exchange, 401, &quot;{\&quot;error\&quot;:\&quot;&quot; + authResult.getErrorMessage() + &quot;\&quot;}&quot;);</span>
<span class="nc" id="L516">                        return;</span>
                    }
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø´Ø§Ù…Ù„ JWT token Ù‡Ø§
<span class="nc" id="L520">                    String response = String.format(</span>
                        &quot;{\&quot;message\&quot;:\&quot;Login successful!\&quot;,\&quot;status\&quot;:\&quot;success\&quot;,\&quot;userId\&quot;:%d,&quot; +
                        &quot;\&quot;fullName\&quot;:\&quot;%s\&quot;,\&quot;phone\&quot;:\&quot;%s\&quot;,\&quot;role\&quot;:\&quot;%s\&quot;,&quot; +
                        &quot;\&quot;accessToken\&quot;:\&quot;%s\&quot;,\&quot;refreshToken\&quot;:\&quot;%s\&quot;,&quot; +
                        &quot;\&quot;tokenType\&quot;:\&quot;Bearer\&quot;,\&quot;expiresIn\&quot;:%d}&quot;,
<span class="nc" id="L525">                        authResult.getUserId(),                         // Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±</span>
<span class="nc" id="L526">                        authResult.getPhone().replace(&quot;\&quot;&quot;, &quot;\\\&quot;&quot;),    // Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± (Ø¨Ø§ escape Ú©Ø±Ø¯Ù† &quot;)</span>
<span class="nc" id="L527">                        authResult.getPhone(),                          // Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</span>
<span class="nc" id="L528">                        authResult.getRole(),                           // Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±</span>
<span class="nc" id="L529">                        authResult.getAccessToken(),                    // Access Token</span>
<span class="nc" id="L530">                        authResult.getRefreshToken(),                   // Refresh Token</span>
<span class="nc" id="L531">                        com.myapp.common.utils.JWTUtil.getAccessTokenValidity() / 1000 // Ù…Ø¯Øª Ø§Ø¹ØªØ¨Ø§Ø± token Ø¨Ù‡ Ø«Ø§Ù†ÛŒÙ‡</span>
                    );
<span class="nc" id="L533">                    sendResponse(exchange, 200, response);</span>
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ø³Ø±ÙˆØ±
<span class="nc" id="L536">                    System.out.println(&quot;âœ… User logged in with JWT tokens: &quot; + authResult.getPhone() + &quot; (ID: &quot; + authResult.getUserId() + &quot;)&quot;);</span>
                    
<span class="nc" id="L538">                } catch (com.myapp.common.exceptions.InvalidCredentialsException e) {</span>
                    // Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø§Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±
<span class="nc" id="L540">                    sendResponse(exchange, 401, &quot;{\&quot;error\&quot;:\&quot;Invalid phone or password\&quot;}&quot;);</span>
<span class="nc" id="L541">                } catch (Exception e) {</span>
                    // Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§ÛŒØ± Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ
<span class="nc" id="L543">                    System.err.println(&quot;âŒ Login error: &quot; + e.getMessage());</span>
<span class="nc" id="L544">                    e.printStackTrace();</span>
<span class="nc" id="L545">                    String errorResponse = &quot;{\&quot;error\&quot;:\&quot;Login failed\&quot;,\&quot;message\&quot;:\&quot;&quot; + e.getMessage().replace(&quot;\&quot;&quot;, &quot;'&quot;) + &quot;\&quot;}&quot;;</span>
<span class="nc" id="L546">                    sendResponse(exchange, 500, errorResponse);</span>
<span class="nc" id="L547">                }</span>
            } else {
                // Ø®Ø·Ø§ÛŒ Method Not Allowed Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ù†ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
<span class="nc" id="L550">                sendResponse(exchange, 405, &quot;{\&quot;error\&quot;:\&quot;Method not allowed\&quot;}&quot;);</span>
            }
<span class="nc" id="L552">        }</span>
    }
    
    /**
     * Ú©Ù„Ø§Ø³ Handler Ø¨Ø±Ø§ÛŒ ØªØ¬Ø¯ÛŒØ¯ JWT token (/api/auth/refresh)
     * Ù…Ø³Ø¦ÙˆÙ„ ØªØ¬Ø¯ÛŒØ¯ Access Token Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Refresh Token Ù…Ø¹ØªØ¨Ø±
     * 
     * Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§ÛŒÙ† Handler:
     * 1. Ø¯Ø±ÛŒØ§ÙØª Refresh Token Ø§Ø² Ú©Ù„Ø§ÛŒÙ†Øª
     * 2. Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Refresh Token
     * 3. Ø§ÛŒØ¬Ø§Ø¯ Access Token Ùˆ Refresh Token Ø¬Ø¯ÛŒØ¯
     * 4. Ø¨Ø§Ø²Ú¯Ø´Øª token Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
     * 
     * Ø§ÛŒÙ† endpoint Ø²Ù…Ø§Ù†ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ Access Token Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡
     * ÙˆÙ„ÛŒ Refresh Token Ù‡Ù†ÙˆØ² Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
     * 
     * ÙØ±Ù…Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª JSON:
     * &lt;pre&gt;
     * {
     *   &quot;refreshToken&quot;: &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...&quot;
     * }
     * &lt;/pre&gt;
     * 
     * @author Food Ordering System Team
     * @version 1.0
     * @since 2024
     */
<span class="nc" id="L579">    static class RefreshTokenHandler implements HttpHandler {</span>
        
        /**
         * ObjectMapper Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ JSON Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
         */
<span class="nc" id="L584">        private final ObjectMapper objectMapper = new ObjectMapper();</span>
        
        @Override
        public void handle(HttpExchange exchange) throws IOException {
            // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª - ÙÙ‚Ø· POST Ù‚Ø¨ÙˆÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
<span class="nc bnc" id="L589" title="All 2 branches missed.">            if (&quot;POST&quot;.equals(exchange.getRequestMethod())) {</span>
                try {
                    // Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª
<span class="nc" id="L592">                    String requestBody = new String(exchange.getRequestBody().readAllBytes());</span>
<span class="nc" id="L593">                    JsonNode json = objectMapper.readTree(requestBody);</span>
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Refresh Token
<span class="nc bnc" id="L596" title="All 2 branches missed.">                    if (!json.has(&quot;refreshToken&quot;)) {</span>
<span class="nc" id="L597">                        sendResponse(exchange, 400, &quot;{\&quot;error\&quot;:\&quot;Missing refreshToken field\&quot;}&quot;);</span>
<span class="nc" id="L598">                        return;</span>
                    }
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Refresh Token
<span class="nc" id="L602">                    String refreshToken = json.get(&quot;refreshToken&quot;).asText();</span>
                    
                    // ØªØ¬Ø¯ÛŒØ¯ token Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø³Ø±ÙˆÛŒØ³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
<span class="nc" id="L605">                    AuthResult authResult = authService.refreshToken(refreshToken);</span>
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙÙ‚ÛŒØª ØªØ¬Ø¯ÛŒØ¯ token
<span class="nc bnc" id="L608" title="All 2 branches missed.">                    if (!authResult.isAuthenticated()) {</span>
<span class="nc" id="L609">                        sendResponse(exchange, 401, &quot;{\&quot;error\&quot;:\&quot;&quot; + authResult.getErrorMessage() + &quot;\&quot;}&quot;);</span>
<span class="nc" id="L610">                        return;</span>
                    }
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø§Ø³Ø® Ø´Ø§Ù…Ù„ token Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
<span class="nc" id="L614">                    String response = String.format(</span>
                        &quot;{\&quot;message\&quot;:\&quot;Token refreshed successfully\&quot;,\&quot;status\&quot;:\&quot;success\&quot;,&quot; +
                        &quot;\&quot;accessToken\&quot;:\&quot;%s\&quot;,\&quot;refreshToken\&quot;:\&quot;%s\&quot;,&quot; +
                        &quot;\&quot;tokenType\&quot;:\&quot;Bearer\&quot;,\&quot;expiresIn\&quot;:%d}&quot;,
<span class="nc" id="L618">                        authResult.getAccessToken(),                    // Access Token Ø¬Ø¯ÛŒØ¯</span>
<span class="nc" id="L619">                        authResult.getRefreshToken(),                   // Refresh Token Ø¬Ø¯ÛŒØ¯</span>
<span class="nc" id="L620">                        com.myapp.common.utils.JWTUtil.getAccessTokenValidity() / 1000 // Ù…Ø¯Øª Ø§Ø¹ØªØ¨Ø§Ø±</span>
                    );
<span class="nc" id="L622">                    sendResponse(exchange, 200, response);</span>
                    
<span class="nc" id="L624">                } catch (Exception e) {</span>
                    // Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§ÛŒ ØªØ¬Ø¯ÛŒØ¯ token
<span class="nc" id="L626">                    System.err.println(&quot;âŒ Token refresh error: &quot; + e.getMessage());</span>
<span class="nc" id="L627">                    String errorResponse = &quot;{\&quot;error\&quot;:\&quot;Token refresh failed\&quot;,\&quot;message\&quot;:\&quot;&quot; + e.getMessage().replace(&quot;\&quot;&quot;, &quot;'&quot;) + &quot;\&quot;}&quot;;</span>
<span class="nc" id="L628">                    sendResponse(exchange, 500, errorResponse);</span>
<span class="nc" id="L629">                }</span>
            } else {
<span class="nc" id="L631">                sendResponse(exchange, 405, &quot;{\&quot;error\&quot;:\&quot;Method not allowed\&quot;}&quot;);</span>
            }
<span class="nc" id="L633">        }</span>
    }
    
    /**
     * Ú©Ù„Ø§Ø³ Handler Ø¨Ø±Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ JWT token (/api/auth/validate)
     * Ù…Ø³Ø¦ÙˆÙ„ Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Access Token Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
     * 
     * Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§ÛŒÙ† Handler:
     * 1. Ø¯Ø±ÛŒØ§ÙØª Access Token Ø§Ø² header Authorization
     * 2. Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ token (Ø§Ù…Ø¶Ø§ØŒ Ø§Ù†Ù‚Ø¶Ø§ØŒ Ø³Ø§Ø®ØªØ§Ø±)
     * 3. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø§Ø² token
     * 4. Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± ØµÙˆØ±Øª Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù†
     * 
     * Ø§ÛŒÙ† endpoint Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø±
     * Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ ÙˆØ±ÙˆØ¯ Ù…Ø¬Ø¯Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
     * 
     * Header Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²:
     * Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...
     * 
     * ÙØ±Ù…Øª Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚:
     * &lt;pre&gt;
     * {
     *   &quot;valid&quot;: true,
     *   &quot;userId&quot;: 123,
     *   &quot;phone&quot;: &quot;09123456789&quot;,
     *   &quot;role&quot;: &quot;BUYER&quot;
     * }
     * &lt;/pre&gt;
     * 
     * @author Food Ordering System Team
     * @version 1.0
     * @since 2024
     */
<span class="nc" id="L666">    static class ValidateTokenHandler implements HttpHandler {</span>
        @Override
        public void handle(HttpExchange exchange) throws IOException {
            // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª - ÙÙ‚Ø· GET Ù‚Ø¨ÙˆÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
<span class="nc bnc" id="L670" title="All 2 branches missed.">            if (&quot;GET&quot;.equals(exchange.getRequestMethod())) {</span>
                try {
                    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ token Ø§Ø² Ø·Ø±ÛŒÙ‚ middleware Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
<span class="nc" id="L673">                    AuthResult authResult = AuthMiddleware.authenticate(exchange);</span>
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
<span class="nc bnc" id="L676" title="All 2 branches missed.">                    if (!authResult.isAuthenticated()) {</span>
<span class="nc" id="L677">                        sendResponse(exchange, 401, &quot;{\&quot;error\&quot;:\&quot;&quot; + authResult.getErrorMessage() + &quot;\&quot;}&quot;);</span>
<span class="nc" id="L678">                        return;</span>
                    }
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø§Ø³Ø® Ø´Ø§Ù…Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
<span class="nc" id="L682">                    String response = String.format(</span>
                        &quot;{\&quot;valid\&quot;:true,\&quot;userId\&quot;:%d,\&quot;phone\&quot;:\&quot;%s\&quot;,\&quot;role\&quot;:\&quot;%s\&quot;}&quot;,
<span class="nc" id="L684">                        authResult.getUserId(),    // Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±</span>
<span class="nc" id="L685">                        authResult.getPhone(),     // Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ú©Ø§Ø±Ø¨Ø±</span>
<span class="nc" id="L686">                        authResult.getRole()       // Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±</span>
                    );
<span class="nc" id="L688">                    sendResponse(exchange, 200, response);</span>
                    
<span class="nc" id="L690">                } catch (Exception e) {</span>
                    // Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
<span class="nc" id="L692">                    System.err.println(&quot;âŒ Token validation error: &quot; + e.getMessage());</span>
<span class="nc" id="L693">                    String errorResponse = &quot;{\&quot;valid\&quot;:false,\&quot;error\&quot;:\&quot;Token validation failed\&quot;}&quot;;</span>
<span class="nc" id="L694">                    sendResponse(exchange, 401, errorResponse);</span>
<span class="nc" id="L695">                }</span>
            } else {
<span class="nc" id="L697">                sendResponse(exchange, 405, &quot;{\&quot;error\&quot;:\&quot;Method not allowed\&quot;}&quot;);</span>
            }
<span class="nc" id="L699">        }</span>
    }
    
    /**
     * Ú©Ù„Ø§Ø³ Handler Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (/api/auth/logout)
     * Ù…Ø³Ø¦ÙˆÙ„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ùˆ invalidate Ú©Ø±Ø¯Ù† token Ù‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
     * 
     * Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§ÛŒÙ† Handler:
     * 1. Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ø·Ø±ÛŒÙ‚ Access Token
     * 2. invalidate Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… token Ù‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
     * 3. Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† session Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ø³Ø±ÙˆØ±
     * 4. Ø¨Ø§Ø²Ú¯Ø´Øª ØªØ£ÛŒÛŒØ¯ Ø®Ø±ÙˆØ¬ Ù…ÙˆÙÙ‚
     * 
     * Ù¾Ø³ Ø§Ø² Ø®Ø±ÙˆØ¬ØŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ÙˆØ§Ø±Ø¯ Ø´ÙˆØ¯ ØªØ§ Ø¨ØªÙˆØ§Ù†Ø¯
     * Ø§Ø² Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ù…Ø­Ø§ÙØ¸Øª Ø´Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ø¯
     * 
     * Header Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²:
     * Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...
     * 
     * ÙØ±Ù…Øª Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚:
     * &lt;pre&gt;
     * {
     *   &quot;message&quot;: &quot;Logged out successfully&quot;,
     *   &quot;status&quot;: &quot;success&quot;
     * }
     * &lt;/pre&gt;
     * 
     * @author Food Ordering System Team
     * @version 1.0
     * @since 2024
     */
<span class="nc" id="L730">    static class LogoutHandler implements HttpHandler {</span>
        @Override
        public void handle(HttpExchange exchange) throws IOException {
            // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª - ÙÙ‚Ø· POST Ù‚Ø¨ÙˆÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
<span class="nc bnc" id="L734" title="All 2 branches missed.">            if (&quot;POST&quot;.equals(exchange.getRequestMethod())) {</span>
                try {
                    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ token Ú©Ø§Ø±Ø¨Ø±
<span class="nc" id="L737">                    AuthResult authResult = AuthMiddleware.authenticate(exchange);</span>
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† token
<span class="nc bnc" id="L740" title="All 2 branches missed.">                    if (!authResult.isAuthenticated()) {</span>
<span class="nc" id="L741">                        sendResponse(exchange, 401, &quot;{\&quot;error\&quot;:\&quot;&quot; + authResult.getErrorMessage() + &quot;\&quot;}&quot;);</span>
<span class="nc" id="L742">                        return;</span>
                    }
                    
                    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®Ø±ÙˆØ¬ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ø³ÛŒØ³ØªÙ…
<span class="nc" id="L746">                    String message = authService.logout(authResult.getUserId());</span>
<span class="nc" id="L747">                    String response = &quot;{\&quot;message\&quot;:\&quot;&quot; + message + &quot;\&quot;,\&quot;status\&quot;:\&quot;success\&quot;}&quot;;</span>
<span class="nc" id="L748">                    sendResponse(exchange, 200, response);</span>
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø®Ø±ÙˆØ¬ Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ø³Ø±ÙˆØ±
<span class="nc" id="L751">                    System.out.println(&quot;âœ… User logged out: &quot; + authResult.getPhone() + &quot; (ID: &quot; + authResult.getUserId() + &quot;)&quot;);</span>
                    
<span class="nc" id="L753">                } catch (Exception e) {</span>
                    // Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§ÛŒ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø®Ø±ÙˆØ¬
<span class="nc" id="L755">                    System.err.println(&quot;âŒ Logout error: &quot; + e.getMessage());</span>
<span class="nc" id="L756">                    String errorResponse = &quot;{\&quot;error\&quot;:\&quot;Logout failed\&quot;,\&quot;message\&quot;:\&quot;&quot; + e.getMessage().replace(&quot;\&quot;&quot;, &quot;'&quot;) + &quot;\&quot;}&quot;;</span>
<span class="nc" id="L757">                    sendResponse(exchange, 500, errorResponse);</span>
<span class="nc" id="L758">                }</span>
            } else {
<span class="nc" id="L760">                sendResponse(exchange, 405, &quot;{\&quot;error\&quot;:\&quot;Method not allowed\&quot;}&quot;);</span>
            }
<span class="nc" id="L762">        }</span>
    }
    
    /**
     * Ù…ØªØ¯ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® HTTP Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯
     * Ø§ÛŒÙ† Ù…ØªØ¯ header Ù‡Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ø±Ø¯Ù‡ Ùˆ Ù¾Ø§Ø³Ø® Ø±Ø§ Ø¨Ù‡ Ú©Ù„Ø§ÛŒÙ†Øª Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
     * 
     * ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù…ØªØ¯:
     * - ØªÙ†Ø¸ÛŒÙ… Content-Type Ø¨Ù‡ application/json
     * - ØªÙ†Ø¸ÛŒÙ… CORS headers Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ cross-origin
     * - Ù…Ø¯ÛŒØ±ÛŒØª ØµØ­ÛŒØ­ Ø·ÙˆÙ„ Ù…Ø­ØªÙˆØ§
     * - Ø¨Ø³ØªÙ† Ø®ÙˆØ¯Ú©Ø§Ø± streams
     * 
     * Ú©Ø¯Ù‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù…ØªØ¯Ø§ÙˆÙ„:
     * - 200: OK - Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙÙ‚
     * - 201: Created - Ù…Ù†Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯
     * - 400: Bad Request - Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±
     * - 401: Unauthorized - Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù„Ø§Ø²Ù…
     * - 404: Not Found - Ù…Ù†Ø¨Ø¹ ÛŒØ§ÙØª Ù†Ø´Ø¯
     * - 405: Method Not Allowed - HTTP method Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
     * - 500: Internal Server Error - Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±
     * 
     * @param exchange Ø´ÛŒØ¡ HttpExchange Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª/Ù¾Ø§Ø³Ø® HTTP
     * @param statusCode Ú©Ø¯ ÙˆØ¶Ø¹ÛŒØª HTTP (200, 400, 401, 404, 500, etc.)
     * @param response Ù…Ø­ØªÙˆØ§ÛŒ Ù¾Ø§Ø³Ø® (Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ JSON string)
     * @throws IOException Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ Ø¯Ø± Ù†ÙˆØ´ØªÙ† Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ú©Ù„Ø§ÛŒÙ†Øª
     * 
     * @author Food Ordering System Team
     * @version 1.0
     * @since 2024
     */
    private static void sendResponse(HttpExchange exchange, int statusCode, String response) throws IOException {
        // ØªÙ†Ø¸ÛŒÙ… header Content-Type Ø¨Ø±Ø§ÛŒ JSON
<span class="nc" id="L795">        exchange.getResponseHeaders().set(&quot;Content-Type&quot;, &quot;application/json&quot;);</span>
        
        // ØªÙ†Ø¸ÛŒÙ… CORS header Ø¨Ø±Ø§ÛŒ Ø§Ù…Ú©Ø§Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø² Ø³Ø§ÛŒØ± domain Ù‡Ø§
<span class="nc" id="L798">        exchange.getResponseHeaders().set(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span>
        
        // Ø§Ø±Ø³Ø§Ù„ header Ù‡Ø§ÛŒ Ù¾Ø§Ø³Ø® Ø´Ø§Ù…Ù„ Ú©Ø¯ ÙˆØ¶Ø¹ÛŒØª Ùˆ Ø·ÙˆÙ„ Ù…Ø­ØªÙˆØ§
<span class="nc" id="L801">        exchange.sendResponseHeaders(statusCode, response.getBytes().length);</span>
        
        // Ù†ÙˆØ´ØªÙ† Ù…Ø­ØªÙˆØ§ÛŒ Ù¾Ø§Ø³Ø® Ùˆ Ø¨Ø³ØªÙ† stream
<span class="nc" id="L804">        try (OutputStream os = exchange.getResponseBody()) {</span>
<span class="nc" id="L805">            os.write(response.getBytes());</span>
        }
<span class="nc" id="L807">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>