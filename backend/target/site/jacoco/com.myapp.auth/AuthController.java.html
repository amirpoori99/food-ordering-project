<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AuthController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Food Ordering Backend</a> &gt; <a href="index.source.html" class="el_package">com.myapp.auth</a> &gt; <span class="el_source">AuthController.java</span></div><h1>AuthController.java</h1><pre class="source lang-java linenums">package com.myapp.auth;

import com.myapp.auth.dto.RegisterRequest;
import com.myapp.auth.dto.ProfileResponse;
import com.myapp.auth.dto.UpdateProfileRequest;
import com.myapp.common.models.User;

/**
 * کنترلر احراز هویت - لایه ارائه‌دهنده برای عملیات احراز هویت
 * این کلاس facade رقیقی بر روی AuthService است
 * در مراحل بعدی با annotation های web framework مانند @RestController، @PostMapping تنظیم خواهد شد
 * فعلاً بدون وابستگی به framework نگهداری می‌شود تا تست‌های واحد روی رفتار متمرکز باشند نه HTTP
 * 
 * این کنترلر مسئولیت‌های زیر را دارد:
 * - دریافت درخواست‌های احراز هویت از کلاینت
 * - انتقال درخواست‌ها به لایه Service
 * - بازگرداندن پاسخ‌های مناسب به کلاینت
 * - مدیریت تبدیل DTO ها
 * 
 * از الگوی Controller Pattern استفاده می‌کند
 * 
 * @author Food Ordering System Team
 * @version 1.0
 * @since 2024
 */
public class AuthController {

    /** نمونه سرویس احراز هویت برای delegation */
    private final AuthService service;

    /**
     * سازنده کنترلر احراز هویت
     * تزریق وابستگی به AuthService
     * 
     * @param service سرویس احراز هویت
     */
<span class="fc" id="L37">    public AuthController(AuthService service) {</span>
<span class="fc" id="L38">        this.service = service;</span>
<span class="fc" id="L39">    }</span>

    /**
     * ثبت نام کاربر جدید
     * 
     * @param req درخواست ثبت نام حاوی اطلاعات کاربر
     * @return کاربر ثبت شده همراه با ID تولید شده
     * @throws DuplicatePhoneException در صورت تکراری بودن شماره تلفن
     */
    public User register(RegisterRequest req) {
<span class="fc" id="L49">        return service.register(req);</span>
    }

    /**
     * ورود کاربر با شماره تلفن و رمز عبور
     * 
     * @param phone شماره تلفن کاربر
     * @param passwordHash رمز عبور hash شده
     * @return کاربر وارد شده
     * @throws InvalidCredentialsException در صورت نامعتبر بودن اعتبارات
     */
    public User login(String phone, String passwordHash) {
<span class="fc" id="L61">        return service.login(phone, passwordHash);</span>
    }
    
    /**
     * ورود کاربر همراه با تولید JWT token
     * 
     * @param phone شماره تلفن کاربر
     * @param passwordHash رمز عبور hash شده
     * @return AuthResult حاوی JWT tokens (Access + Refresh)
     */
    public AuthResult loginWithTokens(String phone, String passwordHash) {
<span class="nc" id="L72">        return service.loginWithTokens(phone, passwordHash);</span>
    }
    
    /**
     * تجدید Access Token با استفاده از Refresh Token
     * 
     * @param refreshToken Refresh Token برای تجدید
     * @return AuthResult حاوی Access Token جدید
     */
    public AuthResult refreshToken(String refreshToken) {
<span class="nc" id="L82">        return service.refreshToken(refreshToken);</span>
    }
    
    /**
     * اعتبارسنجی Access Token
     * 
     * @param accessToken Access Token برای اعتبارسنجی
     * @return AuthResult حاوی اطلاعات کاربر در صورت معتبر بودن
     */
    public AuthResult validateToken(String accessToken) {
<span class="nc" id="L92">        return service.validateToken(accessToken);</span>
    }
    
    /**
     * خروج کاربر از سیستم
     * در سیستم JWT stateless، خروج معمولاً در سمت کلاینت مدیریت می‌شود
     * 
     * @param userId شناسه کاربر برای خروج
     * @return پیام موفقیت خروج
     */
    public String logout(Long userId) {
<span class="nc" id="L103">        return service.logout(userId);</span>
    }

    /**
     * دریافت پروفایل کاربر بر اساس شناسه
     * تبدیل User entity به ProfileResponse DTO
     * 
     * @param id شناسه کاربر
     * @return ProfileResponse حاوی اطلاعات عمومی کاربر (بدون رمز عبور)
     * @throws NotFoundException در صورت عدم وجود کاربر
     */
    public ProfileResponse getProfile(long id) {
<span class="fc" id="L115">        return ProfileResponse.from(service.getProfile(id));</span>
    }

    /**
     * به‌روزرسانی پروفایل کاربر
     * امکان به‌روزرسانی جزئی (partial update) فراهم می‌کند
     * 
     * @param id شناسه کاربر
     * @param req درخواست به‌روزرسانی حاوی فیلدهای قابل تغییر
     * @return ProfileResponse حاوی اطلاعات به‌روز شده کاربر
     * @throws NotFoundException در صورت عدم وجود کاربر
     * @throws DuplicatePhoneException در صورت تعارض شماره تلفن (اگر تغییر کند)
     */
    public ProfileResponse updateProfile(long id, UpdateProfileRequest req) {
<span class="fc" id="L129">        return ProfileResponse.from(service.updateProfile(id, req));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>