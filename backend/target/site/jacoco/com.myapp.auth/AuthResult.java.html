<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AuthResult.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Food Ordering Backend</a> &gt; <a href="index.source.html" class="el_package">com.myapp.auth</a> &gt; <span class="el_source">AuthResult.java</span></div><h1>AuthResult.java</h1><pre class="source lang-java linenums">package com.myapp.auth;

/**
 * کلاس نتیجه احراز هویت - حاوی نتیجه تلاش برای احراز هویت
 * در صورت موفقیت شامل اطلاعات کاربر، در صورت شکست شامل پیام خطا
 * این کلاس الگوی Result Pattern را پیاده‌سازی می‌کند
 */
public class AuthResult {
    private final boolean authenticated;    // آیا احراز هویت موفق بوده؟
    private final String errorMessage;      // پیام خطا در صورت عدم موفقیت
    private final Long userId;              // شناسه کاربر (در صورت موفقیت)
    private final String phone;             // شماره تلفن کاربر (در صورت موفقیت)
    private final String role;              // نقش کاربر (در صورت موفقیت)
    private final String accessToken;       // Access Token برای دسترسی به API
    private final String refreshToken;      // Refresh Token برای تجدید Access Token
    private final boolean isRefresh;        // آیا این نتیجه از عملیات refresh token است؟
    
    /**
     * سازنده خصوصی - فقط از طریق متدهای static قابل دسترسی
     * این الگو Type Safety و کنترل بهتری فراهم می‌کند
     */
    private AuthResult(boolean authenticated, String errorMessage, Long userId, String phone, String role, 
<span class="fc" id="L23">                      String accessToken, String refreshToken, boolean isRefresh) {</span>
<span class="fc" id="L24">        this.authenticated = authenticated;   // تنظیم وضعیت احراز هویت</span>
<span class="fc" id="L25">        this.errorMessage = errorMessage;     // تنظیم پیام خطا</span>
<span class="fc" id="L26">        this.userId = userId;                 // تنظیم شناسه کاربر</span>
<span class="fc" id="L27">        this.phone = phone;                   // تنظیم شماره تلفن</span>
<span class="fc" id="L28">        this.role = role;                     // تنظیم نقش کاربر</span>
<span class="fc" id="L29">        this.accessToken = accessToken;       // تنظیم Access Token</span>
<span class="fc" id="L30">        this.refreshToken = refreshToken;     // تنظیم Refresh Token</span>
<span class="fc" id="L31">        this.isRefresh = isRefresh;           // تنظیم نوع عملیات</span>
<span class="fc" id="L32">    }</span>
    
    /**
     * ایجاد نتیجه احراز هویت موفق
     * 
     * @param userId شناسه کاربر
     * @param phone شماره تلفن کاربر
     * @param role نقش کاربر
     * @param accessToken Access Token
     * @return نتیجه احراز هویت موفق
     */
    public static AuthResult authenticated(Long userId, String phone, String role, String accessToken) {
<span class="fc" id="L44">        return new AuthResult(true, null, userId, phone, role, accessToken, null, false);</span>
    }
    
    /**
     * ایجاد نتیجه احراز هویت ناموفق
     * 
     * @param errorMessage پیام خطا
     * @return نتیجه احراز هویت ناموفق
     */
    public static AuthResult unauthenticated(String errorMessage) {
<span class="fc" id="L54">        return new AuthResult(false, errorMessage, null, null, null, null, null, false);</span>
    }
    
    /**
     * ایجاد نتیجه تجدید token موفق
     * 
     * @param userId شناسه کاربر
     * @param phone شماره تلفن کاربر
     * @param role نقش کاربر
     * @param newAccessToken Access Token جدید
     * @param newRefreshToken Refresh Token جدید
     * @return نتیجه تجدید token موفق
     */
    public static AuthResult refreshed(Long userId, String phone, String role, String newAccessToken, String newRefreshToken) {
<span class="fc" id="L68">        return new AuthResult(true, null, userId, phone, role, newAccessToken, newRefreshToken, true);</span>
    }
    
    /**
     * بررسی موفقیت احراز هویت
     * 
     * @return true اگر احراز هویت موفق باشد، در غیر اینصورت false
     */
    public boolean isAuthenticated() {
<span class="fc" id="L77">        return authenticated;</span>
    }
    
    /**
     * دریافت پیام خطا در صورت شکست احراز هویت
     * 
     * @return پیام خطا یا null در صورت موفقیت
     */
    public String getErrorMessage() {
<span class="fc" id="L86">        return errorMessage;</span>
    }
    
    /**
     * دریافت شناسه کاربر احراز هویت شده
     * 
     * @return شناسه کاربر یا null در صورت عدم احراز هویت
     */
    public Long getUserId() {
<span class="fc" id="L95">        return userId;</span>
    }
    
    /**
     * دریافت شماره تلفن کاربر احراز هویت شده
     * 
     * @return شماره تلفن کاربر یا null در صورت عدم احراز هویت
     */
    public String getPhone() {
<span class="fc" id="L104">        return phone;</span>
    }
    
    /**
     * دریافت نقش کاربر احراز هویت شده
     * 
     * @return نقش کاربر یا null در صورت عدم احراز هویت
     */
    public String getRole() {
<span class="fc" id="L113">        return role;</span>
    }
    
    /**
     * دریافت Access Token
     * 
     * @return Access Token یا null در صورت عدم احراز هویت
     */
    public String getAccessToken() {
<span class="fc" id="L122">        return accessToken;</span>
    }
    
    /**
     * دریافت Refresh Token (فقط بعد از عملیات refresh در دسترس است)
     * 
     * @return Refresh Token یا null
     */
    public String getRefreshToken() {
<span class="fc" id="L131">        return refreshToken;</span>
    }
    
    /**
     * بررسی اینکه آیا این نتیجه از عملیات تجدید token است
     * 
     * @return true اگر از refresh باشد، در غیر اینصورت false
     */
    public boolean isRefresh() {
<span class="fc" id="L140">        return isRefresh;</span>
    }
    
    /**
     * بررسی داشتن نقش خاص توسط کاربر
     * 
     * @param requiredRole نقش مورد نیاز
     * @return true اگر کاربر این نقش را داشته باشد، در غیر اینصورت false
     */
    public boolean hasRole(String requiredRole) {
<span class="fc bfc" id="L150" title="All 4 branches covered.">        return authenticated &amp;&amp; requiredRole.equals(role);</span>
    }
    
    /**
     * بررسی داشتن هر یک از نقش‌های مشخص شده توسط کاربر
     * 
     * @param roles نقش‌هایی که باید بررسی شوند
     * @return true اگر کاربر حداقل یکی از نقش‌ها را داشته باشد، در غیر اینصورت false
     */
    public boolean hasAnyRole(String... roles) {
<span class="fc bfc" id="L160" title="All 2 branches covered.">        if (!authenticated) {</span>
<span class="fc" id="L161">            return false;</span>
        }
        
        // بررسی هر نقش
<span class="fc bfc" id="L165" title="All 2 branches covered.">        for (String requiredRole : roles) {</span>
<span class="fc bfc" id="L166" title="All 2 branches covered.">            if (requiredRole.equals(role)) {</span>
<span class="fc" id="L167">                return true;</span>
            }
        }
<span class="fc" id="L170">        return false;</span>
    }
    
    /**
     * بررسی اینکه آیا کاربر مشتری است
     * پشتیبانی از هر دو نام: &quot;BUYER&quot; و &quot;customer&quot;
     * 
     * @return true اگر کاربر مشتری باشد، در غیر اینصورت false
     */
    public boolean isCustomer() {
<span class="fc bfc" id="L180" title="All 4 branches covered.">        return hasRole(&quot;BUYER&quot;) || hasRole(&quot;customer&quot;);</span>
    }
    
    /**
     * بررسی اینکه آیا کاربر فروشنده است
     * پشتیبانی از هر دو نام: &quot;SELLER&quot; و &quot;seller&quot;
     * 
     * @return true اگر کاربر فروشنده باشد، در غیر اینصورت false
     */
    public boolean isSeller() {
<span class="pc bpc" id="L190" title="1 of 4 branches missed.">        return hasRole(&quot;SELLER&quot;) || hasRole(&quot;seller&quot;);</span>
    }
    
    /**
     * بررسی اینکه آیا کاربر پیک است
     * پشتیبانی از نام‌های مختلف: &quot;COURIER&quot;, &quot;delivery&quot;, &quot;courier&quot;
     * 
     * @return true اگر کاربر پیک باشد، در غیر اینصورت false
     */
    public boolean isDelivery() {
<span class="pc bpc" id="L200" title="2 of 6 branches missed.">        return hasRole(&quot;COURIER&quot;) || hasRole(&quot;delivery&quot;) || hasRole(&quot;courier&quot;);</span>
    }
    
    /**
     * بررسی اینکه آیا کاربر مدیر است
     * پشتیبانی از هر دو نام: &quot;ADMIN&quot; و &quot;admin&quot;
     * 
     * @return true اگر کاربر مدیر باشد، در غیر اینصورت false
     */
    public boolean isAdmin() {
<span class="pc bpc" id="L210" title="1 of 4 branches missed.">        return hasRole(&quot;ADMIN&quot;) || hasRole(&quot;admin&quot;);</span>
    }
    
    /**
     * نمایش رشته‌ای از نتیجه احراز هویت
     * برای debugging و logging مفید است
     * 
     * @return نمایش رشته‌ای از AuthResult
     */
    @Override
    public String toString() {
<span class="fc bfc" id="L221" title="All 2 branches covered.">        if (authenticated) {</span>
<span class="fc" id="L222">            return String.format(&quot;AuthResult{authenticated=true, userId=%d, phone='%s', role='%s', isRefresh=%s}&quot;, </span>
<span class="fc" id="L223">                               userId, phone, role, isRefresh);</span>
        } else {
<span class="fc" id="L225">            return String.format(&quot;AuthResult{authenticated=false, errorMessage='%s'}&quot;, errorMessage);</span>
        }
    }
} 
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>