<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RestaurantService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Food Ordering Backend</a> &gt; <a href="index.source.html" class="el_package">com.myapp.restaurant</a> &gt; <span class="el_source">RestaurantService.java</span></div><h1>RestaurantService.java</h1><pre class="source lang-java linenums">package com.myapp.restaurant;

import com.myapp.common.exceptions.NotFoundException;
import com.myapp.common.models.Restaurant;
import com.myapp.common.models.RestaurantStatus;
import com.myapp.common.utils.PerformanceUtil;

import java.util.List;
import java.util.Optional;
import java.util.concurrent.Future;
import java.util.ArrayList;

/**
 * Ø³Ø±ÙˆÛŒØ³ Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ - Ù„Ø§ÛŒÙ‡ Ù…Ù†Ø·Ù‚ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±
 * Ø§ÛŒÙ† Ú©Ù„Ø§Ø³ Ù…Ø³Ø¦ÙˆÙ„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ù†Ø·Ù‚ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§Ø³Øª
 * Ø´Ø§Ù…Ù„ Ø«Ø¨ØªØŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒØŒ Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ùˆ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ù‡ÛŒÙ†Ù‡ Ø¨Ø§ caching
 */
public class RestaurantService {
    
    // repository Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±Ø³ØªÙˆØ±Ø§Ù†
    private final RestaurantRepository restaurantRepository;
    
    /**
     * Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ - Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÙˆÙ†Ù‡ repository
     */
<span class="nc" id="L26">    public RestaurantService() {</span>
<span class="nc" id="L27">        this.restaurantRepository = new RestaurantRepository();</span>
<span class="nc" id="L28">    }</span>
    
    /**
     * Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ²Ø±ÛŒÙ‚ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± ØªØ³Øª)
     * 
     * @param restaurantRepository repository Ø±Ø³ØªÙˆØ±Ø§Ù†
     */
<span class="fc" id="L35">    public RestaurantService(RestaurantRepository restaurantRepository) {</span>
<span class="fc" id="L36">        this.restaurantRepository = restaurantRepository;</span>
<span class="fc" id="L37">    }</span>
    
    /**
     * Ø«Ø¨Øª Ø±Ø³ØªÙˆØ±Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ø³ÛŒØ³ØªÙ…
     * Ø±Ø³ØªÙˆØ±Ø§Ù† Ø¨Ø§ ÙˆØ¶Ø¹ÛŒØª PENDING Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…Ù†ØªØ¸Ø± ØªØ£ÛŒÛŒØ¯ Ù…Ø¯ÛŒØ± Ø§Ø³Øª
     * 
     * @param ownerId Ø´Ù†Ø§Ø³Ù‡ Ù…Ø§Ù„Ú© Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @param name Ù†Ø§Ù… Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @param address Ø¢Ø¯Ø±Ø³ Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @param phone Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @return Ø±Ø³ØªÙˆØ±Ø§Ù† Ø«Ø¨Øª Ø´Ø¯Ù‡
     * @throws IllegalArgumentException Ø¯Ø± ØµÙˆØ±Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
     */
    public Restaurant registerRestaurant(Long ownerId, String name, String address, String phone) {
        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
<span class="fc" id="L52">        validateRegistrationInput(ownerId, name, address, phone);</span>
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø³ØªÙˆØ±Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ trim Ú©Ø±Ø¯Ù† Ø±Ø´ØªÙ‡â€ŒÙ‡Ø§
<span class="fc" id="L55">        Restaurant restaurant = new Restaurant(ownerId, name.trim(), address.trim(), phone.trim());</span>
<span class="fc" id="L56">        return restaurantRepository.saveNew(restaurant);</span>
    }
    
    /**
     * Ø«Ø¨Øª Ø±Ø³ØªÙˆØ±Ø§Ù† Ø¨Ø§ Ø´ÛŒØ¡ Restaurant
     * Ø§ÛŒÙ† Ù…ØªØ¯ overload Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø±Ø§Ø­ØªÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª
     * 
     * @param restaurant Ø´ÛŒØ¡ Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @return Ø±Ø³ØªÙˆØ±Ø§Ù† Ø«Ø¨Øª Ø´Ø¯Ù‡
     * @throws IllegalArgumentException Ø¯Ø± ØµÙˆØ±Øª null Ø¨ÙˆØ¯Ù† Ø±Ø³ØªÙˆØ±Ø§Ù† ÛŒØ§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª
     */
    public Restaurant registerRestaurant(Restaurant restaurant) {
<span class="fc bfc" id="L68" title="All 2 branches covered.">        if (restaurant == null) {</span>
<span class="fc" id="L69">            throw new IllegalArgumentException(&quot;Restaurant cannot be null&quot;);</span>
        }
        
        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø³ØªÙˆØ±Ø§Ù†
<span class="fc" id="L73">        validateRegistrationInput(restaurant.getOwnerId(), restaurant.getName(), </span>
<span class="fc" id="L74">                                restaurant.getAddress(), restaurant.getPhone());</span>
        
        // ØªÙ†Ø¸ÛŒÙ… ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
<span class="fc bfc" id="L77" title="All 2 branches covered.">        if (restaurant.getStatus() == null) {</span>
<span class="fc" id="L78">            restaurant.setStatus(RestaurantStatus.PENDING);</span>
        }
        
<span class="fc" id="L81">        return restaurantRepository.saveNew(restaurant);</span>
    }
    
    /**
     * Ø¯Ø±ÛŒØ§ÙØª Ø±Ø³ØªÙˆØ±Ø§Ù† Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡
     * 
     * @param id Ø´Ù†Ø§Ø³Ù‡ Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @return Ø±Ø³ØªÙˆØ±Ø§Ù† ÛŒØ§ÙØª Ø´Ø¯Ù‡
     * @throws IllegalArgumentException Ø¯Ø± ØµÙˆØ±Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Ø´Ù†Ø§Ø³Ù‡
     * @throws NotFoundException Ø¯Ø± ØµÙˆØ±Øª ÛŒØ§ÙØª Ù†Ø´Ø¯Ù† Ø±Ø³ØªÙˆØ±Ø§Ù†
     */
    public Restaurant getRestaurantById(Long id) {
<span class="fc bfc" id="L93" title="All 4 branches covered.">        if (id == null || id &lt;= 0) {</span>
<span class="fc" id="L94">            throw new IllegalArgumentException(&quot;Restaurant ID must be positive&quot;);</span>
        }
        
<span class="fc" id="L97">        Optional&lt;Restaurant&gt; restaurant = restaurantRepository.findById(id);</span>
<span class="fc bfc" id="L98" title="All 2 branches covered.">        if (restaurant.isEmpty()) {</span>
<span class="fc" id="L99">            throw new NotFoundException(&quot;Restaurant&quot;, id);</span>
        }
        
<span class="fc" id="L102">        return restaurant.get();</span>
    }
    
    /**
     * Ø¯Ø±ÛŒØ§ÙØª Ù‡Ù…Ù‡ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…ØªØ¹Ù„Ù‚ Ø¨Ù‡ ÛŒÚ© Ù…Ø§Ù„Ú©
     * 
     * @param ownerId Ø´Ù†Ø§Ø³Ù‡ Ù…Ø§Ù„Ú©
     * @return Ù„ÛŒØ³Øª Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„Ú©
     * @throws IllegalArgumentException Ø¯Ø± ØµÙˆØ±Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Ø´Ù†Ø§Ø³Ù‡ Ù…Ø§Ù„Ú©
     */
    public List&lt;Restaurant&gt; getRestaurantsByOwner(Long ownerId) {
<span class="pc bpc" id="L113" title="1 of 4 branches missed.">        if (ownerId == null || ownerId &lt;= 0) {</span>
<span class="fc" id="L114">            throw new IllegalArgumentException(&quot;Owner ID must be positive&quot;);</span>
        }
        
<span class="fc" id="L117">        return restaurantRepository.listByOwner(ownerId);</span>
    }
    
    /**
     * Ø¯Ø±ÛŒØ§ÙØª Ù‡Ù…Ù‡ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ (Ù†Ù…Ø§ÛŒØ´ Ø¹Ù…ÙˆÙ…ÛŒ) - Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø¨Ø§ caching
     * Ø§ÛŒÙ† Ù…ØªØ¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ Ø¯Ø± ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
     * 
     * @return Ù„ÛŒØ³Øª Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡
     */
    public List&lt;Restaurant&gt; getApprovedRestaurants() {
<span class="fc" id="L127">        String cacheKey = PerformanceUtil.createQueryCacheKey(&quot;approved_restaurants&quot;);</span>
        
<span class="fc" id="L129">        return PerformanceUtil.executeWithCache(</span>
            cacheKey,
            () -&gt; {
                // Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¹Ù…Ù„ÛŒØ§Øª Ø¯ÛŒØªØ§Ø¨ÛŒØ³
<span class="fc" id="L133">                PerformanceUtil.PerformanceResult&lt;List&lt;Restaurant&gt;&gt; result = </span>
<span class="fc" id="L134">                    PerformanceUtil.measurePerformance(&quot;getApprovedRestaurants&quot;, </span>
<span class="fc" id="L135">                        () -&gt; restaurantRepository.listApproved());</span>
                
                // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø§ emoji
<span class="fc" id="L138">                System.out.println(&quot;ğŸª &quot; + result.toString());</span>
<span class="fc" id="L139">                return result.getResult();</span>
            },
            List.class,
            15 // Cache Ø¨Ø±Ø§ÛŒ 15 Ø¯Ù‚ÛŒÙ‚Ù‡
        );
    }
    
    /**
     * Ø¯Ø±ÛŒØ§ÙØª Ù‡Ù…Ù‡ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±Ø§Ù†)
     * 
     * @return Ù„ÛŒØ³Øª Ù‡Ù…Ù‡ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§
     */
    public List&lt;Restaurant&gt; getAllRestaurants() {
<span class="fc" id="L152">        return restaurantRepository.findAll();</span>
    }
    
    /**
     * Ø¯Ø±ÛŒØ§ÙØª Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª
     * 
     * @param status ÙˆØ¶Ø¹ÛŒØª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± (PENDING, APPROVED, REJECTED, SUSPENDED)
     * @return Ù„ÛŒØ³Øª Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ Ø¨Ø§ ÙˆØ¶Ø¹ÛŒØª Ù…Ø´Ø®Øµ
     * @throws IllegalArgumentException Ø¯Ø± ØµÙˆØ±Øª null Ø¨ÙˆØ¯Ù† ÙˆØ¶Ø¹ÛŒØª
     */
    public List&lt;Restaurant&gt; getRestaurantsByStatus(RestaurantStatus status) {
<span class="fc bfc" id="L163" title="All 2 branches covered.">        if (status == null) {</span>
<span class="fc" id="L164">            throw new IllegalArgumentException(&quot;Status cannot be null&quot;);</span>
        }
        
<span class="fc" id="L167">        return restaurantRepository.findByStatus(status);</span>
    }
    
    /**
     * Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø±Ø³ØªÙˆØ±Ø§Ù† (Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ)
     * ÙÙ‚Ø· Ù…Ø¯ÛŒØ±Ø§Ù† Ø§Ø¬Ø§Ø²Ù‡ ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø§Ø±Ù†Ø¯
     * 
     * @param id Ø´Ù†Ø§Ø³Ù‡ Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @param status ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¯ÛŒØ¯
     * @throws IllegalArgumentException Ø¯Ø± ØµÙˆØ±Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§
     * @throws NotFoundException Ø¯Ø± ØµÙˆØ±Øª ÛŒØ§ÙØª Ù†Ø´Ø¯Ù† Ø±Ø³ØªÙˆØ±Ø§Ù†
     */
    public void updateRestaurantStatus(Long id, RestaurantStatus status) {
<span class="pc bpc" id="L180" title="1 of 4 branches missed.">        if (id == null || id &lt;= 0) {</span>
<span class="fc" id="L181">            throw new IllegalArgumentException(&quot;Restaurant ID must be positive&quot;);</span>
        }
<span class="fc bfc" id="L183" title="All 2 branches covered.">        if (status == null) {</span>
<span class="fc" id="L184">            throw new IllegalArgumentException(&quot;Status cannot be null&quot;);</span>
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø±Ø³ØªÙˆØ±Ø§Ù†
<span class="fc" id="L188">        getRestaurantById(id);</span>
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
<span class="fc" id="L191">        restaurantRepository.updateStatus(id, status);</span>
<span class="fc" id="L192">    }</span>
    
    /**
     * Update restaurant information
     */
    public Restaurant updateRestaurant(Long id, String name, String address, String phone) {
<span class="pc bpc" id="L198" title="1 of 4 branches missed.">        if (id == null || id &lt;= 0) {</span>
<span class="fc" id="L199">            throw new IllegalArgumentException(&quot;Restaurant ID must be positive&quot;);</span>
        }
        
<span class="fc" id="L202">        Restaurant existingRestaurant = getRestaurantById(id);</span>
        
        // Update fields if provided
<span class="pc bpc" id="L205" title="1 of 4 branches missed.">        if (name != null &amp;&amp; !name.trim().isEmpty()) {</span>
<span class="fc bfc" id="L206" title="All 2 branches covered.">            if (name.trim().length() &gt; 100) {</span>
<span class="fc" id="L207">                throw new IllegalArgumentException(&quot;Restaurant name cannot exceed 100 characters&quot;);</span>
            }
<span class="fc" id="L209">            existingRestaurant.setName(name.trim());</span>
        }
        
<span class="fc bfc" id="L212" title="All 4 branches covered.">        if (address != null &amp;&amp; !address.trim().isEmpty()) {</span>
<span class="fc bfc" id="L213" title="All 2 branches covered.">            if (address.trim().length() &gt; 200) {</span>
<span class="fc" id="L214">                throw new IllegalArgumentException(&quot;Restaurant address cannot exceed 200 characters&quot;);</span>
            }
<span class="fc" id="L216">            existingRestaurant.setAddress(address.trim());</span>
        }
        
<span class="fc bfc" id="L219" title="All 4 branches covered.">        if (phone != null &amp;&amp; !phone.trim().isEmpty()) {</span>
<span class="fc bfc" id="L220" title="All 2 branches covered.">            if (phone.trim().length() &gt; 20) {</span>
<span class="fc" id="L221">                throw new IllegalArgumentException(&quot;Restaurant phone cannot exceed 20 characters&quot;);</span>
            }
<span class="fc" id="L223">            existingRestaurant.setPhone(phone.trim());</span>
        }
        
<span class="fc" id="L226">        return restaurantRepository.save(existingRestaurant);</span>
    }
    
    /**
     * Update restaurant with Restaurant object
     */
    public Restaurant updateRestaurant(Restaurant restaurant) {
<span class="fc bfc" id="L233" title="All 2 branches covered.">        if (restaurant == null) {</span>
<span class="fc" id="L234">            throw new IllegalArgumentException(&quot;Restaurant cannot be null&quot;);</span>
        }
<span class="pc bpc" id="L236" title="1 of 4 branches missed.">        if (restaurant.getId() == null || restaurant.getId() &lt;= 0) {</span>
<span class="fc" id="L237">            throw new IllegalArgumentException(&quot;Restaurant ID must be positive&quot;);</span>
        }
        
        // Get existing restaurant to preserve all fields
<span class="fc" id="L241">        Restaurant existingRestaurant = getRestaurantById(restaurant.getId());</span>
        
        // Update only the provided fields
<span class="pc bpc" id="L244" title="2 of 4 branches missed.">        if (restaurant.getName() != null &amp;&amp; !restaurant.getName().trim().isEmpty()) {</span>
<span class="pc bpc" id="L245" title="1 of 2 branches missed.">            if (restaurant.getName().trim().length() &gt; 100) {</span>
<span class="nc" id="L246">                throw new IllegalArgumentException(&quot;Restaurant name cannot exceed 100 characters&quot;);</span>
            }
<span class="fc" id="L248">            existingRestaurant.setName(restaurant.getName().trim());</span>
        }
        
<span class="pc bpc" id="L251" title="2 of 4 branches missed.">        if (restaurant.getAddress() != null &amp;&amp; !restaurant.getAddress().trim().isEmpty()) {</span>
<span class="pc bpc" id="L252" title="1 of 2 branches missed.">            if (restaurant.getAddress().trim().length() &gt; 200) {</span>
<span class="nc" id="L253">                throw new IllegalArgumentException(&quot;Restaurant address cannot exceed 200 characters&quot;);</span>
            }
<span class="fc" id="L255">            existingRestaurant.setAddress(restaurant.getAddress().trim());</span>
        }
        
<span class="pc bpc" id="L258" title="2 of 4 branches missed.">        if (restaurant.getPhone() != null &amp;&amp; !restaurant.getPhone().trim().isEmpty()) {</span>
<span class="pc bpc" id="L259" title="1 of 2 branches missed.">            if (restaurant.getPhone().trim().length() &gt; 20) {</span>
<span class="nc" id="L260">                throw new IllegalArgumentException(&quot;Restaurant phone cannot exceed 20 characters&quot;);</span>
            }
<span class="fc" id="L262">            existingRestaurant.setPhone(restaurant.getPhone().trim());</span>
        }
        
        // Preserve ownerId and status from existing restaurant
        // (they should not be updated via this method)
        
<span class="fc" id="L268">        return restaurantRepository.save(existingRestaurant);</span>
    }
    
    /**
     * Delete restaurant
     */
    public void deleteRestaurant(Long id) {
<span class="fc bfc" id="L275" title="All 4 branches covered.">        if (id == null || id &lt;= 0) {</span>
<span class="fc" id="L276">            throw new IllegalArgumentException(&quot;Restaurant ID must be positive&quot;);</span>
        }
        
        // Verify restaurant exists
<span class="fc" id="L280">        getRestaurantById(id);</span>
        
<span class="fc" id="L282">        restaurantRepository.delete(id);</span>
<span class="fc" id="L283">    }</span>
    
    /**
     * Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø±Ø³ØªÙˆØ±Ø§Ù† Ø¨Ø§ Ø´Ù†Ø§Ø³Ù‡
     * 
     * @param id Ø´Ù†Ø§Ø³Ù‡ Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @return true Ø§Ú¯Ø± Ø±Ø³ØªÙˆØ±Ø§Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
     */
    public boolean existsById(Long id) {
<span class="fc bfc" id="L292" title="All 4 branches covered.">        if (id == null || id &lt;= 0) {</span>
<span class="fc" id="L293">            return false;</span>
        }
        
<span class="fc" id="L296">        return restaurantRepository.findById(id).isPresent();</span>
    }
    
    /**
     * Ø¯Ø±ÛŒØ§ÙØª Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯ (Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±Ø§Ù†)
     * 
     * @return Ù„ÛŒØ³Øª Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ÛŒ PENDING
     */
    public List&lt;Restaurant&gt; getPendingRestaurants() {
<span class="fc" id="L305">        return restaurantRepository.findByStatus(RestaurantStatus.PENDING);</span>
    }
    
    /**
     * ØªØ£ÛŒÛŒØ¯ Ø±Ø³ØªÙˆØ±Ø§Ù† - ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡ APPROVED
     * 
     * @param id Ø´Ù†Ø§Ø³Ù‡ Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @throws IllegalArgumentException Ø¯Ø± ØµÙˆØ±Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Ø´Ù†Ø§Ø³Ù‡
     * @throws NotFoundException Ø¯Ø± ØµÙˆØ±Øª ÛŒØ§ÙØª Ù†Ø´Ø¯Ù† Ø±Ø³ØªÙˆØ±Ø§Ù†
     */
    public void approveRestaurant(Long id) {
<span class="fc" id="L316">        updateRestaurantStatus(id, RestaurantStatus.APPROVED);</span>
<span class="fc" id="L317">    }</span>
    
    /**
     * Ø±Ø¯ Ø±Ø³ØªÙˆØ±Ø§Ù† - ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡ REJECTED
     * 
     * @param id Ø´Ù†Ø§Ø³Ù‡ Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @throws IllegalArgumentException Ø¯Ø± ØµÙˆØ±Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Ø´Ù†Ø§Ø³Ù‡
     * @throws NotFoundException Ø¯Ø± ØµÙˆØ±Øª ÛŒØ§ÙØª Ù†Ø´Ø¯Ù† Ø±Ø³ØªÙˆØ±Ø§Ù†
     */
    public void rejectRestaurant(Long id) {
<span class="fc" id="L327">        updateRestaurantStatus(id, RestaurantStatus.REJECTED);</span>
<span class="fc" id="L328">    }</span>
    
    /**
     * ØªØ¹Ù„ÛŒÙ‚ Ø±Ø³ØªÙˆØ±Ø§Ù† - ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡ SUSPENDED
     * 
     * @param id Ø´Ù†Ø§Ø³Ù‡ Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @throws IllegalArgumentException Ø¯Ø± ØµÙˆØ±Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Ø´Ù†Ø§Ø³Ù‡
     * @throws NotFoundException Ø¯Ø± ØµÙˆØ±Øª ÛŒØ§ÙØª Ù†Ø´Ø¯Ù† Ø±Ø³ØªÙˆØ±Ø§Ù†
     */
    public void suspendRestaurant(Long id) {
<span class="fc" id="L338">        updateRestaurantStatus(id, RestaurantStatus.SUSPENDED);</span>
<span class="fc" id="L339">    }</span>
    
    /**
     * Bulk update restaurant statuses - Optimized with async processing
     */
    public Future&lt;Void&gt; bulkUpdateRestaurantStatus(List&lt;Long&gt; restaurantIds, RestaurantStatus status) {
<span class="nc bnc" id="L345" title="All 4 branches missed.">        if (restaurantIds == null || restaurantIds.isEmpty()) {</span>
<span class="nc" id="L346">            throw new IllegalArgumentException(&quot;Restaurant IDs cannot be null or empty&quot;);</span>
        }
<span class="nc bnc" id="L348" title="All 2 branches missed.">        if (status == null) {</span>
<span class="nc" id="L349">            throw new IllegalArgumentException(&quot;Status cannot be null&quot;);</span>
        }
        
<span class="nc" id="L352">        return PerformanceUtil.executeAsync(() -&gt; {</span>
<span class="nc" id="L353">            PerformanceUtil.measurePerformance(&quot;bulkUpdateRestaurantStatus&quot;, () -&gt; {</span>
                // Process in batches of 50
<span class="nc" id="L355">                PerformanceUtil.processBatch(restaurantIds, 50, batch -&gt; {</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">                    for (Long id : batch) {</span>
                        try {
<span class="nc" id="L358">                            updateRestaurantStatus(id, status);</span>
<span class="nc" id="L359">                        } catch (Exception e) {</span>
<span class="nc" id="L360">                            System.err.println(&quot;Failed to update restaurant &quot; + id + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L361">                        }</span>
<span class="nc" id="L362">                    }</span>
<span class="nc" id="L363">                    return new ArrayList&lt;&gt;(); // Return empty list as required by Function interface</span>
                });
                
                // Clear relevant caches after bulk update
<span class="nc" id="L367">                clearRestaurantCaches();</span>
<span class="nc" id="L368">                return null;</span>
            });
<span class="nc" id="L370">        });</span>
    }
    
    /**
     * Bulk approve restaurants - Optimized async operation
     */
    public Future&lt;Void&gt; bulkApproveRestaurants(List&lt;Long&gt; restaurantIds) {
<span class="nc" id="L377">        return bulkUpdateRestaurantStatus(restaurantIds, RestaurantStatus.APPROVED);</span>
    }
    
    /**
     * Clear restaurant-related caches after data modifications
     */
    private void clearRestaurantCaches() {
        // Clear specific cache keys
<span class="nc" id="L385">        String approvedKey = PerformanceUtil.createQueryCacheKey(&quot;approved_restaurants&quot;);</span>
<span class="nc" id="L386">        String statsKey = PerformanceUtil.createQueryCacheKey(&quot;restaurant_statistics&quot;);</span>
        
        // Note: PerformanceUtil doesn't have specific key removal, so we'd need to add that
        // For now, we can force a cache cleanup
<span class="nc" id="L390">        PerformanceUtil.cleanExpiredEntries();</span>
<span class="nc" id="L391">    }</span>
    
    /**
     * Get restaurant statistics - Optimized with caching and performance monitoring
     */
    public RestaurantStatistics getRestaurantStatistics() {
<span class="fc" id="L397">        String cacheKey = PerformanceUtil.createQueryCacheKey(&quot;restaurant_statistics&quot;);</span>
        
<span class="fc" id="L399">        return PerformanceUtil.executeWithCache(</span>
            cacheKey,
            () -&gt; {
<span class="fc" id="L402">                return PerformanceUtil.measurePerformance(&quot;calculateRestaurantStatistics&quot;, () -&gt; {</span>
<span class="fc" id="L403">                    return calculateRestaurantStatisticsInternal();</span>
<span class="fc" id="L404">                }).getResult();</span>
            },
            RestaurantStatistics.class,
            30 // Cache for 30 minutes
        );
    }
    
    /**
     * Calculate restaurant statistics without caching - for testing and internal use
     */
    private RestaurantStatistics calculateRestaurantStatisticsInternal() {
<span class="fc" id="L415">        List&lt;Restaurant&gt; allRestaurants = getAllRestaurants();</span>
        
        // Check memory usage before processing large dataset
<span class="pc bpc" id="L418" title="1 of 2 branches missed.">        if (PerformanceUtil.isMemoryUsageCritical()) {</span>
<span class="nc" id="L419">            PerformanceUtil.forceGarbageCollection();</span>
        }
        
<span class="fc" id="L422">        long totalCount = allRestaurants.size();</span>
<span class="fc" id="L423">        long approvedCount = allRestaurants.parallelStream()</span>
<span class="pc bnc" id="L424" title="All 2 branches missed.">                .filter(r -&gt; r.getStatus() == RestaurantStatus.APPROVED)</span>
<span class="fc" id="L425">                .count();</span>
<span class="fc" id="L426">        long pendingCount = allRestaurants.parallelStream()</span>
<span class="pc bnc" id="L427" title="All 2 branches missed.">                .filter(r -&gt; r.getStatus() == RestaurantStatus.PENDING)</span>
<span class="fc" id="L428">                .count();</span>
<span class="fc" id="L429">        long rejectedCount = allRestaurants.parallelStream()</span>
<span class="pc bnc" id="L430" title="All 2 branches missed.">                .filter(r -&gt; r.getStatus() == RestaurantStatus.REJECTED)</span>
<span class="fc" id="L431">                .count();</span>
<span class="fc" id="L432">        long suspendedCount = allRestaurants.parallelStream()</span>
<span class="pc bnc" id="L433" title="All 2 branches missed.">                .filter(r -&gt; r.getStatus() == RestaurantStatus.SUSPENDED)</span>
<span class="fc" id="L434">                .count();</span>
        
<span class="fc" id="L436">        return new RestaurantStatistics(totalCount, approvedCount, pendingCount, </span>
                                      rejectedCount, suspendedCount);
    }
    
    // Ù…ØªØ¯Ù‡Ø§ÛŒ Ø®ØµÙˆØµÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
    
    /**
     * Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø±Ø³ØªÙˆØ±Ø§Ù†
     * Ø¨Ø±Ø±Ø³ÛŒ ØªÙ…Ø§Ù… Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø³ØªÙˆØ±Ø§Ù†
     * 
     * @param ownerId Ø´Ù†Ø§Ø³Ù‡ Ù…Ø§Ù„Ú© Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @param name Ù†Ø§Ù… Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @param address Ø¢Ø¯Ø±Ø³ Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @param phone Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø±Ø³ØªÙˆØ±Ø§Ù†
     * @throws IllegalArgumentException Ø¯Ø± ØµÙˆØ±Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Ù‡Ø± Ú©Ø¯Ø§Ù… Ø§Ø² ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
     */
    private void validateRegistrationInput(Long ownerId, String name, String address, String phone) {
        // Ø¨Ø±Ø±Ø³ÛŒ Ø´Ù†Ø§Ø³Ù‡ Ù…Ø§Ù„Ú©
<span class="fc bfc" id="L454" title="All 4 branches covered.">        if (ownerId == null || ownerId &lt;= 0) {</span>
<span class="fc" id="L455">            throw new IllegalArgumentException(&quot;Owner ID must be positive&quot;);</span>
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø§Ù… Ø±Ø³ØªÙˆØ±Ø§Ù†
<span class="fc bfc" id="L459" title="All 4 branches covered.">        if (name == null || name.trim().isEmpty()) {</span>
<span class="fc" id="L460">            throw new IllegalArgumentException(&quot;Restaurant name cannot be empty&quot;);</span>
        }
        
<span class="fc bfc" id="L463" title="All 2 branches covered.">        if (name.trim().length() &gt; 100) {</span>
<span class="fc" id="L464">            throw new IllegalArgumentException(&quot;Restaurant name cannot exceed 100 characters&quot;);</span>
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ø¯Ø±Ø³ Ø±Ø³ØªÙˆØ±Ø§Ù†
<span class="fc bfc" id="L468" title="All 4 branches covered.">        if (address == null || address.trim().isEmpty()) {</span>
<span class="fc" id="L469">            throw new IllegalArgumentException(&quot;Restaurant address cannot be empty&quot;);</span>
        }
        
<span class="fc bfc" id="L472" title="All 2 branches covered.">        if (address.trim().length() &gt; 200) {</span>
<span class="fc" id="L473">            throw new IllegalArgumentException(&quot;Restaurant address cannot exceed 200 characters&quot;);</span>
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†
<span class="fc bfc" id="L477" title="All 4 branches covered.">        if (phone == null || phone.trim().isEmpty()) {</span>
<span class="fc" id="L478">            throw new IllegalArgumentException(&quot;Restaurant phone cannot be empty&quot;);</span>
        }
        
<span class="fc bfc" id="L481" title="All 2 branches covered.">        if (phone.trim().length() &gt; 20) {</span>
<span class="fc" id="L482">            throw new IllegalArgumentException(&quot;Restaurant phone cannot exceed 20 characters&quot;);</span>
        }
<span class="fc" id="L484">    }</span>
    
    // Ú©Ù„Ø§Ø³ Ø¯Ø§Ø®Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢Ù…Ø§Ø± Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§
    
    /**
     * Ú©Ù„Ø§Ø³ Ø¢Ù…Ø§Ø± Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§
     * Ø­Ø§ÙˆÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®Ù„Ø§ØµÙ‡ Ø§Ø² ÙˆØ¶Ø¹ÛŒØª Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ Ø¯Ø± Ø³ÛŒØ³ØªÙ…
     */
    public static class RestaurantStatistics {
        private final long totalCount;      // ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§
        private final long approvedCount;   // ØªØ¹Ø¯Ø§Ø¯ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡
        private final long pendingCount;    // ØªØ¹Ø¯Ø§Ø¯ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
        private final long rejectedCount;   // ØªØ¹Ø¯Ø§Ø¯ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø±Ø¯ Ø´Ø¯Ù‡
        private final long suspendedCount;  // ØªØ¹Ø¯Ø§Ø¯ Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§ÛŒ ØªØ¹Ù„ÛŒÙ‚ Ø´Ø¯Ù‡
        
        /**
         * Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¢Ù…Ø§Ø± Ø±Ø³ØªÙˆØ±Ø§Ù†â€ŒÙ‡Ø§
         * 
         * @param totalCount ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„
         * @param approvedCount ØªØ¹Ø¯Ø§Ø¯ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡
         * @param pendingCount ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
         * @param rejectedCount ØªØ¹Ø¯Ø§Ø¯ Ø±Ø¯ Ø´Ø¯Ù‡
         * @param suspendedCount ØªØ¹Ø¯Ø§Ø¯ ØªØ¹Ù„ÛŒÙ‚ Ø´Ø¯Ù‡
         */
        public RestaurantStatistics(long totalCount, long approvedCount, long pendingCount,
<span class="fc" id="L509">                                  long rejectedCount, long suspendedCount) {</span>
<span class="fc" id="L510">            this.totalCount = totalCount;</span>
<span class="fc" id="L511">            this.approvedCount = approvedCount;</span>
<span class="fc" id="L512">            this.pendingCount = pendingCount;</span>
<span class="fc" id="L513">            this.rejectedCount = rejectedCount;</span>
<span class="fc" id="L514">            this.suspendedCount = suspendedCount;</span>
<span class="fc" id="L515">        }</span>
        
        // Getter methods Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¢Ù…Ø§Ø±
<span class="fc" id="L518">        public long getTotalCount() { return totalCount; }</span>
<span class="fc" id="L519">        public long getApprovedCount() { return approvedCount; }</span>
<span class="fc" id="L520">        public long getPendingCount() { return pendingCount; }</span>
<span class="fc" id="L521">        public long getRejectedCount() { return rejectedCount; }</span>
<span class="fc" id="L522">        public long getSuspendedCount() { return suspendedCount; }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>