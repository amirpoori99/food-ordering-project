<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MapParsingUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Food Ordering Backend</a> &gt; <a href="index.source.html" class="el_package">com.myapp.common.utils</a> &gt; <span class="el_source">MapParsingUtil.java</span></div><h1>MapParsingUtil.java</h1><pre class="source lang-java linenums">package com.myapp.common.utils;

import java.util.Map;

/**
 * کلاس ابزاری برای تجزیه مقادیر از Map با تبدیل نوع صحیح و اعتبارسنجی
 * این کلاس متدهای امنی برای دریافت انواع داده‌ها از Map فراهم می‌کند
 * شامل پشتیبانی از مقادیر اجباری، اختیاری و مقادیر پیش‌فرض
 */
<span class="nc" id="L10">public class MapParsingUtil {</span>
    
    /**
     * دریافت مقدار رشته‌ای اجباری از Map
     * 
     * @param map نقشه حاوی داده‌ها
     * @param key کلید مورد نظر
     * @return مقدار رشته‌ای تمیز شده
     * @throws IllegalArgumentException اگر کلید موجود نباشد یا null باشد
     */
    public static String getStringFromMap(Map&lt;String, Object&gt; map, String key) {
<span class="fc" id="L21">        Object value = map.get(key);</span>
<span class="fc bfc" id="L22" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L23">            throw new IllegalArgumentException(&quot;فیلد اجباری موجود نیست: &quot; + key);</span>
        }
<span class="fc" id="L25">        return value.toString().trim();</span>
    }
    
    /**
     * دریافت مقدار رشته‌ای اختیاری از Map با مقدار پیش‌فرض
     * 
     * @param map نقشه حاوی داده‌ها
     * @param key کلید مورد نظر
     * @param defaultValue مقدار پیش‌فرض در صورت نبودن کلید
     * @return مقدار رشته‌ای یا مقدار پیش‌فرض
     */
    public static String getOptionalStringFromMap(Map&lt;String, Object&gt; map, String key, String defaultValue) {
<span class="fc" id="L37">        Object value = map.get(key);</span>
<span class="fc bfc" id="L38" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L39">            return defaultValue;</span>
        }
<span class="fc" id="L41">        String stringValue = value.toString().trim();</span>
<span class="pc bpc" id="L42" title="1 of 2 branches missed.">        return stringValue.isEmpty() ? defaultValue : stringValue;</span>
    }
    
    /**
     * دریافت مقدار Long اجباری از Map
     * 
     * @param map نقشه حاوی داده‌ها
     * @param key کلید مورد نظر
     * @return مقدار Long
     * @throws IllegalArgumentException اگر کلید موجود نباشد یا فرمت نامعتبر باشد
     */
    public static Long getLongFromMap(Map&lt;String, Object&gt; map, String key) {
<span class="fc" id="L54">        Object value = map.get(key);</span>
<span class="fc bfc" id="L55" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L56">            throw new IllegalArgumentException(&quot;فیلد اجباری موجود نیست: &quot; + key);</span>
        }
        
<span class="fc bfc" id="L59" title="All 2 branches covered.">        if (value instanceof Number) {</span>
<span class="fc" id="L60">            return ((Number) value).longValue();</span>
        }
        
        try {
<span class="fc" id="L64">            return Long.parseLong(value.toString().trim());</span>
<span class="nc" id="L65">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L66">            throw new IllegalArgumentException(&quot;فرمت عددی نامعتبر برای &quot; + key + &quot;: &quot; + value);</span>
        }
    }
    
    /**
     * دریافت مقدار Long اختیاری از Map با مقدار پیش‌فرض
     * 
     * @param map نقشه حاوی داده‌ها
     * @param key کلید مورد نظر
     * @param defaultValue مقدار پیش‌فرض در صورت نبودن کلید
     * @return مقدار Long یا مقدار پیش‌فرض
     */
    public static Long getOptionalLongFromMap(Map&lt;String, Object&gt; map, String key, Long defaultValue) {
<span class="fc" id="L79">        Object value = map.get(key);</span>
<span class="fc bfc" id="L80" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L81">            return defaultValue;</span>
        }
        
<span class="pc bpc" id="L84" title="1 of 2 branches missed.">        if (value instanceof Number) {</span>
<span class="fc" id="L85">            return ((Number) value).longValue();</span>
        }
        
        try {
<span class="nc" id="L89">            return Long.parseLong(value.toString().trim());</span>
<span class="nc" id="L90">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L91">            return defaultValue;</span>
        }
    }
    
    /**
     * دریافت مقدار Double اجباری از Map
     * 
     * @param map نقشه حاوی داده‌ها
     * @param key کلید مورد نظر
     * @return مقدار Double
     * @throws IllegalArgumentException اگر کلید موجود نباشد یا فرمت نامعتبر باشد
     */
    public static Double getDoubleFromMap(Map&lt;String, Object&gt; map, String key) {
<span class="fc" id="L104">        Object value = map.get(key);</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L106">            throw new IllegalArgumentException(&quot;فیلد اجباری موجود نیست: &quot; + key);</span>
        }
        
<span class="fc" id="L109">        return parseDoubleValue(value, key);</span>
    }
    
    /**
     * دریافت مقدار Double اختیاری از Map با مقدار پیش‌فرض
     * 
     * @param map نقشه حاوی داده‌ها
     * @param key کلید مورد نظر
     * @param defaultValue مقدار پیش‌فرض در صورت نبودن کلید
     * @return مقدار Double یا مقدار پیش‌فرض
     */
    public static Double getOptionalDoubleFromMap(Map&lt;String, Object&gt; map, String key, Double defaultValue) {
<span class="fc" id="L121">        Object value = map.get(key);</span>
<span class="fc bfc" id="L122" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L123">            return defaultValue;</span>
        }
        
        try {
<span class="fc" id="L127">            return parseDoubleValue(value, key);</span>
<span class="nc" id="L128">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L129">            return defaultValue;</span>
        }
    }
    
    /**
     * دریافت مقدار Integer اجباری از Map
     * 
     * @param map نقشه حاوی داده‌ها
     * @param key کلید مورد نظر
     * @return مقدار Integer
     * @throws IllegalArgumentException اگر کلید موجود نباشد یا فرمت نامعتبر باشد
     */
    public static Integer getIntegerFromMap(Map&lt;String, Object&gt; map, String key) {
<span class="fc" id="L142">        Object value = map.get(key);</span>
<span class="fc bfc" id="L143" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L144">            throw new IllegalArgumentException(&quot;فیلد اجباری موجود نیست: &quot; + key);</span>
        }
        
<span class="fc" id="L147">        return parseIntegerValue(value, key);</span>
    }
    
    /**
     * دریافت مقدار Integer اختیاری از Map با مقدار پیش‌فرض
     * 
     * @param map نقشه حاوی داده‌ها
     * @param key کلید مورد نظر
     * @param defaultValue مقدار پیش‌فرض در صورت نبودن کلید
     * @return مقدار Integer یا مقدار پیش‌فرض
     */
    public static Integer getOptionalIntegerFromMap(Map&lt;String, Object&gt; map, String key, Integer defaultValue) {
<span class="fc" id="L159">        Object value = map.get(key);</span>
<span class="fc bfc" id="L160" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L161">            return defaultValue;</span>
        }
        
        try {
<span class="fc" id="L165">            return parseIntegerValue(value, key);</span>
<span class="nc" id="L166">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L167">            return defaultValue;</span>
        }
    }
    
    /**
     * دریافت مقدار Boolean اجباری از Map
     * 
     * @param map نقشه حاوی داده‌ها
     * @param key کلید مورد نظر
     * @return مقدار Boolean
     * @throws IllegalArgumentException اگر کلید موجود نباشد
     */
    public static Boolean getBooleanFromMap(Map&lt;String, Object&gt; map, String key) {
<span class="fc" id="L180">        Object value = map.get(key);</span>
<span class="fc bfc" id="L181" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L182">            throw new IllegalArgumentException(&quot;فیلد اجباری موجود نیست: &quot; + key);</span>
        }
        
<span class="fc bfc" id="L185" title="All 2 branches covered.">        if (value instanceof Boolean) {</span>
<span class="fc" id="L186">            return (Boolean) value;</span>
        }
        
<span class="fc" id="L189">        String stringValue = value.toString().trim().toLowerCase();</span>
<span class="pc bpc" id="L190" title="2 of 6 branches missed.">        return &quot;true&quot;.equals(stringValue) || &quot;1&quot;.equals(stringValue) || &quot;yes&quot;.equals(stringValue);</span>
    }
    
    /**
     * دریافت مقدار Boolean اختیاری از Map با مقدار پیش‌فرض
     * 
     * @param map نقشه حاوی داده‌ها
     * @param key کلید مورد نظر
     * @param defaultValue مقدار پیش‌فرض در صورت نبودن کلید
     * @return مقدار Boolean یا مقدار پیش‌فرض
     */
    public static Boolean getOptionalBooleanFromMap(Map&lt;String, Object&gt; map, String key, Boolean defaultValue) {
<span class="fc" id="L202">        Object value = map.get(key);</span>
<span class="fc bfc" id="L203" title="All 2 branches covered.">        if (value == null) {</span>
<span class="fc" id="L204">            return defaultValue;</span>
        }
        
<span class="pc bpc" id="L207" title="1 of 2 branches missed.">        if (value instanceof Boolean) {</span>
<span class="fc" id="L208">            return (Boolean) value;</span>
        }
        
<span class="nc" id="L211">        String stringValue = value.toString().trim().toLowerCase();</span>
<span class="nc bnc" id="L212" title="All 6 branches missed.">        return &quot;true&quot;.equals(stringValue) || &quot;1&quot;.equals(stringValue) || &quot;yes&quot;.equals(stringValue);</span>
    }
    
    /**
     * تجزیه مقدار Double با اعتبارسنجی مناسب
     * متد کمکی برای تبدیل انواع مختلف به Double
     * 
     * @param value مقدار برای تبدیل
     * @param key نام کلید برای پیام خطا
     * @return مقدار Double تبدیل شده
     * @throws IllegalArgumentException در صورت فرمت نامعتبر
     */
    private static Double parseDoubleValue(Object value, String key) {
<span class="fc bfc" id="L225" title="All 2 branches covered.">        if (value instanceof Double) {</span>
<span class="fc" id="L226">            return (Double) value;</span>
        }
<span class="pc bpc" id="L228" title="1 of 2 branches missed.">        if (value instanceof Float) {</span>
<span class="nc" id="L229">            return ((Float) value).doubleValue();</span>
        }
<span class="pc bpc" id="L231" title="1 of 2 branches missed.">        if (value instanceof Integer) {</span>
<span class="nc" id="L232">            return ((Integer) value).doubleValue();</span>
        }
<span class="pc bpc" id="L234" title="1 of 2 branches missed.">        if (value instanceof Long) {</span>
<span class="nc" id="L235">            return ((Long) value).doubleValue();</span>
        }
        
        try {
<span class="fc" id="L239">            return Double.parseDouble(value.toString().trim());</span>
<span class="nc" id="L240">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L241">            throw new IllegalArgumentException(&quot;فرمت عددی نامعتبر برای &quot; + key + &quot;: &quot; + value);</span>
        }
    }
    
    /**
     * تجزیه مقدار Integer با اعتبارسنجی مناسب
     * متد کمکی برای تبدیل انواع مختلف به Integer
     * 
     * @param value مقدار برای تبدیل
     * @param key نام کلید برای پیام خطا
     * @return مقدار Integer تبدیل شده
     * @throws IllegalArgumentException در صورت فرمت نامعتبر یا خارج از محدوده
     */
    private static Integer parseIntegerValue(Object value, String key) {
<span class="fc bfc" id="L255" title="All 2 branches covered.">        if (value instanceof Integer) {</span>
<span class="fc" id="L256">            return (Integer) value;</span>
        }
<span class="pc bpc" id="L258" title="1 of 2 branches missed.">        if (value instanceof Long) {</span>
<span class="nc" id="L259">            Long longValue = (Long) value;</span>
<span class="nc bnc" id="L260" title="All 4 branches missed.">            if (longValue &gt; Integer.MAX_VALUE || longValue &lt; Integer.MIN_VALUE) {</span>
<span class="nc" id="L261">                throw new IllegalArgumentException(&quot;مقدار خیلی بزرگ برای integer: &quot; + value);</span>
            }
<span class="nc" id="L263">            return longValue.intValue();</span>
        }
<span class="pc bpc" id="L265" title="2 of 4 branches missed.">        if (value instanceof Double || value instanceof Float) {</span>
<span class="nc" id="L266">            double doubleValue = ((Number) value).doubleValue();</span>
<span class="nc bnc" id="L267" title="All 6 branches missed.">            if (doubleValue != Math.floor(doubleValue) || doubleValue &gt; Integer.MAX_VALUE || doubleValue &lt; Integer.MIN_VALUE) {</span>
<span class="nc" id="L268">                throw new IllegalArgumentException(&quot;مقدار integer نامعتبر: &quot; + value);</span>
            }
<span class="nc" id="L270">            return (int) doubleValue;</span>
        }
        
        try {
<span class="fc" id="L274">            return Integer.parseInt(value.toString().trim());</span>
<span class="nc" id="L275">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L276">            throw new IllegalArgumentException(&quot;فرمت عددی نامعتبر برای &quot; + key + &quot;: &quot; + value);</span>
        }
    }
    
    /**
     * اعتبارسنجی وجود تمام فیلدهای اجباری در نقشه
     * 
     * @param map نقشه برای بررسی
     * @param requiredFields فیلدهای اجباری
     * @throws IllegalArgumentException اگر هر یک از فیلدهای اجباری موجود نباشد
     */
    public static void validateRequiredFields(Map&lt;String, Object&gt; map, String... requiredFields) {
<span class="fc bfc" id="L288" title="All 2 branches covered.">        for (String field : requiredFields) {</span>
<span class="pc bpc" id="L289" title="1 of 4 branches missed.">            if (!map.containsKey(field) || map.get(field) == null) {</span>
<span class="fc" id="L290">                throw new IllegalArgumentException(&quot;فیلد اجباری موجود نیست: &quot; + field);</span>
            }
        }
<span class="fc" id="L293">    }</span>
    
    /**
     * بررسی وجود کلید و داشتن مقدار غیر null
     * 
     * @param map نقشه برای بررسی
     * @param key کلید مورد نظر
     * @return true اگر کلید موجود و مقدار آن غیر null باشد
     */
    public static boolean hasValue(Map&lt;String, Object&gt; map, String key) {
<span class="fc bfc" id="L303" title="All 4 branches covered.">        return map.containsKey(key) &amp;&amp; map.get(key) != null;</span>
    }
} 
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>