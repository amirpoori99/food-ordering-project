<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Favorite.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Food Ordering Backend</a> &gt; <a href="index.source.html" class="el_package">com.myapp.common.models</a> &gt; <span class="el_source">Favorite.java</span></div><h1>Favorite.java</h1><pre class="source lang-java linenums">package com.myapp.common.models;

import jakarta.persistence.*;
import java.time.LocalDateTime;
import java.util.Objects;

/**
 * مدل علاقه‌مندی - نماینده رستوران‌های مورد علاقه کاربران
 * 
 * این کلاس سیستم مدیریت لیست رستوران‌های مورد علاقه را پیاده‌سازی می‌کند:
 * 
 * === ویژگی‌های کلیدی ===
 * - یک کاربر می‌تواند هر رستوران را فقط یک بار به علاقه‌مندی‌ها اضافه کند
 * - امکان اضافه کردن یادداشت شخصی برای هر رستوران
 * - ثبت زمان اضافه شدن به علاقه‌مندی‌ها
 * - Index بندی برای جستجوی سریع
 * - پشتیبانی از legacy constructors برای سازگاری
 * 
 * === قوانین کسب‌وکار ===
 * - محدودیت یکتایی: هر کاربر + رستوران فقط یک رکورد
 * - یادداشت‌ها حداکثر 500 کاراکتر
 * - زمان ایجاد به صورت خودکار ثبت می‌شود
 * 
 * === استفاده در سیستم ===
 * - نمایش فهرست رستوران‌های مورد علاقه کاربر
 * - پیشنهاد رستوران بر اساس علاقه‌مندی‌ها
 * - آمارگیری از محبوب‌ترین رستوران‌ها
 * 
 * @author Food Ordering System Team
 * @version 1.0
 * @since 2024
 */
@Entity
@Table(name = &quot;favorites&quot;, 
       uniqueConstraints = @UniqueConstraint(columnNames = {&quot;user_id&quot;, &quot;restaurant_id&quot;}),
       indexes = {
           @Index(name = &quot;idx_favorite_user&quot;, columnList = &quot;user_id&quot;),
           @Index(name = &quot;idx_favorite_restaurant&quot;, columnList = &quot;restaurant_id&quot;),
           @Index(name = &quot;idx_favorite_created&quot;, columnList = &quot;created_at&quot;)
       })
public class Favorite {
    
    /** شناسه یکتای علاقه‌مندی */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    /** کاربر صاحب علاقه‌مندی (رابطه چند‌به‌یک) */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = &quot;user_id&quot;, nullable = false)
    private User user;
    
    /** رستوران مورد علاقه (رابطه چند‌به‌یک) */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = &quot;restaurant_id&quot;, nullable = false)
    private Restaurant restaurant;
    
    /** زمان اضافه شدن به علاقه‌مندی‌ها */
    @Column(name = &quot;created_at&quot;, nullable = false)
    private LocalDateTime createdAt;
    
    /** یادداشت شخصی کاربر درباره رستوران (اختیاری، حداکثر 500 کاراکتر) */
    @Column(name = &quot;notes&quot;, length = 500)
    private String notes;

    // ==================== CONSTRUCTORS ====================
    
    /**
     * سازنده پیش‌فرض
     * زمان ایجاد را به زمان فعلی تنظیم می‌کند
     */
<span class="fc" id="L72">    public Favorite() {</span>
<span class="fc" id="L73">        this.createdAt = LocalDateTime.now();</span>
<span class="fc" id="L74">    }</span>
    
    /**
     * سازنده ساده با کاربر و رستوران
     * 
     * @param user کاربر صاحب علاقه‌مندی
     * @param restaurant رستوران مورد علاقه
     */
    public Favorite(User user, Restaurant restaurant) {
<span class="fc" id="L83">        this();</span>
<span class="fc" id="L84">        this.user = user;</span>
<span class="fc" id="L85">        this.restaurant = restaurant;</span>
<span class="fc" id="L86">    }</span>
    
    /**
     * سازنده کامل با یادداشت
     * 
     * @param user کاربر صاحب علاقه‌مندی
     * @param restaurant رستوران مورد علاقه
     * @param notes یادداشت شخصی
     */
    public Favorite(User user, Restaurant restaurant, String notes) {
<span class="fc" id="L96">        this(user, restaurant);</span>
<span class="fc" id="L97">        this.notes = notes;</span>
<span class="fc" id="L98">    }</span>
    
    /**
     * سازنده سازگاری قدیمی
     * برای حفظ سازگاری با تست‌های قبلی
     * 
     * @param userId شناسه کاربر
     * @param restaurantId شناسه رستوران
     * @param createdAt زمان ایجاد
     * @deprecated استفاده از سازنده‌های دیگر توصیه می‌شود
     */
    @Deprecated
<span class="nc" id="L110">    public Favorite(long userId, long restaurantId, java.time.Instant createdAt) {</span>
<span class="nc" id="L111">        this.createdAt = LocalDateTime.ofInstant(createdAt, java.time.ZoneOffset.UTC);</span>
        // توجه: اشیاء User و Restaurant باید جداگانه تنظیم شوند
<span class="nc" id="L113">    }</span>

    // ==================== BUSINESS LOGIC METHODS ====================
    
    /**
     * به‌روزرسانی یادداشت شخصی
     * 
     * یادداشت‌ها به 500 کاراکتر محدود می‌شوند
     * 
     * @param notes یادداشت جدید
     */
    public void updateNotes(String notes) {
<span class="pc bpc" id="L125" title="2 of 4 branches missed.">        this.notes = notes != null &amp;&amp; notes.trim().length() &gt; 500 </span>
<span class="nc" id="L126">            ? notes.trim().substring(0, 500) </span>
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">            : (notes != null ? notes.trim() : null);</span>
<span class="fc" id="L128">    }</span>
    
    /**
     * بررسی وجود یادداشت
     * 
     * @return true اگر یادداشت غیر خالی داشته باشد
     */
    public boolean hasNotes() {
<span class="pc bpc" id="L136" title="1 of 4 branches missed.">        return notes != null &amp;&amp; !notes.trim().isEmpty();</span>
    }
    
    /**
     * بررسی جدید بودن علاقه‌مندی (طی 30 روز گذشته)
     * 
     * @return true اگر علاقه‌مندی جدید باشد
     */
    public boolean isRecent() {
<span class="fc" id="L145">        return createdAt.isAfter(LocalDateTime.now().minusDays(30));</span>
    }
    
    /**
     * دریافت تاریخ ایجاد در قالب قابل نمایش
     * 
     * @return رشته نمایش تاریخ و زمان
     */
    public String getCreatedAtFormatted() {
<span class="fc" id="L154">        return createdAt.format(java.time.format.DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm&quot;));</span>
    }

    // ==================== LIFECYCLE CALLBACKS ====================
    
    /**
     * فراخوانی قبل از ذخیره در دیتابیس
     * تنظیم زمان ایجاد در صورت عدم وجود
     */
    @PrePersist
    protected void onCreate() {
<span class="pc bpc" id="L165" title="1 of 2 branches missed.">        if (createdAt == null) {</span>
<span class="nc" id="L166">            createdAt = LocalDateTime.now();</span>
        }
<span class="fc" id="L168">    }</span>

    // ==================== GETTERS AND SETTERS ====================
    
    /** @return شناسه علاقه‌مندی */
<span class="fc" id="L173">    public Long getId() { return id; }</span>
<span class="fc" id="L174">    public void setId(Long id) { this.id = id; }</span>

    /** @return کاربر صاحب علاقه‌مندی */
<span class="fc" id="L177">    public User getUser() { return user; }</span>
<span class="fc" id="L178">    public void setUser(User user) { this.user = user; }</span>

    /** @return رستوران مورد علاقه */
<span class="fc" id="L181">    public Restaurant getRestaurant() { return restaurant; }</span>
<span class="fc" id="L182">    public void setRestaurant(Restaurant restaurant) { this.restaurant = restaurant; }</span>

    /** @return زمان اضافه شدن */
<span class="fc" id="L185">    public LocalDateTime getCreatedAt() { return createdAt; }</span>
<span class="fc" id="L186">    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }</span>

    /** @return یادداشت شخصی */
<span class="fc" id="L189">    public String getNotes() { return notes; }</span>
<span class="fc" id="L190">    public void setNotes(String notes) { updateNotes(notes); }</span>

    // ==================== LEGACY GETTERS ====================
    
    /**
     * دریافت شناسه کاربر (برای سازگاری قدیمی)
     * 
     * @return شناسه کاربر یا 0 در صورت عدم وجود
     * @deprecated استفاده از getUser().getId() توصیه می‌شود
     */
    @Deprecated
    public long getUserId() {
<span class="pc bpc" id="L202" title="1 of 2 branches missed.">        return user != null ? user.getId() : 0L;</span>
    }

    /**
     * دریافت شناسه رستوران (برای سازگاری قدیمی)
     * 
     * @return شناسه رستوران یا 0 در صورت عدم وجود
     * @deprecated استفاده از getRestaurant().getId() توصیه می‌شود
     */
    @Deprecated
    public long getRestaurantId() {
<span class="pc bpc" id="L213" title="1 of 2 branches missed.">        return restaurant != null ? restaurant.getId() : 0L;</span>
    }

    // ==================== OBJECT METHODS ====================
    
    /**
     * بررسی تساوی دو علاقه‌مندی
     * 
     * دو علاقه‌مندی در صورت داشتن همان ID، کاربر و رستوران برابر هستند
     */
    @Override
    public boolean equals(Object o) {
<span class="pc bpc" id="L225" title="1 of 2 branches missed.">        if (this == o) return true;</span>
<span class="nc bnc" id="L226" title="All 4 branches missed.">        if (o == null || getClass() != o.getClass()) return false;</span>
<span class="nc" id="L227">        Favorite favorite = (Favorite) o;</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">        return Objects.equals(id, favorite.id) &amp;&amp;</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">               Objects.equals(user, favorite.user) &amp;&amp;</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">               Objects.equals(restaurant, favorite.restaurant);</span>
    }

    /**
     * محاسبه hash code برای علاقه‌مندی
     * 
     * بر اساس ID، شناسه کاربر و شناسه رستوران محاسبه می‌شود
     */
    @Override
    public int hashCode() {
<span class="nc bnc" id="L240" title="All 2 branches missed.">        return Objects.hash(id, user != null ? user.getId() : null, </span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">                           restaurant != null ? restaurant.getId() : null);</span>
    }
    
    /**
     * نمایش رشته‌ای علاقه‌مندی
     * 
     * شامل اطلاعات کلیدی برای debugging و logging
     */
    @Override
    public String toString() {
<span class="nc" id="L251">        return &quot;Favorite{&quot; +</span>
                &quot;id=&quot; + id +
<span class="nc bnc" id="L253" title="All 2 branches missed.">                &quot;, userId=&quot; + (user != null ? user.getId() : null) +</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">                &quot;, restaurantId=&quot; + (restaurant != null ? restaurant.getId() : null) +</span>
<span class="nc" id="L255">                &quot;, hasNotes=&quot; + hasNotes() +</span>
                &quot;, createdAt=&quot; + createdAt +
                '}';
    }
} 
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>