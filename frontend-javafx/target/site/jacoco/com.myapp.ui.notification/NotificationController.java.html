<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NotificationController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">food-ordering-frontend</a> &gt; <a href="index.source.html" class="el_package">com.myapp.ui.notification</a> &gt; <span class="el_source">NotificationController.java</span></div><h1>NotificationController.java</h1><pre class="source lang-java linenums">package com.myapp.ui.notification;

import com.myapp.ui.common.NavigationController;
import javafx.application.Platform;
import javafx.concurrent.Task;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.control.*;
import javafx.scene.layout.VBox;
import javafx.scene.layout.HBox;
import javafx.scene.text.Font;
import javafx.scene.text.FontWeight;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.util.Duration;
import javafx.animation.Timeline;
import javafx.animation.KeyFrame;

import java.net.URL;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.*;

/**
 * کنترلر سیستم اطلاع‌رسانی و هشدارها
 * 
 * این کلاس مسئول مدیریت رابط کاربری سیستم اطلاع‌رسانی شامل:
 * - مدیریت انواع مختلف اطلاع‌رسانی‌ها
 * - نمایش real-time notifications
 * - تنظیمات اطلاع‌رسانی کاربر
 * - تاریخچه پیام‌ها و اعلان‌ها
 * - سیستم Toast Messages
 * - Desktop Notifications
 * - صدای هشدار و اولویت‌بندی
 * - فیلترینگ و جستجو در پیام‌ها
 * 
 * ویژگی‌های کلیدی:
 * - Real-time Notification Reception با WebSocket
 * - Multi-channel Notifications (Email + SMS + Push)
 * - Priority-based Alert System (Low, Medium, High, Critical)
 * - Smart Notification Grouping
 * - Auto-dismiss Timer System
 * - Sound Alert Management
 * - Do Not Disturb Mode
 * - Notification Templates
 * 
 * @author Food Ordering System Team
 * @version 1.0
 * @since فاز 27 - Notification &amp; Alert System UI
 */
<span class="nc" id="L53">public class NotificationController implements Initializable {</span>

    // ===== FXML UI Components =====
    
    @FXML private VBox notificationListContainer;
    @FXML private Label unreadCountLabel;
    @FXML private Button markAllReadButton;
    @FXML private Button clearAllButton;
    @FXML private ComboBox&lt;NotificationFilter&gt; filterComboBox;
    @FXML private TextField searchField;
    @FXML private Button refreshButton;
    @FXML private CheckBox emailNotificationsCheckBox;
    @FXML private CheckBox smsNotificationsCheckBox;
    @FXML private CheckBox pushNotificationsCheckBox;
    @FXML private CheckBox soundEnabledCheckBox;
    @FXML private CheckBox doNotDisturbCheckBox;
    @FXML private Slider volumeSlider;
    @FXML private ComboBox&lt;String&gt; soundTypeComboBox;
    @FXML private Label statusLabel;
    @FXML private ProgressIndicator loadingIndicator;
    @FXML private Button settingsButton;
    @FXML private Label lastUpdateLabel;
    @FXML private Button exportButton;
    @FXML private CheckBox autoRefreshCheckBox;
    @FXML private Spinner&lt;Integer&gt; refreshIntervalSpinner;

    // ===== Core Dependencies =====
    
    /** کنترلر Navigation برای تغییر صفحات */
    private NavigationController navigationController;
    
    /** فرمت کردن تاریخ و زمان فارسی */
<span class="nc" id="L85">    private final DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(&quot;yyyy/MM/dd HH:mm&quot;);</span>
    
    /** Timeline برای بروزرسانی خودکار */
    private Timeline autoRefreshTimeline;
    
    /** لیست اطلاع‌رسانی‌ها */
    private ObservableList&lt;NotificationItem&gt; notifications;
    
    /** تنظیمات اطلاع‌رسانی */
    private NotificationSettings settings;
    
    /** شمارنده اطلاع‌رسانی‌های خوانده نشده */
<span class="nc" id="L97">    private int unreadCount = 0;</span>
    
    /** وضعیت فیلتر جاری */
<span class="nc" id="L100">    private NotificationFilter currentFilter = NotificationFilter.ALL;</span>

    /**
     * متد مقداردهی اولیه کنترلر
     * 
     * @param location URL location
     * @param resources منابع زبان
     */
    @Override
    public void initialize(URL location, ResourceBundle resources) {
<span class="nc" id="L110">        this.navigationController = NavigationController.getInstance();</span>
<span class="nc" id="L111">        setupUI();</span>
<span class="nc" id="L112">        loadNotificationSettings();</span>
<span class="nc" id="L113">        setupAutoRefresh();</span>
<span class="nc" id="L114">        loadNotifications();</span>
        
<span class="nc" id="L116">        notifications = FXCollections.observableArrayList();</span>
<span class="nc" id="L117">        settings = new NotificationSettings();</span>
<span class="nc" id="L118">    }</span>

    /**
     * راه‌اندازی کامپوننت‌های UI و event listener ها
     */
    private void setupUI() {
<span class="nc" id="L124">        setStatus(&quot;در حال بارگذاری اطلاع‌رسانی‌ها...&quot;);</span>
        
        // راه‌اندازی فیلتر
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (filterComboBox != null) {</span>
<span class="nc" id="L128">            filterComboBox.setItems(FXCollections.observableArrayList(NotificationFilter.values()));</span>
<span class="nc" id="L129">            filterComboBox.setValue(NotificationFilter.ALL);</span>
<span class="nc" id="L130">            filterComboBox.setOnAction(e -&gt; applyFilter());</span>
        }
        
        // راه‌اندازی جستجو
<span class="nc bnc" id="L134" title="All 2 branches missed.">        if (searchField != null) {</span>
<span class="nc" id="L135">            searchField.setPromptText(&quot;جستجو در اطلاع‌رسانی‌ها...&quot;);</span>
<span class="nc" id="L136">            searchField.textProperty().addListener((obs, oldText, newText) -&gt; performSearch(newText));</span>
        }
        
        // راه‌اندازی تنظیمات اطلاع‌رسانی
<span class="nc" id="L140">        setupNotificationSettings();</span>
        
        // مخفی کردن loading indicator
<span class="nc bnc" id="L143" title="All 2 branches missed.">        if (loadingIndicator != null) {</span>
<span class="nc" id="L144">            loadingIndicator.setVisible(false);</span>
        }
<span class="nc" id="L146">    }</span>

    /**
     * راه‌اندازی تنظیمات اطلاع‌رسانی
     */
    private void setupNotificationSettings() {
        // تنظیم مقادیر پیش‌فرض
<span class="nc bnc" id="L153" title="All 2 branches missed.">        if (emailNotificationsCheckBox != null) {</span>
<span class="nc" id="L154">            emailNotificationsCheckBox.setSelected(true);</span>
<span class="nc" id="L155">            emailNotificationsCheckBox.setOnAction(e -&gt; updateNotificationSettings());</span>
        }
        
<span class="nc bnc" id="L158" title="All 2 branches missed.">        if (smsNotificationsCheckBox != null) {</span>
<span class="nc" id="L159">            smsNotificationsCheckBox.setSelected(true);</span>
<span class="nc" id="L160">            smsNotificationsCheckBox.setOnAction(e -&gt; updateNotificationSettings());</span>
        }
        
<span class="nc bnc" id="L163" title="All 2 branches missed.">        if (pushNotificationsCheckBox != null) {</span>
<span class="nc" id="L164">            pushNotificationsCheckBox.setSelected(true);</span>
<span class="nc" id="L165">            pushNotificationsCheckBox.setOnAction(e -&gt; updateNotificationSettings());</span>
        }
        
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if (doNotDisturbCheckBox != null) {</span>
<span class="nc" id="L169">            doNotDisturbCheckBox.setSelected(false);</span>
<span class="nc" id="L170">            doNotDisturbCheckBox.setOnAction(e -&gt; updateDoNotDisturbMode());</span>
        }
<span class="nc" id="L172">    }</span>

    /**
     * بارگذاری تنظیمات اطلاع‌رسانی از تنظیمات کاربر
     */
    private void loadNotificationSettings() {
<span class="nc" id="L178">        settings = new NotificationSettings();</span>
<span class="nc" id="L179">        settings.setEmailEnabled(true);</span>
<span class="nc" id="L180">        settings.setSmsEnabled(true);</span>
<span class="nc" id="L181">        settings.setPushEnabled(true);</span>
<span class="nc" id="L182">        settings.setSoundEnabled(true);</span>
<span class="nc" id="L183">        settings.setVolume(70.0);</span>
<span class="nc" id="L184">        settings.setDoNotDisturb(false);</span>
<span class="nc" id="L185">    }</span>

    /**
     * راه‌اندازی بروزرسانی خودکار اطلاع‌رسانی‌ها
     */
    private void setupAutoRefresh() {
<span class="nc" id="L191">        autoRefreshTimeline = new Timeline(</span>
<span class="nc" id="L192">            new KeyFrame(Duration.seconds(30), e -&gt; refreshNotifications())</span>
        );
<span class="nc" id="L194">        autoRefreshTimeline.setCycleCount(Timeline.INDEFINITE);</span>
<span class="nc" id="L195">        autoRefreshTimeline.play();</span>
<span class="nc" id="L196">    }</span>

    /**
     * بارگذاری اطلاع‌رسانی‌ها از سرور
     */
    private void loadNotifications() {
<span class="nc" id="L202">        setLoading(true);</span>
        
<span class="nc" id="L204">        Task&lt;List&lt;NotificationItem&gt;&gt; loadTask = new Task&lt;List&lt;NotificationItem&gt;&gt;() {</span>
            @Override
            protected List&lt;NotificationItem&gt; call() throws Exception {
<span class="nc" id="L207">                Thread.sleep(1000); // شبیه‌سازی تأخیر شبکه</span>
<span class="nc" id="L208">                return createMockNotifications();</span>
            }
        };
        
<span class="nc" id="L212">        loadTask.setOnSucceeded(e -&gt; Platform.runLater(() -&gt; {</span>
<span class="nc" id="L213">            setLoading(false);</span>
<span class="nc" id="L214">            List&lt;NotificationItem&gt; loadedNotifications = loadTask.getValue();</span>
<span class="nc" id="L215">            notifications.clear();</span>
<span class="nc" id="L216">            notifications.addAll(loadedNotifications);</span>
<span class="nc" id="L217">            displayNotifications();</span>
<span class="nc" id="L218">            updateUnreadCount();</span>
<span class="nc" id="L219">            setStatus(&quot;اطلاع‌رسانی‌ها بروزرسانی شد&quot;);</span>
<span class="nc" id="L220">            updateLastUpdateTime();</span>
<span class="nc" id="L221">        }));</span>
        
<span class="nc" id="L223">        loadTask.setOnFailed(e -&gt; Platform.runLater(() -&gt; {</span>
<span class="nc" id="L224">            setLoading(false);</span>
<span class="nc" id="L225">            setStatus(&quot;خطا در بارگذاری اطلاع‌رسانی‌ها&quot;);</span>
<span class="nc" id="L226">            showError(&quot;خطا&quot;, &quot;امکان بارگذاری اطلاع‌رسانی‌ها وجود ندارد&quot;);</span>
<span class="nc" id="L227">        }));</span>
        
<span class="nc" id="L229">        new Thread(loadTask).start();</span>
<span class="nc" id="L230">    }</span>

    /**
     * ایجاد اطلاع‌رسانی‌های نمونه برای نمایش
     */
    private List&lt;NotificationItem&gt; createMockNotifications() {
<span class="nc" id="L236">        List&lt;NotificationItem&gt; notifications = new ArrayList&lt;&gt;();</span>
        
<span class="nc" id="L238">        notifications.add(new NotificationItem(</span>
<span class="nc" id="L239">            &quot;سفارش شما آماده است&quot;,</span>
<span class="nc" id="L240">            &quot;سفارش شماره ORD-123456789 آماده تحویل است&quot;,</span>
<span class="nc" id="L241">            NotificationType.ORDER_UPDATE,</span>
<span class="nc" id="L242">            NotificationPriority.HIGH,</span>
<span class="nc" id="L243">            LocalDateTime.now().minusMinutes(5),</span>
<span class="nc" id="L244">            false</span>
        ));
        
<span class="nc" id="L247">        notifications.add(new NotificationItem(</span>
<span class="nc" id="L248">            &quot;تخفیف ویژه&quot;,</span>
<span class="nc" id="L249">            &quot;20% تخفیف برای سفارش بعدی شما - کد: SAVE20&quot;,</span>
<span class="nc" id="L250">            NotificationType.PROMOTION,</span>
<span class="nc" id="L251">            NotificationPriority.MEDIUM,</span>
<span class="nc" id="L252">            LocalDateTime.now().minusHours(1),</span>
<span class="nc" id="L253">            true</span>
        ));
        
<span class="nc" id="L256">        notifications.add(new NotificationItem(</span>
<span class="nc" id="L257">            &quot;پرداخت موفق&quot;,</span>
<span class="nc" id="L258">            &quot;پرداخت 87,650 تومان با موفقیت انجام شد&quot;,</span>
<span class="nc" id="L259">            NotificationType.PAYMENT,</span>
<span class="nc" id="L260">            NotificationPriority.HIGH,</span>
<span class="nc" id="L261">            LocalDateTime.now().minusHours(2),</span>
<span class="nc" id="L262">            true</span>
        ));
        
<span class="nc" id="L265">        return notifications;</span>
    }

    /**
     * نمایش اطلاع‌رسانی‌ها در رابط کاربری
     */
    private void displayNotifications() {
<span class="nc bnc" id="L272" title="All 2 branches missed.">        if (notificationListContainer == null) return;</span>
        
<span class="nc" id="L274">        notificationListContainer.getChildren().clear();</span>
        
<span class="nc" id="L276">        List&lt;NotificationItem&gt; filteredNotifications = getFilteredNotifications();</span>
        
<span class="nc bnc" id="L278" title="All 2 branches missed.">        if (filteredNotifications.isEmpty()) {</span>
<span class="nc" id="L279">            showEmptyState();</span>
<span class="nc" id="L280">            return;</span>
        }
        
<span class="nc bnc" id="L283" title="All 2 branches missed.">        for (NotificationItem notification : filteredNotifications) {</span>
<span class="nc" id="L284">            VBox notificationCard = createNotificationCard(notification);</span>
<span class="nc" id="L285">            notificationListContainer.getChildren().add(notificationCard);</span>
        }
<span class="nc" id="L287">    }</span>

    /**
     * ایجاد کارت UI برای نمایش یک اطلاع‌رسانی
     */
    private VBox createNotificationCard(NotificationItem notification) {
<span class="nc" id="L293">        VBox card = new VBox(8);</span>
<span class="nc" id="L294">        card.setPadding(new Insets(12));</span>
<span class="nc" id="L295">        card.setStyle(getNotificationCardStyle(notification));</span>
        
        // Header با آیکون و زمان
<span class="nc" id="L298">        HBox header = new HBox(10);</span>
<span class="nc" id="L299">        header.setAlignment(Pos.CENTER_LEFT);</span>
        
<span class="nc" id="L301">        Label typeIcon = new Label(getNotificationIcon(notification.getType()));</span>
<span class="nc" id="L302">        typeIcon.setStyle(&quot;-fx-font-size: 16px;&quot;);</span>
        
<span class="nc" id="L304">        Label titleLabel = new Label(notification.getTitle());</span>
<span class="nc" id="L305">        titleLabel.setFont(Font.font(&quot;System&quot;, FontWeight.BOLD, 14));</span>
        
<span class="nc" id="L307">        Label timeLabel = new Label(formatNotificationTime(notification.getTimestamp()));</span>
<span class="nc" id="L308">        timeLabel.setStyle(&quot;-fx-text-fill: #6c757d; -fx-font-size: 11px;&quot;);</span>
        
<span class="nc" id="L310">        header.getChildren().addAll(typeIcon, titleLabel, timeLabel);</span>
        
        // محتوای پیام
<span class="nc" id="L313">        Label messageLabel = new Label(notification.getMessage());</span>
<span class="nc" id="L314">        messageLabel.setWrapText(true);</span>
<span class="nc" id="L315">        messageLabel.setStyle(&quot;-fx-text-fill: #495057; -fx-font-size: 12px;&quot;);</span>
        
<span class="nc" id="L317">        card.getChildren().addAll(header, messageLabel);</span>
<span class="nc" id="L318">        return card;</span>
    }

    // ===== Event Handlers =====

    @FXML
    private void handleMarkAllRead() {
<span class="nc" id="L325">        notifications.stream()</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">                    .filter(n -&gt; !n.isRead())</span>
<span class="nc" id="L327">                    .forEach(n -&gt; n.setRead(true));</span>
        
<span class="nc" id="L329">        displayNotifications();</span>
<span class="nc" id="L330">        updateUnreadCount();</span>
<span class="nc" id="L331">        setStatus(&quot;همه اطلاع‌رسانی‌ها علامت‌گذاری شدند&quot;);</span>
<span class="nc" id="L332">    }</span>

    @FXML
    private void handleClearAll() {
<span class="nc" id="L336">        Alert confirmAlert = new Alert(Alert.AlertType.CONFIRMATION);</span>
<span class="nc" id="L337">        confirmAlert.setTitle(&quot;حذف همه&quot;);</span>
<span class="nc" id="L338">        confirmAlert.setHeaderText(&quot;آیا مطمئن هستید؟&quot;);</span>
<span class="nc" id="L339">        confirmAlert.setContentText(&quot;آیا می‌خواهید همه اطلاع‌رسانی‌ها را حذف کنید؟&quot;);</span>
        
<span class="nc" id="L341">        confirmAlert.showAndWait().ifPresent(response -&gt; {</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">            if (response == ButtonType.OK) {</span>
<span class="nc" id="L343">                notifications.clear();</span>
<span class="nc" id="L344">                displayNotifications();</span>
<span class="nc" id="L345">                updateUnreadCount();</span>
<span class="nc" id="L346">                setStatus(&quot;همه اطلاع‌رسانی‌ها حذف شدند&quot;);</span>
            }
<span class="nc" id="L348">        });</span>
<span class="nc" id="L349">    }</span>

    @FXML
    private void handleRefresh() {
<span class="nc" id="L353">        refreshNotifications();</span>
<span class="nc" id="L354">    }</span>

    // ===== Utility Methods =====

    private String getNotificationIcon(NotificationType type) {
<span class="nc bnc" id="L359" title="All 7 branches missed.">        switch (type) {</span>
<span class="nc" id="L360">            case ORDER_UPDATE: return &quot;📦&quot;;</span>
<span class="nc" id="L361">            case PAYMENT: return &quot;💳&quot;;</span>
<span class="nc" id="L362">            case PROMOTION: return &quot;🎁&quot;;</span>
<span class="nc" id="L363">            case NEW_RESTAURANT: return &quot;🏪&quot;;</span>
<span class="nc" id="L364">            case REMINDER: return &quot;⏰&quot;;</span>
<span class="nc" id="L365">            case SYSTEM: return &quot;⚙️&quot;;</span>
<span class="nc" id="L366">            default: return &quot;📢&quot;;</span>
        }
    }

    private String getNotificationCardStyle(NotificationItem notification) {
<span class="nc" id="L371">        String baseStyle = &quot;-fx-background-color: %s; -fx-border-color: %s; -fx-border-radius: 8; -fx-background-radius: 8;&quot;;</span>
        
<span class="nc bnc" id="L373" title="All 2 branches missed.">        if (!notification.isRead()) {</span>
<span class="nc" id="L374">            return String.format(baseStyle, &quot;#f8f9fa&quot;, &quot;#007bff&quot;) + &quot; -fx-border-width: 2;&quot;;</span>
        } else {
<span class="nc" id="L376">            return String.format(baseStyle, &quot;#ffffff&quot;, &quot;#dee2e6&quot;) + &quot; -fx-border-width: 1;&quot;;</span>
        }
    }

    private String formatNotificationTime(LocalDateTime timestamp) {
<span class="nc" id="L381">        LocalDateTime now = LocalDateTime.now();</span>
<span class="nc" id="L382">        long minutesAgo = java.time.Duration.between(timestamp, now).toMinutes();</span>
        
<span class="nc bnc" id="L384" title="All 2 branches missed.">        if (minutesAgo &lt; 1) {</span>
<span class="nc" id="L385">            return &quot;اکنون&quot;;</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">        } else if (minutesAgo &lt; 60) {</span>
<span class="nc" id="L387">            return minutesAgo + &quot; دقیقه پیش&quot;;</span>
<span class="nc bnc" id="L388" title="All 2 branches missed.">        } else if (minutesAgo &lt; 1440) {</span>
<span class="nc" id="L389">            return (minutesAgo / 60) + &quot; ساعت پیش&quot;;</span>
        } else {
<span class="nc" id="L391">            return timestamp.format(dateTimeFormatter);</span>
        }
    }

    private void showEmptyState() {
<span class="nc" id="L396">        Label emptyLabel = new Label(&quot;هیچ اطلاع‌رسانی‌ای موجود نیست&quot;);</span>
<span class="nc" id="L397">        emptyLabel.setStyle(&quot;-fx-text-fill: #6c757d; -fx-font-size: 14px;&quot;);</span>
<span class="nc" id="L398">        notificationListContainer.getChildren().add(emptyLabel);</span>
<span class="nc" id="L399">    }</span>

    private void updateUnreadCount() {
<span class="nc bnc" id="L402" title="All 2 branches missed.">        unreadCount = (int) notifications.stream().filter(n -&gt; !n.isRead()).count();</span>
        
<span class="nc bnc" id="L404" title="All 2 branches missed.">        if (unreadCountLabel != null) {</span>
<span class="nc" id="L405">            unreadCountLabel.setText(String.valueOf(unreadCount));</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">            unreadCountLabel.setVisible(unreadCount &gt; 0);</span>
        }
<span class="nc" id="L408">    }</span>

    private void updateLastUpdateTime() {
<span class="nc bnc" id="L411" title="All 2 branches missed.">        if (lastUpdateLabel != null) {</span>
<span class="nc" id="L412">            lastUpdateLabel.setText(&quot;آخرین بروزرسانی: &quot; + LocalDateTime.now().format(dateTimeFormatter));</span>
        }
<span class="nc" id="L414">    }</span>

    private void refreshNotifications() {
<span class="nc" id="L417">        loadNotifications();</span>
<span class="nc" id="L418">    }</span>

    private void applyFilter() {
<span class="nc bnc" id="L421" title="All 2 branches missed.">        if (filterComboBox != null) {</span>
<span class="nc" id="L422">            currentFilter = filterComboBox.getValue();</span>
<span class="nc" id="L423">            displayNotifications();</span>
        }
<span class="nc" id="L425">    }</span>

    private void performSearch(String searchText) {
<span class="nc" id="L428">        displayNotifications();</span>
<span class="nc" id="L429">    }</span>

    private List&lt;NotificationItem&gt; getFilteredNotifications() {
<span class="nc" id="L432">        return notifications.stream()</span>
<span class="nc" id="L433">                           .filter(this::matchesFilter)</span>
<span class="nc" id="L434">                           .filter(this::matchesSearch)</span>
<span class="nc" id="L435">                           .sorted((a, b) -&gt; b.getTimestamp().compareTo(a.getTimestamp()))</span>
<span class="nc" id="L436">                           .collect(java.util.stream.Collectors.toList());</span>
    }

    private boolean matchesFilter(NotificationItem notification) {
<span class="nc bnc" id="L440" title="All 4 branches missed.">        switch (currentFilter) {</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">            case UNREAD: return !notification.isRead();</span>
<span class="nc" id="L442">            case read: return notification.isRead();</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">            case HIGH_PRIORITY: return notification.getPriority() == NotificationPriority.HIGH || </span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">                                      notification.getPriority() == NotificationPriority.CRITICAL;</span>
            case ALL:
<span class="nc" id="L446">            default: return true;</span>
        }
    }

    private boolean matchesSearch(NotificationItem notification) {
<span class="nc bnc" id="L451" title="All 4 branches missed.">        if (searchField == null || searchField.getText().trim().isEmpty()) {</span>
<span class="nc" id="L452">            return true;</span>
        }
        
<span class="nc" id="L455">        String searchText = searchField.getText().toLowerCase();</span>
<span class="nc bnc" id="L456" title="All 2 branches missed.">        return notification.getTitle().toLowerCase().contains(searchText) ||</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">               notification.getMessage().toLowerCase().contains(searchText);</span>
    }

    private void updateNotificationSettings() {
<span class="nc bnc" id="L461" title="All 2 branches missed.">        if (settings != null) {</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">            if (emailNotificationsCheckBox != null) {</span>
<span class="nc" id="L463">                settings.setEmailEnabled(emailNotificationsCheckBox.isSelected());</span>
            }
<span class="nc bnc" id="L465" title="All 2 branches missed.">            if (smsNotificationsCheckBox != null) {</span>
<span class="nc" id="L466">                settings.setSmsEnabled(smsNotificationsCheckBox.isSelected());</span>
            }
<span class="nc bnc" id="L468" title="All 2 branches missed.">            if (pushNotificationsCheckBox != null) {</span>
<span class="nc" id="L469">                settings.setPushEnabled(pushNotificationsCheckBox.isSelected());</span>
            }
            
<span class="nc" id="L472">            setStatus(&quot;تنظیمات اطلاع‌رسانی بروزرسانی شد&quot;);</span>
        }
<span class="nc" id="L474">    }</span>

    private void updateDoNotDisturbMode() {
<span class="nc bnc" id="L477" title="All 4 branches missed.">        if (doNotDisturbCheckBox != null &amp;&amp; settings != null) {</span>
<span class="nc" id="L478">            settings.setDoNotDisturb(doNotDisturbCheckBox.isSelected());</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">            setStatus(&quot;حالت مزاحم نشوید &quot; + (settings.isDoNotDisturb() ? &quot;فعال&quot; : &quot;غیرفعال&quot;) + &quot; شد&quot;);</span>
        }
<span class="nc" id="L481">    }</span>

    private void setLoading(boolean loading) {
<span class="nc bnc" id="L484" title="All 2 branches missed.">        if (loadingIndicator != null) {</span>
<span class="nc" id="L485">            loadingIndicator.setVisible(loading);</span>
        }
<span class="nc" id="L487">    }</span>

    private void setStatus(String message) {
<span class="nc bnc" id="L490" title="All 2 branches missed.">        if (statusLabel != null) {</span>
<span class="nc" id="L491">            statusLabel.setText(message);</span>
        }
<span class="nc" id="L493">    }</span>

    private void showError(String title, String message) {
<span class="nc" id="L496">        Alert alert = new Alert(Alert.AlertType.ERROR);</span>
<span class="nc" id="L497">        alert.setTitle(title);</span>
<span class="nc" id="L498">        alert.setContentText(message);</span>
<span class="nc" id="L499">        alert.showAndWait();</span>
<span class="nc" id="L500">    }</span>

    // ===== Data Models =====

    /**
     * کلاس اطلاع‌رسانی
     */
    public static class NotificationItem {
        private String title;
        private String message;
        private NotificationType type;
        private NotificationPriority priority;
        private LocalDateTime timestamp;
        private boolean read;
        
<span class="fc" id="L515">        public NotificationItem(String title, String message, NotificationType type, </span>
                              NotificationPriority priority, LocalDateTime timestamp, boolean read) {
<span class="fc" id="L517">            this.title = title;</span>
<span class="fc" id="L518">            this.message = message;</span>
<span class="fc" id="L519">            this.type = type;</span>
<span class="fc" id="L520">            this.priority = priority;</span>
<span class="fc" id="L521">            this.timestamp = timestamp;</span>
<span class="fc" id="L522">            this.read = read;</span>
<span class="fc" id="L523">        }</span>
        
        // Getters and Setters
<span class="fc" id="L526">        public String getTitle() { return title; }</span>
<span class="fc" id="L527">        public String getMessage() { return message; }</span>
<span class="fc" id="L528">        public NotificationType getType() { return type; }</span>
<span class="fc" id="L529">        public NotificationPriority getPriority() { return priority; }</span>
<span class="fc" id="L530">        public LocalDateTime getTimestamp() { return timestamp; }</span>
<span class="fc" id="L531">        public boolean isRead() { return read; }</span>
<span class="fc" id="L532">        public void setRead(boolean read) { this.read = read; }</span>
    }

    /**
     * enum نوع اطلاع‌رسانی
     */
<span class="fc" id="L538">    public enum NotificationType {</span>
<span class="fc" id="L539">        ORDER_UPDATE(&quot;بروزرسانی سفارش&quot;),</span>
<span class="fc" id="L540">        PAYMENT(&quot;پرداخت&quot;),</span>
<span class="fc" id="L541">        PROMOTION(&quot;تبلیغات&quot;),</span>
<span class="fc" id="L542">        NEW_RESTAURANT(&quot;رستوران جدید&quot;),</span>
<span class="fc" id="L543">        REMINDER(&quot;یادآوری&quot;),</span>
<span class="fc" id="L544">        SYSTEM(&quot;سیستم&quot;);</span>
        
        private final String displayName;
        
<span class="fc" id="L548">        NotificationType(String displayName) {</span>
<span class="fc" id="L549">            this.displayName = displayName;</span>
<span class="fc" id="L550">        }</span>
        
<span class="fc" id="L552">        public String getDisplayName() { return displayName; }</span>
    }

    /**
     * enum اولویت اطلاع‌رسانی
     */
<span class="fc" id="L558">    public enum NotificationPriority {</span>
<span class="fc" id="L559">        LOW(&quot;کم&quot;),</span>
<span class="fc" id="L560">        MEDIUM(&quot;متوسط&quot;),</span>
<span class="fc" id="L561">        HIGH(&quot;بالا&quot;),</span>
<span class="fc" id="L562">        CRITICAL(&quot;بحرانی&quot;);</span>
        
        private final String displayName;
        
<span class="fc" id="L566">        NotificationPriority(String displayName) {</span>
<span class="fc" id="L567">            this.displayName = displayName;</span>
<span class="fc" id="L568">        }</span>
        
<span class="fc" id="L570">        public String getDisplayName() { return displayName; }</span>
    }

    /**
     * enum فیلتر اطلاع‌رسانی‌ها
     */
<span class="fc" id="L576">    public enum NotificationFilter {</span>
<span class="fc" id="L577">        ALL(&quot;همه&quot;),</span>
<span class="fc" id="L578">        UNREAD(&quot;خوانده نشده&quot;),</span>
<span class="fc" id="L579">        read(&quot;خوانده شده&quot;),</span>
<span class="fc" id="L580">        HIGH_PRIORITY(&quot;اولویت بالا&quot;);</span>
        
        private final String displayName;
        
<span class="fc" id="L584">        NotificationFilter(String displayName) {</span>
<span class="fc" id="L585">            this.displayName = displayName;</span>
<span class="fc" id="L586">        }</span>
        
<span class="nc" id="L588">        public String getDisplayName() { return displayName; }</span>
        
        @Override
<span class="fc" id="L591">        public String toString() { return displayName; }</span>
    }

    /**
     * کلاس تنظیمات اطلاع‌رسانی
     */
<span class="fc" id="L597">    public static class NotificationSettings {</span>
<span class="fc" id="L598">        private boolean emailEnabled = true;</span>
<span class="fc" id="L599">        private boolean smsEnabled = true;</span>
<span class="fc" id="L600">        private boolean pushEnabled = true;</span>
<span class="fc" id="L601">        private boolean soundEnabled = true;</span>
<span class="fc" id="L602">        private boolean doNotDisturb = false;</span>
<span class="fc" id="L603">        private double volume = 70.0;</span>
<span class="fc" id="L604">        private String soundType = &quot;صدای پیش‌فرض&quot;;</span>
        
        // Getters and Setters
<span class="fc" id="L607">        public boolean isEmailEnabled() { return emailEnabled; }</span>
<span class="fc" id="L608">        public void setEmailEnabled(boolean emailEnabled) { this.emailEnabled = emailEnabled; }</span>
        
<span class="fc" id="L610">        public boolean isSmsEnabled() { return smsEnabled; }</span>
<span class="fc" id="L611">        public void setSmsEnabled(boolean smsEnabled) { this.smsEnabled = smsEnabled; }</span>
        
<span class="fc" id="L613">        public boolean isPushEnabled() { return pushEnabled; }</span>
<span class="fc" id="L614">        public void setPushEnabled(boolean pushEnabled) { this.pushEnabled = pushEnabled; }</span>
        
<span class="fc" id="L616">        public boolean isSoundEnabled() { return soundEnabled; }</span>
<span class="fc" id="L617">        public void setSoundEnabled(boolean soundEnabled) { this.soundEnabled = soundEnabled; }</span>
        
<span class="fc" id="L619">        public boolean isDoNotDisturb() { return doNotDisturb; }</span>
<span class="fc" id="L620">        public void setDoNotDisturb(boolean doNotDisturb) { this.doNotDisturb = doNotDisturb; }</span>
        
<span class="fc" id="L622">        public double getVolume() { return volume; }</span>
<span class="fc" id="L623">        public void setVolume(double volume) { this.volume = volume; }</span>
        
<span class="nc" id="L625">        public String getSoundType() { return soundType; }</span>
<span class="fc" id="L626">        public void setSoundType(String soundType) { this.soundType = soundType; }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>