<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserProfileController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Food Ordering Frontend</a> &gt; <a href="index.source.html" class="el_package">com.myapp.ui.auth</a> &gt; <span class="el_source">UserProfileController.java</span></div><h1>UserProfileController.java</h1><pre class="source lang-java linenums">package com.myapp.ui.auth;

import com.myapp.ui.common.HttpClientUtil;
import com.myapp.ui.common.NavigationController;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import javafx.application.Platform;
import javafx.beans.property.SimpleStringProperty;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.concurrent.Task;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.*;
import javafx.scene.control.cell.PropertyValueFactory;
import javafx.scene.layout.*;
import javafx.scene.chart.PieChart;
import javafx.scene.chart.LineChart;
import javafx.scene.chart.XYChart;
import javafx.scene.input.MouseEvent;
import javafx.util.Callback;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.net.URL;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.*;
import java.util.stream.Collectors;

/**
 * کنترلر جامع مدیریت پروفایل و تاریخچه کاربر - فاز 28
 * 
 * این کلاس مسئول مدیریت کامل پروفایل کاربر شامل:
 * - مدیریت اطلاعات شخصی و آدرس‌ها
 * - نمایش و مدیریت تاریخچه سفارشات
 * - نمایش تاریخچه تراکنش‌های مالی
 * - مدیریت علاقه‌مندی‌ها (رستوران‌ها و آیتم‌ها)
 * - تنظیمات و ترجیحات کاربری
 * - آمار و تحلیل‌های کاربری
 * 
 * ویژگی‌های کلیدی:
 * - Tab-based navigation برای بخش‌های مختلف
 * - فیلترینگ و جستجوی پیشرفته
 * - نمودارهای آماری تعاملی
 * - Export گزارشات و رسیدها
 * - Real-time updates
 * - Responsive design
 * 
 * @author تیم توسعه سیستم سفارش غذا
 * @version 2.0
 * @since 1403/09/29
 */
<span class="fc" id="L56">public class UserProfileController implements Initializable {</span>

    // ========== Tab Container ==========
    /** کانتینر اصلی Tab ها برای بخش‌های مختلف */
    @FXML TabPane mainTabPane;
    
    /** تب اطلاعات شخصی */
    @FXML Tab profileTab;
    
    /** تب تاریخچه سفارشات */
    @FXML Tab ordersTab;
    
    /** تب تاریخچه مالی */
    @FXML Tab transactionsTab;
    
    /** تب علاقه‌مندی‌ها */
    @FXML Tab favoritesTab;
    
    /** تب تنظیمات */
    @FXML Tab settingsTab;
    
    /** تب آمار و تحلیل */
    @FXML Tab analyticsTab;

    // ========== Profile Tab Components ==========
    /** فیلد نام کامل کاربر */
    @FXML TextField fullNameField;
    
    /** فیلد شماره تلفن (غیرقابل ویرایش) */
    @FXML TextField phoneField;
    
    /** فیلد ایمیل */
    @FXML TextField emailField;
    
    /** لیست آدرس‌های کاربر */
    @FXML ListView&lt;AddressItem&gt; addressListView;
    
    /** دکمه افزودن آدرس جدید */
    @FXML Button addAddressButton;
    
    /** دکمه ویرایش آدرس */
    @FXML Button editAddressButton;
    
    /** دکمه حذف آدرس */
    @FXML Button deleteAddressButton;
    
    /** برچسب نقش کاربری */
    @FXML Label roleLabel;
    
    /** برچسب وضعیت حساب */
    @FXML Label accountStatusLabel;
    
    /** برچسب تاریخ عضویت */
    @FXML Label memberSinceLabel;
    
    /** برچسب موجودی کیف پول */
    @FXML Label walletBalanceLabel;
    
    /** دکمه ذخیره تغییرات پروفایل */
    @FXML Button saveProfileButton;
    
    /** بخش تغییر رمز عبور */
    @FXML VBox passwordChangeSection;
    
    /** فیلد رمز عبور فعلی */
    @FXML PasswordField currentPasswordField;
    
    /** فیلد رمز عبور جدید */
    @FXML PasswordField newPasswordField;
    
    /** فیلد تأیید رمز عبور جدید */
    @FXML PasswordField confirmPasswordField;
    
    /** دکمه تغییر رمز عبور */
    @FXML Button changePasswordButton;

    // ========== Orders Tab Components ==========
    /** جدول نمایش سفارشات */
    @FXML TableView&lt;OrderHistoryItem&gt; ordersTable;
    
    /** ستون شماره سفارش */
    @FXML TableColumn&lt;OrderHistoryItem, String&gt; orderIdColumn;
    
    /** ستون تاریخ سفارش */
    @FXML TableColumn&lt;OrderHistoryItem, String&gt; orderDateColumn;
    
    /** ستون نام رستوران */
    @FXML TableColumn&lt;OrderHistoryItem, String&gt; restaurantColumn;
    
    /** ستون مبلغ کل */
    @FXML TableColumn&lt;OrderHistoryItem, String&gt; totalAmountColumn;
    
    /** ستون وضعیت سفارش */
    @FXML TableColumn&lt;OrderHistoryItem, String&gt; orderStatusColumn;
    
    /** ستون عملیات */
    @FXML TableColumn&lt;OrderHistoryItem, Void&gt; orderActionsColumn;
    
    /** فیلد جستجوی سفارشات */
    @FXML TextField orderSearchField;
    
    /** فیلتر وضعیت سفارش */
    @FXML ComboBox&lt;String&gt; orderStatusFilter;
    
    /** انتخاب بازه زمانی */
    @FXML DatePicker orderStartDate;
    @FXML DatePicker orderEndDate;
    
    /** دکمه اعمال فیلتر */
    @FXML Button applyOrderFilterButton;
    
    /** دکمه پاک کردن فیلتر */
    @FXML Button clearOrderFilterButton;
    
    /** برچسب تعداد کل سفارشات */
    @FXML Label totalOrdersLabel;
    
    /** برچسب مجموع خرید */
    @FXML Label totalSpentLabel;

    // ========== Transactions Tab Components ==========
    /** جدول تراکنش‌های مالی */
    @FXML TableView&lt;TransactionItem&gt; transactionsTable;
    
    /** ستون شماره تراکنش */
    @FXML TableColumn&lt;TransactionItem, String&gt; transactionIdColumn;
    
    /** ستون تاریخ تراکنش */
    @FXML TableColumn&lt;TransactionItem, String&gt; transactionDateColumn;
    
    /** ستون نوع تراکنش */
    @FXML TableColumn&lt;TransactionItem, String&gt; transactionTypeColumn;
    
    /** ستون مبلغ */
    @FXML TableColumn&lt;TransactionItem, String&gt; amountColumn;
    
    /** ستون توضیحات */
    @FXML TableColumn&lt;TransactionItem, String&gt; descriptionColumn;
    
    /** ستون موجودی پس از تراکنش */
    @FXML TableColumn&lt;TransactionItem, String&gt; balanceAfterColumn;
    
    /** فیلتر نوع تراکنش */
    @FXML ComboBox&lt;String&gt; transactionTypeFilter;
    
    /** انتخاب بازه زمانی تراکنش‌ها */
    @FXML DatePicker transactionStartDate;
    @FXML DatePicker transactionEndDate;
    
    /** دکمه دانلود گزارش تراکنش‌ها */
    @FXML Button downloadTransactionReportButton;

    // ========== Favorites Tab Components ==========
    /** لیست رستوران‌های مورد علاقه */
    @FXML ListView&lt;FavoriteRestaurant&gt; favoriteRestaurantsList;
    
    /** لیست آیتم‌های مورد علاقه */
    @FXML ListView&lt;FavoriteItem&gt; favoriteItemsList;
    
    /** دکمه حذف از علاقه‌مندی‌ها */
    @FXML Button removeFavoriteButton;
    
    /** دکمه سفارش مجدد */
    @FXML Button reorderFavoriteButton;
    
    /** برچسب تعداد رستوران‌های مورد علاقه */
    @FXML Label favoriteRestaurantsCountLabel;
    
    /** برچسب تعداد آیتم‌های مورد علاقه */
    @FXML Label favoriteItemsCountLabel;

    // ========== Settings Tab Components ==========
    /** تنظیمات اطلاع‌رسانی ایمیل */
    @FXML CheckBox emailNotificationCheckBox;
    
    /** تنظیمات اطلاع‌رسانی پیامک */
    @FXML CheckBox smsNotificationCheckBox;
    
    /** تنظیمات اطلاع‌رسانی push */
    @FXML CheckBox pushNotificationCheckBox;
    
    /** انتخاب زبان */
    @FXML ComboBox&lt;String&gt; languageComboBox;
    
    /** انتخاب تم */
    @FXML ComboBox&lt;String&gt; themeComboBox;
    
    /** تنظیمات اشتراک‌گذاری داده */
    @FXML CheckBox shareDataCheckBox;
    @FXML CheckBox showProfileCheckBox;
    
    /** دکمه ذخیره تنظیمات */
    @FXML Button saveSettingsButton;
    
    /** دکمه بازنشانی تنظیمات */
    @FXML Button resetSettingsButton;

    // ========== Analytics Tab Components ==========
    /** نمودار توزیع سفارشات */
    @FXML PieChart orderDistributionChart;
    
    /** نمودار روند هزینه‌ها */
    @FXML LineChart&lt;String, Number&gt; spendingTrendChart;
    
    /** برچسب میانگین هزینه ماهانه */
    @FXML Label averageMonthlySpendLabel;
    
    /** برچسب رستوران محبوب */
    @FXML Label topRestaurantLabel;
    
    /** برچسب آیتم محبوب */
    @FXML Label topFoodItemLabel;
    
    /** برچسب تعداد کل سفارشات */
    @FXML Label totalOrdersAnalyticsLabel;
    
    /** برچسب مجموع کل خرید */
    @FXML Label totalSpentAnalyticsLabel;
    
    /** انتخاب بازه زمانی آمار */
    @FXML ComboBox&lt;String&gt; analyticsTimeRangeComboBox;

    // ========== Common UI Components ==========
    /** نوار وضعیت */
    @FXML Label statusLabel;
    
    /** نشانگر بارگذاری */
    @FXML ProgressIndicator loadingIndicator;
    
    /** نوار پیشرفت */
    @FXML ProgressBar progressBar;

    // ========== Instance Variables ==========
    /** کنترلر ناوبری */
    NavigationController navigationController;
    
    /** ObjectMapper برای پردازش JSON */
<span class="fc" id="L293">    final ObjectMapper objectMapper = new ObjectMapper();</span>
    
    /** لیست سفارشات */
<span class="fc" id="L296">    ObservableList&lt;OrderHistoryItem&gt; ordersList = FXCollections.observableArrayList();</span>
    
    /** لیست تراکنش‌ها */
<span class="fc" id="L299">    ObservableList&lt;TransactionItem&gt; transactionsList = FXCollections.observableArrayList();</span>
    
    /** لیست رستوران‌های مورد علاقه */
<span class="fc" id="L302">    ObservableList&lt;FavoriteRestaurant&gt; favoriteRestaurants = FXCollections.observableArrayList();</span>
    
    /** لیست آیتم‌های مورد علاقه */
<span class="fc" id="L305">    ObservableList&lt;FavoriteItem&gt; favoriteItems = FXCollections.observableArrayList();</span>
    
    /** لیست آدرس‌ها */
<span class="fc" id="L308">    ObservableList&lt;AddressItem&gt; addressList = FXCollections.observableArrayList();</span>
    
    /** اطلاعات پروفایل کاربر */
    UserProfile currentUserProfile;
    
    /** تنظیمات کاربر */
    UserSettings userSettings;
    
    /** آمار کاربر */
    UserAnalytics userAnalytics;

    /**
     * متد مقداردهی اولیه کنترلر
     * این متد پس از بارگذاری FXML فراخوانی می‌شود
     */
    @Override
    public void initialize(URL location, ResourceBundle resources) {
        // مقداردهی navigation controller
<span class="fc" id="L326">        this.navigationController = NavigationController.getInstance();</span>
        
        // راه‌اندازی UI
<span class="fc" id="L329">        setupUI();</span>
        
        // راه‌اندازی جداول
<span class="fc" id="L332">        setupTables();</span>
        
        // راه‌اندازی listeners
<span class="fc" id="L335">        setupListeners();</span>
        
        // بارگذاری داده‌های اولیه
<span class="fc" id="L338">        loadInitialData();</span>
<span class="fc" id="L339">    }</span>

    /**
     * راه‌اندازی کامپوننت‌های UI
     * تنظیمات اولیه برای همه بخش‌ها
     */
    private void setupUI() {
        // تنظیم فیلد تلفن به حالت فقط خواندنی
<span class="fc" id="L347">        phoneField.setEditable(false);</span>
<span class="fc" id="L348">        phoneField.setStyle(&quot;-fx-background-color: #e9ecef;&quot;);</span>
        
        // مقداردهی فیلترها
<span class="fc" id="L351">        orderStatusFilter.setItems(FXCollections.observableArrayList(</span>
            &quot;همه&quot;, &quot;در انتظار&quot;, &quot;در حال آماده‌سازی&quot;, &quot;آماده ارسال&quot;, 
            &quot;در حال ارسال&quot;, &quot;تحویل داده شده&quot;, &quot;لغو شده&quot;
        ));
<span class="fc" id="L355">        orderStatusFilter.setValue(&quot;همه&quot;);</span>
        
<span class="fc" id="L357">        transactionTypeFilter.setItems(FXCollections.observableArrayList(</span>
            &quot;همه&quot;, &quot;واریز&quot;, &quot;برداشت&quot;, &quot;پرداخت سفارش&quot;, &quot;بازگشت وجه&quot;
        ));
<span class="fc" id="L360">        transactionTypeFilter.setValue(&quot;همه&quot;);</span>
        
<span class="fc" id="L362">        languageComboBox.setItems(FXCollections.observableArrayList(</span>
            &quot;فارسی&quot;, &quot;English&quot;, &quot;العربية&quot;
        ));
<span class="fc" id="L365">        languageComboBox.setValue(&quot;فارسی&quot;);</span>
        
<span class="fc" id="L367">        themeComboBox.setItems(FXCollections.observableArrayList(</span>
            &quot;روشن&quot;, &quot;تیره&quot;, &quot;خودکار&quot;
        ));
<span class="fc" id="L370">        themeComboBox.setValue(&quot;روشن&quot;);</span>
        
<span class="fc" id="L372">        analyticsTimeRangeComboBox.setItems(FXCollections.observableArrayList(</span>
            &quot;هفته اخیر&quot;, &quot;ماه اخیر&quot;, &quot;3 ماه اخیر&quot;, &quot;6 ماه اخیر&quot;, &quot;سال اخیر&quot;, &quot;کل دوره&quot;
        ));
<span class="fc" id="L375">        analyticsTimeRangeComboBox.setValue(&quot;ماه اخیر&quot;);</span>
        
        // تنظیم تاریخ‌های پیش‌فرض
<span class="fc" id="L378">        orderEndDate.setValue(LocalDate.now());</span>
<span class="fc" id="L379">        orderStartDate.setValue(LocalDate.now().minusMonths(1));</span>
<span class="fc" id="L380">        transactionEndDate.setValue(LocalDate.now());</span>
<span class="fc" id="L381">        transactionStartDate.setValue(LocalDate.now().minusMonths(1));</span>
        
        // مخفی کردن loading در ابتدا
<span class="fc" id="L384">        setLoading(false);</span>
<span class="fc" id="L385">    }</span>

    /**
     * راه‌اندازی جداول با ستون‌ها و cell factory ها
     */
    private void setupTables() {
        // تنظیم جدول سفارشات
<span class="fc" id="L392">        orderIdColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;orderId&quot;));</span>
<span class="fc" id="L393">        orderDateColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;orderDate&quot;));</span>
<span class="fc" id="L394">        restaurantColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;restaurantName&quot;));</span>
<span class="fc" id="L395">        totalAmountColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;totalAmount&quot;));</span>
<span class="fc" id="L396">        orderStatusColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;status&quot;));</span>
        
        // ستون عملیات برای سفارشات
<span class="fc" id="L399">        setupOrderActionsColumn();</span>
        
        // تنظیم جدول تراکنش‌ها
<span class="fc" id="L402">        transactionIdColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;transactionId&quot;));</span>
<span class="fc" id="L403">        transactionDateColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;date&quot;));</span>
<span class="fc" id="L404">        transactionTypeColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;type&quot;));</span>
<span class="fc" id="L405">        amountColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;amount&quot;));</span>
<span class="fc" id="L406">        descriptionColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;description&quot;));</span>
<span class="fc" id="L407">        balanceAfterColumn.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;balanceAfter&quot;));</span>
        
        // Cell factory برای رنگ‌بندی مبالغ
<span class="pc" id="L410">        amountColumn.setCellFactory(column -&gt; new TableCell&lt;TransactionItem, String&gt;() {</span>
            @Override
            protected void updateItem(String item, boolean empty) {
<span class="nc" id="L413">                super.updateItem(item, empty);</span>
<span class="nc bnc" id="L414" title="All 4 branches missed.">                if (empty || item == null) {</span>
<span class="nc" id="L415">                    setText(null);</span>
<span class="nc" id="L416">                    setStyle(&quot;&quot;);</span>
                } else {
<span class="nc" id="L418">                    setText(item);</span>
<span class="nc" id="L419">                    TransactionItem transaction = getTableView().getItems().get(getIndex());</span>
<span class="nc bnc" id="L420" title="All 4 branches missed.">                    if (transaction.getType().equals(&quot;واریز&quot;) || transaction.getType().equals(&quot;بازگشت وجه&quot;)) {</span>
<span class="nc" id="L421">                        setStyle(&quot;-fx-text-fill: #28a745;&quot;); // سبز برای واریز</span>
                    } else {
<span class="nc" id="L423">                        setStyle(&quot;-fx-text-fill: #dc3545;&quot;); // قرمز برای برداشت</span>
                    }
                }
<span class="nc" id="L426">            }</span>
        });
        
        // Bind data to tables
<span class="fc" id="L430">        ordersTable.setItems(ordersList);</span>
<span class="fc" id="L431">        transactionsTable.setItems(transactionsList);</span>
<span class="fc" id="L432">    }</span>

    /**
     * راه‌اندازی ستون عملیات در جدول سفارشات
     */
    private void setupOrderActionsColumn() {
<span class="fc" id="L438">        orderActionsColumn.setCellFactory(new Callback&lt;TableColumn&lt;OrderHistoryItem, Void&gt;, TableCell&lt;OrderHistoryItem, Void&gt;&gt;() {</span>
            @Override
            public TableCell&lt;OrderHistoryItem, Void&gt; call(TableColumn&lt;OrderHistoryItem, Void&gt; param) {
<span class="nc" id="L441">                return new TableCell&lt;OrderHistoryItem, Void&gt;() {</span>
<span class="nc" id="L442">                    private final Button viewButton = new Button(&quot;مشاهده&quot;);</span>
<span class="nc" id="L443">                    private final Button reorderButton = new Button(&quot;سفارش مجدد&quot;);</span>
<span class="nc" id="L444">                    private final Button receiptButton = new Button(&quot;رسید&quot;);</span>
                    
                    {
                        // استایل دکمه‌ها
<span class="nc" id="L448">                        viewButton.setStyle(&quot;-fx-background-color: #17a2b8; -fx-text-fill: white; -fx-font-size: 12;&quot;);</span>
<span class="nc" id="L449">                        reorderButton.setStyle(&quot;-fx-background-color: #28a745; -fx-text-fill: white; -fx-font-size: 12;&quot;);</span>
<span class="nc" id="L450">                        receiptButton.setStyle(&quot;-fx-background-color: #6c757d; -fx-text-fill: white; -fx-font-size: 12;&quot;);</span>
                        
                        // Event handlers
<span class="nc" id="L453">                        viewButton.setOnAction(event -&gt; {</span>
<span class="nc" id="L454">                            OrderHistoryItem order = getTableView().getItems().get(getIndex());</span>
<span class="nc" id="L455">                            handleViewOrderDetails(order);</span>
<span class="nc" id="L456">                        });</span>
                        
<span class="nc" id="L458">                        reorderButton.setOnAction(event -&gt; {</span>
<span class="nc" id="L459">                            OrderHistoryItem order = getTableView().getItems().get(getIndex());</span>
<span class="nc" id="L460">                            handleReorder(order);</span>
<span class="nc" id="L461">                        });</span>
                        
<span class="nc" id="L463">                        receiptButton.setOnAction(event -&gt; {</span>
<span class="nc" id="L464">                            OrderHistoryItem order = getTableView().getItems().get(getIndex());</span>
<span class="nc" id="L465">                            handleDownloadReceipt(order);</span>
<span class="nc" id="L466">                        });</span>
<span class="nc" id="L467">                    }</span>
                    
                    @Override
                    protected void updateItem(Void item, boolean empty) {
<span class="nc" id="L471">                        super.updateItem(item, empty);</span>
<span class="nc bnc" id="L472" title="All 2 branches missed.">                        if (empty) {</span>
<span class="nc" id="L473">                            setGraphic(null);</span>
                        } else {
<span class="nc" id="L475">                            HBox buttons = new HBox(5);</span>
<span class="nc" id="L476">                            buttons.getChildren().addAll(viewButton, reorderButton, receiptButton);</span>
<span class="nc" id="L477">                            setGraphic(buttons);</span>
                        }
<span class="nc" id="L479">                    }</span>
                };
            }
        });
<span class="fc" id="L483">    }</span>

    /**
     * راه‌اندازی event listeners برای کامپوننت‌های مختلف
     */
    private void setupListeners() {
        // Tab change listener
<span class="fc" id="L490">        mainTabPane.getSelectionModel().selectedItemProperty().addListener((obs, oldTab, newTab) -&gt; {</span>
<span class="pc bpc" id="L491" title="1 of 2 branches missed.">            if (newTab != null) {</span>
<span class="fc" id="L492">                handleTabChange(newTab);</span>
            }
<span class="fc" id="L494">        });</span>
        
        // Profile fields listeners
<span class="fc" id="L497">        fullNameField.textProperty().addListener((obs, oldVal, newVal) -&gt; checkProfileChanges());</span>
<span class="fc" id="L498">        emailField.textProperty().addListener((obs, oldVal, newVal) -&gt; checkProfileChanges());</span>
        
        // Password fields listeners
<span class="fc" id="L501">        newPasswordField.textProperty().addListener((obs, oldVal, newVal) -&gt; validatePasswordFields());</span>
<span class="fc" id="L502">        confirmPasswordField.textProperty().addListener((obs, oldVal, newVal) -&gt; validatePasswordFields());</span>
        
        // Address list selection listener
<span class="fc" id="L505">        addressListView.getSelectionModel().selectedItemProperty().addListener((obs, oldVal, newVal) -&gt; {</span>
<span class="pc bpc" id="L506" title="1 of 2 branches missed.">            boolean hasSelection = newVal != null;</span>
<span class="pc bpc" id="L507" title="1 of 2 branches missed.">            editAddressButton.setDisable(!hasSelection);</span>
<span class="pc bpc" id="L508" title="1 of 2 branches missed.">            deleteAddressButton.setDisable(!hasSelection);</span>
<span class="fc" id="L509">        });</span>
        
        // Favorite lists selection listeners
<span class="fc" id="L512">        favoriteRestaurantsList.getSelectionModel().selectedItemProperty().addListener((obs, oldVal, newVal) -&gt; {</span>
<span class="nc" id="L513">            updateFavoriteButtons();</span>
<span class="nc" id="L514">        });</span>
        
<span class="fc" id="L516">        favoriteItemsList.getSelectionModel().selectedItemProperty().addListener((obs, oldVal, newVal) -&gt; {</span>
<span class="nc" id="L517">            updateFavoriteButtons();</span>
<span class="nc" id="L518">        });</span>
        
        // Search field listener
<span class="fc" id="L521">        orderSearchField.textProperty().addListener((obs, oldVal, newVal) -&gt; {</span>
<span class="fc" id="L522">            filterOrders();</span>
<span class="fc" id="L523">        });</span>
        
        // Filter listeners
<span class="fc" id="L526">        orderStatusFilter.valueProperty().addListener((obs, oldVal, newVal) -&gt; filterOrders());</span>
<span class="pc" id="L527">        transactionTypeFilter.valueProperty().addListener((obs, oldVal, newVal) -&gt; filterTransactions());</span>
        
        // Analytics time range listener
<span class="fc" id="L530">        analyticsTimeRangeComboBox.valueProperty().addListener((obs, oldVal, newVal) -&gt; {</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">            if (newVal != null) {</span>
<span class="nc" id="L532">                updateAnalytics(newVal);</span>
            }
<span class="nc" id="L534">        });</span>
<span class="fc" id="L535">    }</span>

    /**
     * بارگذاری داده‌های اولیه
     */
    private void loadInitialData() {
        // بارگذاری پروفایل کاربر
<span class="fc" id="L542">        loadUserProfile();</span>
        
        // بارگذاری تنظیمات
<span class="fc" id="L545">        loadUserSettings();</span>
        
        // سایر داده‌ها بر اساس تب فعال بارگذاری می‌شوند
<span class="fc" id="L548">    }</span>

    // ========== Profile Management Methods ==========
    
    /**
     * بارگذاری اطلاعات پروفایل کاربر از سرور
     */
    private void loadUserProfile() {
<span class="fc" id="L556">        setLoading(true);</span>
<span class="fc" id="L557">        setStatus(&quot;در حال بارگذاری پروفایل...&quot;);</span>
        
<span class="fc" id="L559">        Task&lt;UserProfile&gt; loadTask = new Task&lt;UserProfile&gt;() {</span>
            @Override
            protected UserProfile call() throws Exception {
<span class="fc" id="L562">                HttpClientUtil.ApiResponse response = HttpClientUtil.get(&quot;/auth/profile&quot;);</span>
                
<span class="pc bpc" id="L564" title="3 of 4 branches missed.">                if (response.isSuccess() &amp;&amp; response.getData() != null) {</span>
<span class="nc" id="L565">                    return parseUserProfile(response.getData());</span>
                } else {
<span class="pc bpc" id="L567" title="1 of 2 branches missed.">                    throw new RuntimeException(response.getMessage() != null ? </span>
<span class="pc" id="L568">                        response.getMessage() : &quot;خطا در بارگذاری پروفایل&quot;);</span>
                }
            }
        };
        
<span class="fc" id="L573">        loadTask.setOnSucceeded(e -&gt; {</span>
<span class="nc" id="L574">            Platform.runLater(() -&gt; {</span>
<span class="nc" id="L575">                setLoading(false);</span>
<span class="nc" id="L576">                currentUserProfile = loadTask.getValue();</span>
<span class="nc" id="L577">                displayUserProfile();</span>
<span class="nc" id="L578">                loadUserAddresses();</span>
<span class="nc" id="L579">                setStatus(&quot;پروفایل بارگذاری شد&quot;);</span>
<span class="nc" id="L580">            });</span>
<span class="nc" id="L581">        });</span>
        
<span class="fc" id="L583">        loadTask.setOnFailed(e -&gt; {</span>
<span class="fc" id="L584">            Platform.runLater(() -&gt; {</span>
<span class="fc" id="L585">                setLoading(false);</span>
<span class="fc" id="L586">                showError(&quot;خطا&quot;, &quot;خطا در بارگذاری پروفایل: &quot; + loadTask.getException().getMessage());</span>
<span class="fc" id="L587">                setStatus(&quot;خطا در بارگذاری&quot;);</span>
<span class="fc" id="L588">            });</span>
<span class="fc" id="L589">        });</span>
        
<span class="fc" id="L591">        new Thread(loadTask).start();</span>
<span class="fc" id="L592">    }</span>

    /**
     * پردازش اطلاعات پروفایل از JSON
     */
    private UserProfile parseUserProfile(JsonNode data) {
<span class="nc" id="L598">        UserProfile profile = new UserProfile();</span>
<span class="nc" id="L599">        profile.setId(data.get(&quot;userId&quot;).asLong());</span>
<span class="nc" id="L600">        profile.setFullName(data.get(&quot;fullName&quot;).asText());</span>
<span class="nc" id="L601">        profile.setPhone(data.get(&quot;phone&quot;).asText());</span>
<span class="nc bnc" id="L602" title="All 2 branches missed.">        profile.setEmail(data.has(&quot;email&quot;) ? data.get(&quot;email&quot;).asText() : &quot;&quot;);</span>
<span class="nc" id="L603">        profile.setRole(data.get(&quot;role&quot;).asText());</span>
<span class="nc bnc" id="L604" title="All 2 branches missed.">        profile.setActive(data.has(&quot;isActive&quot;) ? data.get(&quot;isActive&quot;).asBoolean() : true);</span>
<span class="nc bnc" id="L605" title="All 2 branches missed.">        profile.setWalletBalance(data.has(&quot;walletBalance&quot;) ? data.get(&quot;walletBalance&quot;).asDouble() : 0.0);</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">        profile.setCreatedAt(data.has(&quot;createdAt&quot;) ? data.get(&quot;createdAt&quot;).asText() : &quot;&quot;);</span>
<span class="nc" id="L607">        return profile;</span>
    }

    /**
     * نمایش اطلاعات پروفایل در UI
     */
    private void displayUserProfile() {
<span class="nc bnc" id="L614" title="All 2 branches missed.">        if (currentUserProfile == null) return;</span>
        
<span class="nc" id="L616">        fullNameField.setText(currentUserProfile.getFullName());</span>
<span class="nc" id="L617">        phoneField.setText(currentUserProfile.getPhone());</span>
<span class="nc" id="L618">        emailField.setText(currentUserProfile.getEmail());</span>
<span class="nc" id="L619">        roleLabel.setText(getRoleText(currentUserProfile.getRole()));</span>
<span class="nc bnc" id="L620" title="All 2 branches missed.">        accountStatusLabel.setText(currentUserProfile.isActive() ? &quot;فعال&quot; : &quot;غیرفعال&quot;);</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">        accountStatusLabel.setStyle(&quot;-fx-text-fill: &quot; + (currentUserProfile.isActive() ? &quot;#28a745&quot; : &quot;#dc3545&quot;));</span>
<span class="nc" id="L622">        walletBalanceLabel.setText(String.format(&quot;%,.0f تومان&quot;, currentUserProfile.getWalletBalance()));</span>
<span class="nc" id="L623">        memberSinceLabel.setText(formatDate(currentUserProfile.getCreatedAt()));</span>
<span class="nc" id="L624">    }</span>

    /**
     * بارگذاری آدرس‌های کاربر
     */
    private void loadUserAddresses() {
<span class="nc" id="L630">        Task&lt;List&lt;AddressItem&gt;&gt; loadTask = new Task&lt;List&lt;AddressItem&gt;&gt;() {</span>
            @Override
            protected List&lt;AddressItem&gt; call() throws Exception {
<span class="nc" id="L633">                HttpClientUtil.ApiResponse response = HttpClientUtil.get(&quot;/user/addresses&quot;);</span>
                
<span class="nc bnc" id="L635" title="All 4 branches missed.">                if (response.isSuccess() &amp;&amp; response.getData() != null) {</span>
<span class="nc" id="L636">                    List&lt;AddressItem&gt; addresses = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L637">                    JsonNode addressArray = response.getData();</span>
                    
<span class="nc bnc" id="L639" title="All 2 branches missed.">                    for (JsonNode addressNode : addressArray) {</span>
<span class="nc" id="L640">                        AddressItem address = new AddressItem();</span>
<span class="nc" id="L641">                        address.setId(addressNode.get(&quot;id&quot;).asLong());</span>
<span class="nc" id="L642">                        address.setTitle(addressNode.get(&quot;title&quot;).asText());</span>
<span class="nc" id="L643">                        address.setAddress(addressNode.get(&quot;address&quot;).asText());</span>
<span class="nc bnc" id="L644" title="All 4 branches missed.">                        address.setDefault(addressNode.has(&quot;isDefault&quot;) &amp;&amp; addressNode.get(&quot;isDefault&quot;).asBoolean());</span>
<span class="nc" id="L645">                        addresses.add(address);</span>
<span class="nc" id="L646">                    }</span>
                    
<span class="nc" id="L648">                    return addresses;</span>
                }
<span class="nc" id="L650">                return new ArrayList&lt;&gt;();</span>
            }
        };
        
<span class="nc" id="L654">        loadTask.setOnSucceeded(e -&gt; {</span>
<span class="nc" id="L655">            Platform.runLater(() -&gt; {</span>
<span class="nc" id="L656">                addressList.clear();</span>
<span class="nc" id="L657">                addressList.addAll(loadTask.getValue());</span>
<span class="nc" id="L658">                addressListView.setItems(addressList);</span>
<span class="nc" id="L659">            });</span>
<span class="nc" id="L660">        });</span>
        
<span class="nc" id="L662">        new Thread(loadTask).start();</span>
<span class="nc" id="L663">    }</span>

    /**
     * ذخیره تغییرات پروفایل
     */
    @FXML
    void handleSaveProfile() {
<span class="fc bfc" id="L670" title="All 2 branches covered.">        if (!validateProfileData()) return;</span>
        
<span class="fc" id="L672">        setLoading(true);</span>
<span class="fc" id="L673">        setStatus(&quot;در حال ذخیره تغییرات...&quot;);</span>
        
<span class="fc" id="L675">        Task&lt;Void&gt; saveTask = new Task&lt;Void&gt;() {</span>
            @Override
            protected Void call() throws Exception {
<span class="fc" id="L678">                Map&lt;String, Object&gt; updateData = new HashMap&lt;&gt;();</span>
<span class="fc" id="L679">                updateData.put(&quot;fullName&quot;, fullNameField.getText().trim());</span>
<span class="fc" id="L680">                updateData.put(&quot;email&quot;, emailField.getText().trim());</span>
                
<span class="fc" id="L682">                HttpClientUtil.ApiResponse response = HttpClientUtil.put(&quot;/auth/profile&quot;, updateData);</span>
                
<span class="pc bpc" id="L684" title="1 of 2 branches missed.">                if (!response.isSuccess()) {</span>
<span class="fc" id="L685">                    throw new RuntimeException(response.getMessage());</span>
                }
<span class="nc" id="L687">                return null;</span>
            }
        };
        
<span class="fc" id="L691">        saveTask.setOnSucceeded(e -&gt; {</span>
<span class="nc" id="L692">            Platform.runLater(() -&gt; {</span>
<span class="nc" id="L693">                setLoading(false);</span>
<span class="nc" id="L694">                setStatus(&quot;تغییرات با موفقیت ذخیره شد&quot;);</span>
<span class="nc" id="L695">                showSuccess(&quot;موفقیت&quot;, &quot;پروفایل با موفقیت به‌روزرسانی شد&quot;);</span>
<span class="nc" id="L696">                loadUserProfile(); // بارگذاری مجدد</span>
<span class="nc" id="L697">            });</span>
<span class="nc" id="L698">        });</span>
        
<span class="fc" id="L700">        saveTask.setOnFailed(e -&gt; {</span>
<span class="fc" id="L701">            Platform.runLater(() -&gt; {</span>
<span class="fc" id="L702">                setLoading(false);</span>
<span class="fc" id="L703">                showError(&quot;خطا&quot;, &quot;خطا در ذخیره تغییرات: &quot; + saveTask.getException().getMessage());</span>
<span class="fc" id="L704">                setStatus(&quot;خطا در ذخیره&quot;);</span>
<span class="fc" id="L705">            });</span>
<span class="fc" id="L706">        });</span>
        
<span class="fc" id="L708">        new Thread(saveTask).start();</span>
<span class="fc" id="L709">    }</span>

    /**
     * تغییر رمز عبور
     */
    @FXML
    void handleChangePassword() {
<span class="fc" id="L716">        String currentPassword = currentPasswordField.getText();</span>
<span class="fc" id="L717">        String newPassword = newPasswordField.getText();</span>
<span class="fc" id="L718">        String confirmPassword = confirmPasswordField.getText();</span>
        
<span class="fc bfc" id="L720" title="All 2 branches covered.">        if (!newPassword.equals(confirmPassword)) {</span>
<span class="fc" id="L721">            showError(&quot;خطا&quot;, &quot;رمز عبور جدید و تکرار آن یکسان نیستند&quot;);</span>
<span class="fc" id="L722">            return;</span>
        }
        
<span class="fc bfc" id="L725" title="All 2 branches covered.">        if (newPassword.length() &lt; 4) {</span>
<span class="fc" id="L726">            showError(&quot;خطا&quot;, &quot;رمز عبور باید حداقل 4 کاراکتر باشد&quot;);</span>
<span class="fc" id="L727">            return;</span>
        }
        
<span class="fc" id="L730">        setLoading(true);</span>
<span class="fc" id="L731">        setStatus(&quot;در حال تغییر رمز عبور...&quot;);</span>
        
<span class="fc" id="L733">        Task&lt;Void&gt; changePasswordTask = new Task&lt;Void&gt;() {</span>
            @Override
            protected Void call() throws Exception {
<span class="fc" id="L736">                Map&lt;String, String&gt; passwordData = new HashMap&lt;&gt;();</span>
<span class="fc" id="L737">                passwordData.put(&quot;currentPassword&quot;, currentPassword);</span>
<span class="fc" id="L738">                passwordData.put(&quot;newPassword&quot;, newPassword);</span>
                
<span class="nc" id="L740">                HttpClientUtil.ApiResponse response = HttpClientUtil.post(&quot;/auth/change-password&quot;, passwordData);</span>
                
<span class="nc bnc" id="L742" title="All 2 branches missed.">                if (!response.isSuccess()) {</span>
<span class="nc" id="L743">                    throw new RuntimeException(response.getMessage());</span>
                }
<span class="nc" id="L745">                return null;</span>
            }
        };
        
<span class="fc" id="L749">        changePasswordTask.setOnSucceeded(e -&gt; {</span>
<span class="nc" id="L750">            Platform.runLater(() -&gt; {</span>
<span class="nc" id="L751">                setLoading(false);</span>
<span class="nc" id="L752">                setStatus(&quot;رمز عبور با موفقیت تغییر یافت&quot;);</span>
<span class="nc" id="L753">                showSuccess(&quot;موفقیت&quot;, &quot;رمز عبور با موفقیت تغییر یافت&quot;);</span>
<span class="nc" id="L754">                clearPasswordFields();</span>
<span class="nc" id="L755">            });</span>
<span class="nc" id="L756">        });</span>
        
<span class="fc" id="L758">        changePasswordTask.setOnFailed(e -&gt; {</span>
<span class="fc" id="L759">            Platform.runLater(() -&gt; {</span>
<span class="fc" id="L760">                setLoading(false);</span>
<span class="fc" id="L761">                showError(&quot;خطا&quot;, &quot;خطا در تغییر رمز عبور: &quot; + changePasswordTask.getException().getMessage());</span>
<span class="fc" id="L762">                setStatus(&quot;خطا در تغییر رمز&quot;);</span>
<span class="fc" id="L763">            });</span>
<span class="fc" id="L764">        });</span>
        
<span class="fc" id="L766">        new Thread(changePasswordTask).start();</span>
<span class="fc" id="L767">    }</span>

    // ========== Orders Management Methods ==========
    
    /**
     * بارگذاری تاریخچه سفارشات
     */
    private void loadOrderHistory() {
<span class="fc" id="L775">        setLoading(true);</span>
<span class="fc" id="L776">        setStatus(&quot;در حال بارگذاری سفارشات...&quot;);</span>
        
<span class="fc" id="L778">        Task&lt;List&lt;OrderHistoryItem&gt;&gt; loadTask = new Task&lt;List&lt;OrderHistoryItem&gt;&gt;() {</span>
            @Override
            protected List&lt;OrderHistoryItem&gt; call() throws Exception {
<span class="fc" id="L781">                HttpClientUtil.ApiResponse response = HttpClientUtil.get(&quot;/orders/history&quot;);</span>
                
<span class="pc bpc" id="L783" title="3 of 4 branches missed.">                if (response.isSuccess() &amp;&amp; response.getData() != null) {</span>
<span class="nc" id="L784">                    List&lt;OrderHistoryItem&gt; orders = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L785">                    JsonNode ordersArray = response.getData();</span>
                    
<span class="nc bnc" id="L787" title="All 2 branches missed.">                    for (JsonNode orderNode : ordersArray) {</span>
<span class="nc" id="L788">                        OrderHistoryItem order = new OrderHistoryItem();</span>
<span class="nc" id="L789">                        order.setOrderId(orderNode.get(&quot;orderId&quot;).asText());</span>
<span class="nc" id="L790">                        order.setOrderDate(formatDateTime(orderNode.get(&quot;createdAt&quot;).asText()));</span>
<span class="nc" id="L791">                        order.setRestaurantName(orderNode.get(&quot;restaurantName&quot;).asText());</span>
<span class="nc" id="L792">                        order.setTotalAmount(String.format(&quot;%,.0f تومان&quot;, orderNode.get(&quot;totalAmount&quot;).asDouble()));</span>
<span class="nc" id="L793">                        order.setStatus(getOrderStatusText(orderNode.get(&quot;status&quot;).asText()));</span>
<span class="nc" id="L794">                        order.setItems(parseOrderItems(orderNode.get(&quot;items&quot;)));</span>
<span class="nc" id="L795">                        orders.add(order);</span>
<span class="nc" id="L796">                    }</span>
                    
<span class="nc" id="L798">                    return orders;</span>
                }
<span class="fc" id="L800">                return new ArrayList&lt;&gt;();</span>
            }
        };
        
<span class="fc" id="L804">        loadTask.setOnSucceeded(e -&gt; {</span>
<span class="fc" id="L805">            Platform.runLater(() -&gt; {</span>
<span class="fc" id="L806">                setLoading(false);</span>
<span class="fc" id="L807">                ordersList.clear();</span>
<span class="fc" id="L808">                ordersList.addAll(loadTask.getValue());</span>
<span class="fc" id="L809">                updateOrderStatistics();</span>
<span class="fc" id="L810">                setStatus(&quot;سفارشات بارگذاری شد&quot;);</span>
<span class="fc" id="L811">            });</span>
<span class="fc" id="L812">        });</span>
        
<span class="fc" id="L814">        loadTask.setOnFailed(e -&gt; {</span>
<span class="nc" id="L815">            Platform.runLater(() -&gt; {</span>
<span class="nc" id="L816">                setLoading(false);</span>
<span class="nc" id="L817">                showError(&quot;خطا&quot;, &quot;خطا در بارگذاری سفارشات&quot;);</span>
<span class="nc" id="L818">                setStatus(&quot;خطا در بارگذاری&quot;);</span>
<span class="nc" id="L819">            });</span>
<span class="nc" id="L820">        });</span>
        
<span class="fc" id="L822">        new Thread(loadTask).start();</span>
<span class="fc" id="L823">    }</span>

    /**
     * فیلتر کردن سفارشات
     */
    private void filterOrders() {
<span class="fc" id="L829">        String searchText = orderSearchField.getText().toLowerCase();</span>
<span class="fc" id="L830">        String statusFilter = orderStatusFilter.getValue();</span>
<span class="fc" id="L831">        LocalDate startDate = orderStartDate.getValue();</span>
<span class="fc" id="L832">        LocalDate endDate = orderEndDate.getValue();</span>
        
<span class="fc" id="L834">        List&lt;OrderHistoryItem&gt; filteredList = ordersList.stream()</span>
<span class="fc" id="L835">            .filter(order -&gt; {</span>
                // فیلتر متن جستجو
<span class="pc bpc" id="L837" title="1 of 2 branches missed.">                boolean matchesSearch = searchText.isEmpty() || </span>
<span class="fc bfc" id="L838" title="All 2 branches covered.">                    order.getRestaurantName().toLowerCase().contains(searchText) ||</span>
<span class="pc bpc" id="L839" title="1 of 2 branches missed.">                    order.getOrderId().toLowerCase().contains(searchText);</span>
                
                // فیلتر وضعیت
<span class="fc bfc" id="L842" title="All 2 branches covered.">                boolean matchesStatus = statusFilter.equals(&quot;همه&quot;) || </span>
<span class="fc bfc" id="L843" title="All 2 branches covered.">                    order.getStatus().equals(statusFilter);</span>
                
                // فیلتر تاریخ
<span class="fc" id="L846">                boolean matchesDate = true; // TODO: implement date filtering</span>
                
<span class="pc bpc" id="L848" title="1 of 6 branches missed.">                return matchesSearch &amp;&amp; matchesStatus &amp;&amp; matchesDate;</span>
            })
<span class="fc" id="L850">            .collect(Collectors.toList());</span>
        
<span class="fc" id="L852">        ordersTable.setItems(FXCollections.observableArrayList(filteredList));</span>
<span class="fc" id="L853">    }</span>

    /**
     * مشاهده جزئیات سفارش
     */
    void handleViewOrderDetails(OrderHistoryItem order) {
        // TODO: نمایش دیالوگ جزئیات سفارش
<span class="fc" id="L860">        showInfo(&quot;جزئیات سفارش&quot;, &quot;شماره سفارش: &quot; + order.getOrderId() + &quot;\n&quot; +</span>
<span class="fc" id="L861">                                  &quot;رستوران: &quot; + order.getRestaurantName() + &quot;\n&quot; +</span>
<span class="fc" id="L862">                                  &quot;مبلغ: &quot; + order.getTotalAmount() + &quot;\n&quot; +</span>
<span class="fc" id="L863">                                  &quot;وضعیت: &quot; + order.getStatus());</span>
<span class="fc" id="L864">    }</span>

    /**
     * سفارش مجدد
     */
    void handleReorder(OrderHistoryItem order) {
<span class="fc" id="L870">        Alert confirmAlert = new Alert(Alert.AlertType.CONFIRMATION);</span>
<span class="fc" id="L871">        confirmAlert.setTitle(&quot;تأیید سفارش مجدد&quot;);</span>
<span class="fc" id="L872">        confirmAlert.setHeaderText(&quot;آیا می‌خواهید این سفارش را مجدداً ثبت کنید؟&quot;);</span>
<span class="fc" id="L873">        confirmAlert.setContentText(&quot;آیتم‌های این سفارش به سبد خرید شما اضافه خواهند شد.&quot;);</span>
        
<span class="fc" id="L875">        confirmAlert.showAndWait().ifPresent(response -&gt; {</span>
<span class="nc bnc" id="L876" title="All 2 branches missed.">            if (response == ButtonType.OK) {</span>
                // TODO: افزودن آیتم‌ها به سبد خرید
<span class="nc" id="L878">                showSuccess(&quot;موفقیت&quot;, &quot;آیتم‌ها به سبد خرید اضافه شدند&quot;);</span>
<span class="nc" id="L879">                navigationController.navigateTo(NavigationController.CART_SCENE);</span>
            }
<span class="nc" id="L881">        });</span>
<span class="fc" id="L882">    }</span>

    /**
     * دانلود رسید سفارش
     */
    void handleDownloadReceipt(OrderHistoryItem order) {
        try {
<span class="fc" id="L889">            String receipt = generateReceipt(order);</span>
<span class="fc" id="L890">            File file = new File(&quot;receipt_&quot; + order.getOrderId() + &quot;.txt&quot;);</span>
            
<span class="fc" id="L892">            try (FileWriter writer = new FileWriter(file)) {</span>
<span class="fc" id="L893">                writer.write(receipt);</span>
            }
            
<span class="fc" id="L896">            showSuccess(&quot;موفقیت&quot;, &quot;رسید در فایل &quot; + file.getName() + &quot; ذخیره شد&quot;);</span>
<span class="nc" id="L897">        } catch (IOException e) {</span>
<span class="nc" id="L898">            showError(&quot;خطا&quot;, &quot;خطا در ذخیره رسید: &quot; + e.getMessage());</span>
<span class="fc" id="L899">        }</span>
<span class="fc" id="L900">    }</span>

    // ========== Transaction Management Methods ==========
    
    /**
     * بارگذاری تاریخچه تراکنش‌های مالی
     */
    private void loadTransactionHistory() {
<span class="fc" id="L908">        setLoading(true);</span>
<span class="fc" id="L909">        setStatus(&quot;در حال بارگذاری تراکنش‌ها...&quot;);</span>
        
<span class="fc" id="L911">        Task&lt;List&lt;TransactionItem&gt;&gt; loadTask = new Task&lt;List&lt;TransactionItem&gt;&gt;() {</span>
            @Override
            protected List&lt;TransactionItem&gt; call() throws Exception {
<span class="fc" id="L914">                HttpClientUtil.ApiResponse response = HttpClientUtil.get(&quot;/wallet/transactions&quot;);</span>
                
<span class="pc bpc" id="L916" title="3 of 4 branches missed.">                if (response.isSuccess() &amp;&amp; response.getData() != null) {</span>
<span class="nc" id="L917">                    List&lt;TransactionItem&gt; transactions = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L918">                    JsonNode transArray = response.getData();</span>
                    
<span class="nc bnc" id="L920" title="All 2 branches missed.">                    for (JsonNode transNode : transArray) {</span>
<span class="nc" id="L921">                        TransactionItem trans = new TransactionItem();</span>
<span class="nc" id="L922">                        trans.setTransactionId(transNode.get(&quot;transactionId&quot;).asText());</span>
<span class="nc" id="L923">                        trans.setDate(formatDateTime(transNode.get(&quot;createdAt&quot;).asText()));</span>
<span class="nc" id="L924">                        trans.setType(getTransactionTypeText(transNode.get(&quot;type&quot;).asText()));</span>
<span class="nc" id="L925">                        trans.setAmount(String.format(&quot;%,.0f تومان&quot;, transNode.get(&quot;amount&quot;).asDouble()));</span>
<span class="nc" id="L926">                        trans.setDescription(transNode.get(&quot;description&quot;).asText());</span>
<span class="nc" id="L927">                        trans.setBalanceAfter(String.format(&quot;%,.0f تومان&quot;, transNode.get(&quot;balanceAfter&quot;).asDouble()));</span>
<span class="nc" id="L928">                        transactions.add(trans);</span>
<span class="nc" id="L929">                    }</span>
                    
<span class="nc" id="L931">                    return transactions;</span>
                }
<span class="fc" id="L933">                return new ArrayList&lt;&gt;();</span>
            }
        };
        
<span class="fc" id="L937">        loadTask.setOnSucceeded(e -&gt; {</span>
<span class="fc" id="L938">            Platform.runLater(() -&gt; {</span>
<span class="fc" id="L939">                setLoading(false);</span>
<span class="fc" id="L940">                transactionsList.clear();</span>
<span class="fc" id="L941">                transactionsList.addAll(loadTask.getValue());</span>
<span class="fc" id="L942">                setStatus(&quot;تراکنش‌ها بارگذاری شد&quot;);</span>
<span class="fc" id="L943">            });</span>
<span class="fc" id="L944">        });</span>
        
<span class="fc" id="L946">        new Thread(loadTask).start();</span>
<span class="fc" id="L947">    }</span>

    /**
     * فیلتر کردن تراکنش‌ها
     */
    private void filterTransactions() {
<span class="nc" id="L953">        String typeFilter = transactionTypeFilter.getValue();</span>
<span class="nc" id="L954">        LocalDate startDate = transactionStartDate.getValue();</span>
<span class="nc" id="L955">        LocalDate endDate = transactionEndDate.getValue();</span>
        
<span class="nc" id="L957">        List&lt;TransactionItem&gt; filteredList = transactionsList.stream()</span>
<span class="nc" id="L958">            .filter(trans -&gt; {</span>
<span class="nc bnc" id="L959" title="All 4 branches missed.">                boolean matchesType = typeFilter.equals(&quot;همه&quot;) || trans.getType().equals(typeFilter);</span>
                // TODO: implement date filtering
<span class="nc" id="L961">                return matchesType;</span>
            })
<span class="nc" id="L963">            .collect(Collectors.toList());</span>
        
<span class="nc" id="L965">        transactionsTable.setItems(FXCollections.observableArrayList(filteredList));</span>
<span class="nc" id="L966">    }</span>

    // ========== Favorites Management Methods ==========
    
    /**
     * بارگذاری علاقه‌مندی‌ها
     */
    private void loadFavorites() {
<span class="fc" id="L974">        loadFavoriteRestaurants();</span>
<span class="fc" id="L975">        loadFavoriteItems();</span>
<span class="fc" id="L976">    }</span>

    /**
     * بارگذاری رستوران‌های مورد علاقه
     */
    private void loadFavoriteRestaurants() {
<span class="fc" id="L982">        Task&lt;List&lt;FavoriteRestaurant&gt;&gt; loadTask = new Task&lt;List&lt;FavoriteRestaurant&gt;&gt;() {</span>
            @Override
            protected List&lt;FavoriteRestaurant&gt; call() throws Exception {
<span class="fc" id="L985">                HttpClientUtil.ApiResponse response = HttpClientUtil.get(&quot;/favorites/restaurants&quot;);</span>
                
<span class="pc bpc" id="L987" title="3 of 4 branches missed.">                if (response.isSuccess() &amp;&amp; response.getData() != null) {</span>
<span class="nc" id="L988">                    List&lt;FavoriteRestaurant&gt; favorites = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L989">                    JsonNode favArray = response.getData();</span>
                    
<span class="nc bnc" id="L991" title="All 2 branches missed.">                    for (JsonNode favNode : favArray) {</span>
<span class="nc" id="L992">                        FavoriteRestaurant fav = new FavoriteRestaurant();</span>
<span class="nc" id="L993">                        fav.setId(favNode.get(&quot;id&quot;).asLong());</span>
<span class="nc" id="L994">                        fav.setRestaurantId(favNode.get(&quot;restaurantId&quot;).asLong());</span>
<span class="nc" id="L995">                        fav.setName(favNode.get(&quot;restaurantName&quot;).asText());</span>
<span class="nc" id="L996">                        fav.setRating(favNode.get(&quot;rating&quot;).asDouble());</span>
<span class="nc" id="L997">                        fav.setOrderCount(favNode.get(&quot;orderCount&quot;).asInt());</span>
<span class="nc" id="L998">                        favorites.add(fav);</span>
<span class="nc" id="L999">                    }</span>
                    
<span class="nc" id="L1001">                    return favorites;</span>
                }
<span class="fc" id="L1003">                return new ArrayList&lt;&gt;();</span>
            }
        };
        
<span class="fc" id="L1007">        loadTask.setOnSucceeded(e -&gt; {</span>
<span class="fc" id="L1008">            Platform.runLater(() -&gt; {</span>
<span class="fc" id="L1009">                favoriteRestaurants.clear();</span>
<span class="fc" id="L1010">                favoriteRestaurants.addAll(loadTask.getValue());</span>
<span class="fc" id="L1011">                favoriteRestaurantsList.setItems(favoriteRestaurants);</span>
<span class="fc" id="L1012">                favoriteRestaurantsCountLabel.setText(String.valueOf(favoriteRestaurants.size()));</span>
<span class="fc" id="L1013">            });</span>
<span class="fc" id="L1014">        });</span>
        
<span class="fc" id="L1016">        new Thread(loadTask).start();</span>
<span class="fc" id="L1017">    }</span>

    /**
     * بارگذاری آیتم‌های مورد علاقه
     */
    private void loadFavoriteItems() {
<span class="fc" id="L1023">        Task&lt;List&lt;FavoriteItem&gt;&gt; loadTask = new Task&lt;List&lt;FavoriteItem&gt;&gt;() {</span>
            @Override
            protected List&lt;FavoriteItem&gt; call() throws Exception {
<span class="fc" id="L1026">                HttpClientUtil.ApiResponse response = HttpClientUtil.get(&quot;/favorites/items&quot;);</span>
                
<span class="pc bpc" id="L1028" title="3 of 4 branches missed.">                if (response.isSuccess() &amp;&amp; response.getData() != null) {</span>
<span class="nc" id="L1029">                    List&lt;FavoriteItem&gt; favorites = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L1030">                    JsonNode favArray = response.getData();</span>
                    
<span class="nc bnc" id="L1032" title="All 2 branches missed.">                    for (JsonNode favNode : favArray) {</span>
<span class="nc" id="L1033">                        FavoriteItem fav = new FavoriteItem();</span>
<span class="nc" id="L1034">                        fav.setId(favNode.get(&quot;id&quot;).asLong());</span>
<span class="nc" id="L1035">                        fav.setItemId(favNode.get(&quot;itemId&quot;).asLong());</span>
<span class="nc" id="L1036">                        fav.setName(favNode.get(&quot;itemName&quot;).asText());</span>
<span class="nc" id="L1037">                        fav.setRestaurantName(favNode.get(&quot;restaurantName&quot;).asText());</span>
<span class="nc" id="L1038">                        fav.setPrice(favNode.get(&quot;price&quot;).asDouble());</span>
<span class="nc" id="L1039">                        favorites.add(fav);</span>
<span class="nc" id="L1040">                    }</span>
                    
<span class="nc" id="L1042">                    return favorites;</span>
                }
<span class="fc" id="L1044">                return new ArrayList&lt;&gt;();</span>
            }
        };
        
<span class="fc" id="L1048">        loadTask.setOnSucceeded(e -&gt; {</span>
<span class="fc" id="L1049">            Platform.runLater(() -&gt; {</span>
<span class="fc" id="L1050">                favoriteItems.clear();</span>
<span class="fc" id="L1051">                favoriteItems.addAll(loadTask.getValue());</span>
<span class="fc" id="L1052">                favoriteItemsList.setItems(favoriteItems);</span>
<span class="fc" id="L1053">                favoriteItemsCountLabel.setText(String.valueOf(favoriteItems.size()));</span>
<span class="fc" id="L1054">            });</span>
<span class="fc" id="L1055">        });</span>
        
<span class="fc" id="L1057">        new Thread(loadTask).start();</span>
<span class="fc" id="L1058">    }</span>

    // ========== Settings Management Methods ==========
    
    /**
     * بارگذاری تنظیمات کاربر
     */
    private void loadUserSettings() {
<span class="fc" id="L1066">        Task&lt;UserSettings&gt; loadTask = new Task&lt;UserSettings&gt;() {</span>
            @Override
            protected UserSettings call() throws Exception {
<span class="fc" id="L1069">                HttpClientUtil.ApiResponse response = HttpClientUtil.get(&quot;/user/settings&quot;);</span>
                
<span class="pc bpc" id="L1071" title="3 of 4 branches missed.">                if (response.isSuccess() &amp;&amp; response.getData() != null) {</span>
<span class="nc" id="L1072">                    JsonNode data = response.getData();</span>
<span class="nc" id="L1073">                    UserSettings settings = new UserSettings();</span>
<span class="nc" id="L1074">                    settings.setEmailNotifications(data.get(&quot;emailNotifications&quot;).asBoolean());</span>
<span class="nc" id="L1075">                    settings.setSmsNotifications(data.get(&quot;smsNotifications&quot;).asBoolean());</span>
<span class="nc" id="L1076">                    settings.setPushNotifications(data.get(&quot;pushNotifications&quot;).asBoolean());</span>
<span class="nc" id="L1077">                    settings.setLanguage(data.get(&quot;language&quot;).asText());</span>
<span class="nc" id="L1078">                    settings.setTheme(data.get(&quot;theme&quot;).asText());</span>
<span class="nc" id="L1079">                    settings.setShareData(data.get(&quot;shareData&quot;).asBoolean());</span>
<span class="nc" id="L1080">                    settings.setShowProfile(data.get(&quot;showProfile&quot;).asBoolean());</span>
<span class="nc" id="L1081">                    return settings;</span>
                }
<span class="fc" id="L1083">                return new UserSettings(); // Default settings</span>
            }
        };
        
<span class="fc" id="L1087">        loadTask.setOnSucceeded(e -&gt; {</span>
<span class="fc" id="L1088">            Platform.runLater(() -&gt; {</span>
<span class="fc" id="L1089">                userSettings = loadTask.getValue();</span>
<span class="fc" id="L1090">                displayUserSettings();</span>
<span class="fc" id="L1091">            });</span>
<span class="fc" id="L1092">        });</span>
        
<span class="fc" id="L1094">        new Thread(loadTask).start();</span>
<span class="fc" id="L1095">    }</span>

    /**
     * نمایش تنظیمات در UI
     */
    private void displayUserSettings() {
<span class="pc bpc" id="L1101" title="1 of 2 branches missed.">        if (userSettings == null) return;</span>
        
<span class="fc" id="L1103">        emailNotificationCheckBox.setSelected(userSettings.isEmailNotifications());</span>
<span class="fc" id="L1104">        smsNotificationCheckBox.setSelected(userSettings.isSmsNotifications());</span>
<span class="fc" id="L1105">        pushNotificationCheckBox.setSelected(userSettings.isPushNotifications());</span>
<span class="fc" id="L1106">        languageComboBox.setValue(userSettings.getLanguage());</span>
<span class="fc" id="L1107">        themeComboBox.setValue(userSettings.getTheme());</span>
<span class="fc" id="L1108">        shareDataCheckBox.setSelected(userSettings.isShareData());</span>
<span class="fc" id="L1109">        showProfileCheckBox.setSelected(userSettings.isShowProfile());</span>
<span class="fc" id="L1110">    }</span>

    /**
     * ذخیره تنظیمات
     */
    @FXML
    void handleSaveSettings() {
<span class="fc" id="L1117">        setLoading(true);</span>
<span class="fc" id="L1118">        setStatus(&quot;در حال ذخیره تنظیمات...&quot;);</span>
        
<span class="fc" id="L1120">        Task&lt;Void&gt; saveTask = new Task&lt;Void&gt;() {</span>
            @Override
            protected Void call() throws Exception {
<span class="fc" id="L1123">                Map&lt;String, Object&gt; settings = new HashMap&lt;&gt;();</span>
<span class="fc" id="L1124">                settings.put(&quot;emailNotifications&quot;, emailNotificationCheckBox.isSelected());</span>
<span class="fc" id="L1125">                settings.put(&quot;smsNotifications&quot;, smsNotificationCheckBox.isSelected());</span>
<span class="fc" id="L1126">                settings.put(&quot;pushNotifications&quot;, pushNotificationCheckBox.isSelected());</span>
<span class="fc" id="L1127">                settings.put(&quot;language&quot;, languageComboBox.getValue());</span>
<span class="fc" id="L1128">                settings.put(&quot;theme&quot;, themeComboBox.getValue());</span>
<span class="fc" id="L1129">                settings.put(&quot;shareData&quot;, shareDataCheckBox.isSelected());</span>
<span class="fc" id="L1130">                settings.put(&quot;showProfile&quot;, showProfileCheckBox.isSelected());</span>
                
<span class="fc" id="L1132">                HttpClientUtil.ApiResponse response = HttpClientUtil.put(&quot;/user/settings&quot;, settings);</span>
                
<span class="pc bpc" id="L1134" title="1 of 2 branches missed.">                if (!response.isSuccess()) {</span>
<span class="fc" id="L1135">                    throw new RuntimeException(response.getMessage());</span>
                }
<span class="nc" id="L1137">                return null;</span>
            }
        };
        
<span class="fc" id="L1141">        saveTask.setOnSucceeded(e -&gt; {</span>
<span class="nc" id="L1142">            Platform.runLater(() -&gt; {</span>
<span class="nc" id="L1143">                setLoading(false);</span>
<span class="nc" id="L1144">                setStatus(&quot;تنظیمات ذخیره شد&quot;);</span>
<span class="nc" id="L1145">                showSuccess(&quot;موفقیت&quot;, &quot;تنظیمات با موفقیت ذخیره شد&quot;);</span>
<span class="nc" id="L1146">            });</span>
<span class="nc" id="L1147">        });</span>
        
<span class="fc" id="L1149">        new Thread(saveTask).start();</span>
<span class="fc" id="L1150">    }</span>

    // ========== Analytics Methods ==========
    
    /**
     * بروزرسانی آمار و تحلیل‌ها
     */
    private void updateAnalytics(String timeRange) {
<span class="nc" id="L1158">        loadOrderAnalytics(timeRange);</span>
<span class="nc" id="L1159">        loadSpendingAnalytics(timeRange);</span>
<span class="nc" id="L1160">    }</span>

    /**
     * بارگذاری آمار سفارشات
     */
    private void loadOrderAnalytics(String timeRange) {
        // TODO: implement order analytics loading
        // نمونه داده‌های آزمایشی
<span class="nc" id="L1168">        ObservableList&lt;PieChart.Data&gt; pieChartData = FXCollections.observableArrayList(</span>
            new PieChart.Data(&quot;پیتزا&quot;, 35),
            new PieChart.Data(&quot;برگر&quot;, 25),
            new PieChart.Data(&quot;کباب&quot;, 20),
            new PieChart.Data(&quot;سالاد&quot;, 10),
            new PieChart.Data(&quot;سایر&quot;, 10)
        );
<span class="nc" id="L1175">        orderDistributionChart.setData(pieChartData);</span>
<span class="nc" id="L1176">    }</span>

    /**
     * بارگذاری آمار مالی
     */
    private void loadSpendingAnalytics(String timeRange) {
        // TODO: implement spending analytics loading
        // نمونه داده‌های آزمایشی
<span class="nc" id="L1184">        XYChart.Series&lt;String, Number&gt; series = new XYChart.Series&lt;&gt;();</span>
<span class="nc" id="L1185">        series.setName(&quot;مخارج ماهانه&quot;);</span>
        
<span class="nc" id="L1187">        series.getData().add(new XYChart.Data&lt;&gt;(&quot;فروردین&quot;, 850000));</span>
<span class="nc" id="L1188">        series.getData().add(new XYChart.Data&lt;&gt;(&quot;اردیبهشت&quot;, 920000));</span>
<span class="nc" id="L1189">        series.getData().add(new XYChart.Data&lt;&gt;(&quot;خرداد&quot;, 780000));</span>
<span class="nc" id="L1190">        series.getData().add(new XYChart.Data&lt;&gt;(&quot;تیر&quot;, 1100000));</span>
        
<span class="nc" id="L1192">        spendingTrendChart.getData().clear();</span>
<span class="nc" id="L1193">        spendingTrendChart.getData().add(series);</span>
        
        // بروزرسانی برچسب‌ها
<span class="nc" id="L1196">        averageMonthlySpendLabel.setText(&quot;890,000 تومان&quot;);</span>
<span class="nc" id="L1197">        topRestaurantLabel.setText(&quot;رستوران ایتالیایی&quot;);</span>
<span class="nc" id="L1198">        topFoodItemLabel.setText(&quot;پیتزا مخصوص&quot;);</span>
<span class="nc" id="L1199">        totalOrdersAnalyticsLabel.setText(&quot;45 سفارش&quot;);</span>
<span class="nc" id="L1200">        totalSpentAnalyticsLabel.setText(&quot;3,650,000 تومان&quot;);</span>
<span class="nc" id="L1201">    }</span>

    // ========== Helper Methods ==========
    
    /**
     * مدیریت تغییر تب
     */
    private void handleTabChange(Tab newTab) {
<span class="pc bpc" id="L1209" title="1 of 4 branches missed.">        if (newTab == ordersTab &amp;&amp; ordersList.isEmpty()) {</span>
<span class="fc" id="L1210">            loadOrderHistory();</span>
<span class="pc bpc" id="L1211" title="1 of 4 branches missed.">        } else if (newTab == transactionsTab &amp;&amp; transactionsList.isEmpty()) {</span>
<span class="fc" id="L1212">            loadTransactionHistory();</span>
<span class="pc bpc" id="L1213" title="2 of 4 branches missed.">        } else if (newTab == favoritesTab &amp;&amp; favoriteRestaurants.isEmpty()) {</span>
<span class="fc" id="L1214">            loadFavorites();</span>
<span class="nc bnc" id="L1215" title="All 2 branches missed.">        } else if (newTab == analyticsTab) {</span>
<span class="nc" id="L1216">            updateAnalytics(analyticsTimeRangeComboBox.getValue());</span>
        }
<span class="fc" id="L1218">    }</span>

    /**
     * بررسی تغییرات پروفایل
     */
    private void checkProfileChanges() {
<span class="pc bpc" id="L1224" title="1 of 2 branches missed.">        if (currentUserProfile == null) return;</span>
        
<span class="nc bnc" id="L1226" title="All 2 branches missed.">        boolean hasChanges = !fullNameField.getText().equals(currentUserProfile.getFullName()) ||</span>
<span class="nc bnc" id="L1227" title="All 2 branches missed.">                           !emailField.getText().equals(currentUserProfile.getEmail());</span>
        
<span class="nc bnc" id="L1229" title="All 2 branches missed.">        saveProfileButton.setDisable(!hasChanges);</span>
<span class="nc" id="L1230">    }</span>

    /**
     * اعتبارسنجی فیلدهای رمز عبور
     */
    private void validatePasswordFields() {
<span class="fc" id="L1236">        String newPassword = newPasswordField.getText();</span>
<span class="fc" id="L1237">        String confirmPassword = confirmPasswordField.getText();</span>
<span class="fc" id="L1238">        String currentPassword = currentPasswordField.getText();</span>
        
<span class="fc" id="L1240">        boolean passwordsMatch = newPassword.equals(confirmPassword);</span>
<span class="fc bfc" id="L1241" title="All 2 branches covered.">        boolean hasCurrentPassword = !currentPassword.trim().isEmpty();</span>
<span class="pc bpc" id="L1242" title="1 of 2 branches missed.">        boolean hasNewPassword = !newPassword.trim().isEmpty();</span>
<span class="fc bfc" id="L1243" title="All 2 branches covered.">        boolean passwordLengthValid = newPassword.length() &gt;= 4;</span>
        
<span class="pc bpc" id="L1245" title="2 of 8 branches missed.">        changePasswordButton.setDisable(!(hasCurrentPassword &amp;&amp; hasNewPassword &amp;&amp; </span>
                                        passwordsMatch &amp;&amp; passwordLengthValid));
<span class="fc" id="L1247">    }</span>

    /**
     * اعتبارسنجی داده‌های پروفایل
     */
    private boolean validateProfileData() {
<span class="fc" id="L1253">        String fullName = fullNameField.getText().trim();</span>
<span class="fc" id="L1254">        String email = emailField.getText().trim();</span>
        
<span class="fc bfc" id="L1256" title="All 2 branches covered.">        if (fullName.isEmpty()) {</span>
<span class="fc" id="L1257">            showError(&quot;خطا&quot;, &quot;نام کامل نمی‌تواند خالی باشد&quot;);</span>
<span class="fc" id="L1258">            return false;</span>
        }
        
<span class="pc bpc" id="L1261" title="2 of 4 branches missed.">        if (!email.isEmpty() &amp;&amp; !isValidEmail(email)) {</span>
<span class="nc" id="L1262">            showError(&quot;خطا&quot;, &quot;فرمت ایمیل صحیح نیست&quot;);</span>
<span class="nc" id="L1263">            return false;</span>
        }
        
<span class="fc" id="L1266">        return true;</span>
    }

    /**
     * بررسی صحت ایمیل
     */
    private boolean isValidEmail(String email) {
<span class="fc" id="L1273">        return email.matches(&quot;^[A-Za-z0-9+_.-]+@([A-Za-z0-9.-]+\\.[A-Za-z]{2,})$&quot;);</span>
    }

    /**
     * پاک کردن فیلدهای رمز عبور
     */
    private void clearPasswordFields() {
<span class="nc" id="L1280">        currentPasswordField.clear();</span>
<span class="nc" id="L1281">        newPasswordField.clear();</span>
<span class="nc" id="L1282">        confirmPasswordField.clear();</span>
<span class="nc" id="L1283">    }</span>

    /**
     * بروزرسانی دکمه‌های علاقه‌مندی
     */
    private void updateFavoriteButtons() {
<span class="nc bnc" id="L1289" title="All 2 branches missed.">        boolean hasRestaurantSelection = favoriteRestaurantsList.getSelectionModel().getSelectedItem() != null;</span>
<span class="nc bnc" id="L1290" title="All 2 branches missed.">        boolean hasItemSelection = favoriteItemsList.getSelectionModel().getSelectedItem() != null;</span>
        
<span class="nc bnc" id="L1292" title="All 4 branches missed.">        removeFavoriteButton.setDisable(!hasRestaurantSelection &amp;&amp; !hasItemSelection);</span>
<span class="nc bnc" id="L1293" title="All 2 branches missed.">        reorderFavoriteButton.setDisable(!hasItemSelection);</span>
<span class="nc" id="L1294">    }</span>

    /**
     * بروزرسانی آمار سفارشات
     */
    void updateOrderStatistics() {
<span class="fc" id="L1300">        int totalOrders = ordersList.size();</span>
<span class="fc" id="L1301">        double totalSpent = ordersList.stream()</span>
<span class="fc" id="L1302">            .mapToDouble(order -&gt; {</span>
<span class="fc" id="L1303">                String amount = order.getTotalAmount().replaceAll(&quot;[^\\d]&quot;, &quot;&quot;);</span>
<span class="fc" id="L1304">                return Double.parseDouble(amount);</span>
            })
<span class="fc" id="L1306">            .sum();</span>
        
<span class="fc" id="L1308">        totalOrdersLabel.setText(String.valueOf(totalOrders) + &quot; سفارش&quot;);</span>
<span class="fc" id="L1309">        totalSpentLabel.setText(String.format(&quot;%,.0f تومان&quot;, totalSpent));</span>
<span class="fc" id="L1310">    }</span>

    /**
     * تولید رسید
     */
    private String generateReceipt(OrderHistoryItem order) {
<span class="fc" id="L1316">        StringBuilder receipt = new StringBuilder();</span>
<span class="fc" id="L1317">        receipt.append(&quot;=================================\n&quot;);</span>
<span class="fc" id="L1318">        receipt.append(&quot;          رسید سفارش\n&quot;);</span>
<span class="fc" id="L1319">        receipt.append(&quot;=================================\n&quot;);</span>
<span class="fc" id="L1320">        receipt.append(&quot;شماره سفارش: &quot;).append(order.getOrderId()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1321">        receipt.append(&quot;تاریخ: &quot;).append(order.getOrderDate()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1322">        receipt.append(&quot;رستوران: &quot;).append(order.getRestaurantName()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1323">        receipt.append(&quot;---------------------------------\n&quot;);</span>
        
<span class="pc bpc" id="L1325" title="1 of 2 branches missed.">        if (order.getItems() != null) {</span>
<span class="nc bnc" id="L1326" title="All 2 branches missed.">            for (String item : order.getItems()) {</span>
<span class="nc" id="L1327">                receipt.append(item).append(&quot;\n&quot;);</span>
<span class="nc" id="L1328">            }</span>
        }
        
<span class="fc" id="L1331">        receipt.append(&quot;---------------------------------\n&quot;);</span>
<span class="fc" id="L1332">        receipt.append(&quot;مبلغ کل: &quot;).append(order.getTotalAmount()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1333">        receipt.append(&quot;وضعیت: &quot;).append(order.getStatus()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1334">        receipt.append(&quot;=================================\n&quot;);</span>
        
<span class="fc" id="L1336">        return receipt.toString();</span>
    }

    /**
     * پردازش آیتم‌های سفارش از JSON
     */
    private List&lt;String&gt; parseOrderItems(JsonNode itemsNode) {
<span class="nc" id="L1343">        List&lt;String&gt; items = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L1344" title="All 4 branches missed.">        if (itemsNode != null &amp;&amp; itemsNode.isArray()) {</span>
<span class="nc bnc" id="L1345" title="All 2 branches missed.">            for (JsonNode item : itemsNode) {</span>
<span class="nc" id="L1346">                String itemStr = item.get(&quot;name&quot;).asText() + &quot; x&quot; + </span>
<span class="nc" id="L1347">                               item.get(&quot;quantity&quot;).asInt() + &quot; - &quot; +</span>
<span class="nc" id="L1348">                               String.format(&quot;%,.0f تومان&quot;, item.get(&quot;price&quot;).asDouble());</span>
<span class="nc" id="L1349">                items.add(itemStr);</span>
<span class="nc" id="L1350">            }</span>
        }
<span class="nc" id="L1352">        return items;</span>
    }

    /**
     * دریافت متن فارسی نقش کاربری
     */
    private String getRoleText(String role) {
<span class="nc bnc" id="L1359" title="All 5 branches missed.">        switch (role.toUpperCase()) {</span>
<span class="nc" id="L1360">            case &quot;BUYER&quot;: return &quot;خریدار&quot;;</span>
<span class="nc" id="L1361">            case &quot;SELLER&quot;: return &quot;فروشنده&quot;;</span>
<span class="nc" id="L1362">            case &quot;COURIER&quot;: return &quot;پیک&quot;;</span>
<span class="nc" id="L1363">            case &quot;ADMIN&quot;: return &quot;مدیر&quot;;</span>
<span class="nc" id="L1364">            default: return role;</span>
        }
    }

    /**
     * دریافت متن فارسی وضعیت سفارش
     */
    private String getOrderStatusText(String status) {
<span class="nc bnc" id="L1372" title="All 7 branches missed.">        switch (status.toUpperCase()) {</span>
<span class="nc" id="L1373">            case &quot;PENDING&quot;: return &quot;در انتظار&quot;;</span>
<span class="nc" id="L1374">            case &quot;PREPARING&quot;: return &quot;در حال آماده‌سازی&quot;;</span>
<span class="nc" id="L1375">            case &quot;READY&quot;: return &quot;آماده ارسال&quot;;</span>
<span class="nc" id="L1376">            case &quot;DELIVERING&quot;: return &quot;در حال ارسال&quot;;</span>
<span class="nc" id="L1377">            case &quot;DELIVERED&quot;: return &quot;تحویل داده شده&quot;;</span>
<span class="nc" id="L1378">            case &quot;CANCELLED&quot;: return &quot;لغو شده&quot;;</span>
<span class="nc" id="L1379">            default: return status;</span>
        }
    }

    /**
     * دریافت متن فارسی نوع تراکنش
     */
    private String getTransactionTypeText(String type) {
<span class="nc bnc" id="L1387" title="All 5 branches missed.">        switch (type.toUpperCase()) {</span>
<span class="nc" id="L1388">            case &quot;DEPOSIT&quot;: return &quot;واریز&quot;;</span>
<span class="nc" id="L1389">            case &quot;WITHDRAWAL&quot;: return &quot;برداشت&quot;;</span>
<span class="nc" id="L1390">            case &quot;PAYMENT&quot;: return &quot;پرداخت سفارش&quot;;</span>
<span class="nc" id="L1391">            case &quot;REFUND&quot;: return &quot;بازگشت وجه&quot;;</span>
<span class="nc" id="L1392">            default: return type;</span>
        }
    }

    /**
     * فرمت تاریخ
     */
    private String formatDate(String dateStr) {
        try {
<span class="nc" id="L1401">            LocalDate date = LocalDate.parse(dateStr.substring(0, 10));</span>
<span class="nc" id="L1402">            return date.format(DateTimeFormatter.ofPattern(&quot;yyyy/MM/dd&quot;));</span>
<span class="nc" id="L1403">        } catch (Exception e) {</span>
<span class="nc" id="L1404">            return dateStr;</span>
        }
    }

    /**
     * فرمت تاریخ و زمان
     */
    private String formatDateTime(String dateTimeStr) {
        try {
<span class="nc" id="L1413">            LocalDateTime dateTime = LocalDateTime.parse(dateTimeStr.substring(0, 19));</span>
<span class="nc" id="L1414">            return dateTime.format(DateTimeFormatter.ofPattern(&quot;yyyy/MM/dd HH:mm&quot;));</span>
<span class="nc" id="L1415">        } catch (Exception e) {</span>
<span class="nc" id="L1416">            return dateTimeStr;</span>
        }
    }

    // ========== UI Helper Methods ==========
    
    /**
     * تنظیم حالت بارگذاری
     */
    private void setLoading(boolean loading) {
<span class="fc" id="L1426">        loadingIndicator.setVisible(loading);</span>
<span class="fc" id="L1427">        progressBar.setVisible(loading);</span>
        
        // غیرفعال کردن دکمه‌ها در حالت بارگذاری
<span class="fc" id="L1430">        saveProfileButton.setDisable(loading);</span>
<span class="fc" id="L1431">        changePasswordButton.setDisable(loading);</span>
<span class="fc" id="L1432">        saveSettingsButton.setDisable(loading);</span>
<span class="fc" id="L1433">    }</span>

    /**
     * نمایش پیام وضعیت
     */
    private void setStatus(String message) {
<span class="fc" id="L1439">        statusLabel.setText(message);</span>
<span class="fc" id="L1440">    }</span>

    /**
     * نمایش پیام خطا
     */
    private void showError(String title, String message) {
<span class="fc" id="L1446">        Alert alert = new Alert(Alert.AlertType.ERROR);</span>
<span class="fc" id="L1447">        alert.setTitle(title);</span>
<span class="fc" id="L1448">        alert.setHeaderText(null);</span>
<span class="fc" id="L1449">        alert.setContentText(message);</span>
<span class="fc" id="L1450">        alert.showAndWait();</span>
<span class="fc" id="L1451">    }</span>

    /**
     * نمایش پیام موفقیت
     */
    private void showSuccess(String title, String message) {
<span class="fc" id="L1457">        Alert alert = new Alert(Alert.AlertType.INFORMATION);</span>
<span class="fc" id="L1458">        alert.setTitle(title);</span>
<span class="fc" id="L1459">        alert.setHeaderText(null);</span>
<span class="fc" id="L1460">        alert.setContentText(message);</span>
<span class="fc" id="L1461">        alert.showAndWait();</span>
<span class="fc" id="L1462">    }</span>

    /**
     * نمایش پیام اطلاعاتی
     */
    private void showInfo(String title, String message) {
<span class="fc" id="L1468">        Alert alert = new Alert(Alert.AlertType.INFORMATION);</span>
<span class="fc" id="L1469">        alert.setTitle(title);</span>
<span class="fc" id="L1470">        alert.setHeaderText(null);</span>
<span class="fc" id="L1471">        alert.setContentText(message);</span>
<span class="fc" id="L1472">        alert.showAndWait();</span>
<span class="fc" id="L1473">    }</span>
    
    // ========== Event Handlers ==========
    
    /**
     * افزودن آدرس جدید
     */
    @FXML
    private void handleAddAddress() {
        // TODO: نمایش دیالوگ افزودن آدرس
<span class="nc" id="L1483">        showInfo(&quot;افزودن آدرس&quot;, &quot;این قابلیت در نسخه بعدی اضافه خواهد شد&quot;);</span>
<span class="nc" id="L1484">    }</span>

    /**
     * ویرایش آدرس انتخاب شده
     */
    @FXML
    private void handleEditAddress() {
<span class="nc" id="L1491">        AddressItem selected = addressListView.getSelectionModel().getSelectedItem();</span>
<span class="nc bnc" id="L1492" title="All 2 branches missed.">        if (selected != null) {</span>
            // TODO: نمایش دیالوگ ویرایش آدرس
<span class="nc" id="L1494">            showInfo(&quot;ویرایش آدرس&quot;, &quot;ویرایش آدرس: &quot; + selected.getTitle());</span>
        }
<span class="nc" id="L1496">    }</span>

    /**
     * حذف آدرس انتخاب شده
     */
    @FXML
    private void handleDeleteAddress() {
<span class="nc" id="L1503">        AddressItem selected = addressListView.getSelectionModel().getSelectedItem();</span>
<span class="nc bnc" id="L1504" title="All 2 branches missed.">        if (selected != null) {</span>
<span class="nc" id="L1505">            Alert confirmAlert = new Alert(Alert.AlertType.CONFIRMATION);</span>
<span class="nc" id="L1506">            confirmAlert.setTitle(&quot;تأیید حذف&quot;);</span>
<span class="nc" id="L1507">            confirmAlert.setHeaderText(&quot;آیا مطمئن هستید؟&quot;);</span>
<span class="nc" id="L1508">            confirmAlert.setContentText(&quot;آیا می‌خواهید آدرس \&quot;&quot; + selected.getTitle() + &quot;\&quot; را حذف کنید؟&quot;);</span>
            
<span class="nc" id="L1510">            confirmAlert.showAndWait().ifPresent(response -&gt; {</span>
<span class="nc bnc" id="L1511" title="All 2 branches missed.">                if (response == ButtonType.OK) {</span>
                    // TODO: حذف آدرس از سرور
<span class="nc" id="L1513">                    addressList.remove(selected);</span>
<span class="nc" id="L1514">                    showSuccess(&quot;موفقیت&quot;, &quot;آدرس با موفقیت حذف شد&quot;);</span>
                }
<span class="nc" id="L1516">            });</span>
        }
<span class="nc" id="L1518">    }</span>

    /**
     * حذف از علاقه‌مندی‌ها
     */
    @FXML
    void handleRemoveFavorite() {
<span class="nc" id="L1525">        FavoriteRestaurant selectedRestaurant = favoriteRestaurantsList.getSelectionModel().getSelectedItem();</span>
<span class="nc" id="L1526">        FavoriteItem selectedItem = favoriteItemsList.getSelectionModel().getSelectedItem();</span>
        
<span class="nc bnc" id="L1528" title="All 2 branches missed.">        if (selectedRestaurant != null) {</span>
            // TODO: حذف رستوران از علاقه‌مندی‌ها
<span class="nc" id="L1530">            favoriteRestaurants.remove(selectedRestaurant);</span>
<span class="nc" id="L1531">            showSuccess(&quot;موفقیت&quot;, &quot;رستوران از علاقه‌مندی‌ها حذف شد&quot;);</span>
<span class="nc bnc" id="L1532" title="All 2 branches missed.">        } else if (selectedItem != null) {</span>
            // TODO: حذف آیتم از علاقه‌مندی‌ها
<span class="nc" id="L1534">            favoriteItems.remove(selectedItem);</span>
<span class="nc" id="L1535">            showSuccess(&quot;موفقیت&quot;, &quot;آیتم از علاقه‌مندی‌ها حذف شد&quot;);</span>
        }
<span class="nc" id="L1537">    }</span>

    /**
     * سفارش مجدد آیتم مورد علاقه
     */
    @FXML
    private void handleReorderFavorite() {
<span class="nc" id="L1544">        FavoriteItem selected = favoriteItemsList.getSelectionModel().getSelectedItem();</span>
<span class="nc bnc" id="L1545" title="All 2 branches missed.">        if (selected != null) {</span>
            // TODO: افزودن به سبد خرید
<span class="nc" id="L1547">            showSuccess(&quot;موفقیت&quot;, &quot;آیتم \&quot;&quot; + selected.getName() + &quot;\&quot; به سبد خرید اضافه شد&quot;);</span>
<span class="nc" id="L1548">            navigationController.navigateTo(NavigationController.CART_SCENE);</span>
        }
<span class="nc" id="L1550">    }</span>

    /**
     * اعمال فیلتر سفارشات
     */
    @FXML
    private void handleApplyOrderFilter() {
<span class="nc" id="L1557">        filterOrders();</span>
<span class="nc" id="L1558">        setStatus(&quot;فیلترها اعمال شد&quot;);</span>
<span class="nc" id="L1559">    }</span>

    /**
     * پاک کردن فیلتر سفارشات
     */
    @FXML
    private void handleClearOrderFilter() {
<span class="nc" id="L1566">        orderSearchField.clear();</span>
<span class="nc" id="L1567">        orderStatusFilter.setValue(&quot;همه&quot;);</span>
<span class="nc" id="L1568">        orderStartDate.setValue(LocalDate.now().minusMonths(1));</span>
<span class="nc" id="L1569">        orderEndDate.setValue(LocalDate.now());</span>
<span class="nc" id="L1570">        ordersTable.setItems(ordersList);</span>
<span class="nc" id="L1571">        setStatus(&quot;فیلترها پاک شد&quot;);</span>
<span class="nc" id="L1572">    }</span>

    /**
     * دانلود گزارش تراکنش‌ها
     */
    @FXML
    void handleDownloadTransactionReport() {
        try {
<span class="fc" id="L1580">            String report = generateTransactionReport();</span>
<span class="fc" id="L1581">            File file = new File(&quot;transaction_report_&quot; + LocalDate.now() + &quot;.txt&quot;);</span>
            
<span class="fc" id="L1583">            try (FileWriter writer = new FileWriter(file)) {</span>
<span class="fc" id="L1584">                writer.write(report);</span>
            }
            
<span class="fc" id="L1587">            showSuccess(&quot;موفقیت&quot;, &quot;گزارش در فایل &quot; + file.getName() + &quot; ذخیره شد&quot;);</span>
<span class="nc" id="L1588">        } catch (IOException e) {</span>
<span class="nc" id="L1589">            showError(&quot;خطا&quot;, &quot;خطا در ذخیره گزارش: &quot; + e.getMessage());</span>
<span class="fc" id="L1590">        }</span>
<span class="fc" id="L1591">    }</span>

    /**
     * بازنشانی تنظیمات
     */
    @FXML
    void handleResetSettings() {
<span class="nc" id="L1598">        Alert confirmAlert = new Alert(Alert.AlertType.CONFIRMATION);</span>
<span class="nc" id="L1599">        confirmAlert.setTitle(&quot;تأیید بازنشانی&quot;);</span>
<span class="nc" id="L1600">        confirmAlert.setHeaderText(&quot;آیا مطمئن هستید؟&quot;);</span>
<span class="nc" id="L1601">        confirmAlert.setContentText(&quot;تمام تنظیمات به حالت پیش‌فرض بازگردانده خواهند شد.&quot;);</span>
        
<span class="nc" id="L1603">        confirmAlert.showAndWait().ifPresent(response -&gt; {</span>
<span class="nc bnc" id="L1604" title="All 2 branches missed.">            if (response == ButtonType.OK) {</span>
<span class="nc" id="L1605">                emailNotificationCheckBox.setSelected(true);</span>
<span class="nc" id="L1606">                smsNotificationCheckBox.setSelected(false);</span>
<span class="nc" id="L1607">                pushNotificationCheckBox.setSelected(true);</span>
<span class="nc" id="L1608">                languageComboBox.setValue(&quot;فارسی&quot;);</span>
<span class="nc" id="L1609">                themeComboBox.setValue(&quot;روشن&quot;);</span>
<span class="nc" id="L1610">                shareDataCheckBox.setSelected(false);</span>
<span class="nc" id="L1611">                showProfileCheckBox.setSelected(true);</span>
<span class="nc" id="L1612">                showSuccess(&quot;موفقیت&quot;, &quot;تنظیمات به حالت پیش‌فرض بازگردانده شد&quot;);</span>
            }
<span class="nc" id="L1614">        });</span>
<span class="nc" id="L1615">    }</span>

    /**
     * تولید گزارش تراکنش‌ها
     */
    private String generateTransactionReport() {
<span class="fc" id="L1621">        StringBuilder report = new StringBuilder();</span>
<span class="fc" id="L1622">        report.append(&quot;=====================================\n&quot;);</span>
<span class="fc" id="L1623">        report.append(&quot;        گزارش تراکنش‌های مالی\n&quot;);</span>
<span class="fc" id="L1624">        report.append(&quot;=====================================\n&quot;);</span>
<span class="fc" id="L1625">        report.append(&quot;تاریخ گزارش: &quot;).append(LocalDate.now()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1626">        report.append(&quot;تعداد تراکنش‌ها: &quot;).append(transactionsList.size()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1627">        report.append(&quot;-------------------------------------\n\n&quot;);</span>
        
<span class="fc bfc" id="L1629" title="All 2 branches covered.">        for (TransactionItem trans : transactionsList) {</span>
<span class="fc" id="L1630">            report.append(&quot;شماره تراکنش: &quot;).append(trans.getTransactionId()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1631">            report.append(&quot;تاریخ: &quot;).append(trans.getDate()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1632">            report.append(&quot;نوع: &quot;).append(trans.getType()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1633">            report.append(&quot;مبلغ: &quot;).append(trans.getAmount()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1634">            report.append(&quot;توضیحات: &quot;).append(trans.getDescription()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1635">            report.append(&quot;موجودی پس از تراکنش: &quot;).append(trans.getBalanceAfter()).append(&quot;\n&quot;);</span>
<span class="fc" id="L1636">            report.append(&quot;-------------------------------------\n&quot;);</span>
<span class="fc" id="L1637">        }</span>
        
<span class="fc" id="L1639">        return report.toString();</span>
    }

    // ========== Inner Classes ==========
    
    /**
     * کلاس مدل پروفایل کاربر
     */
<span class="nc" id="L1647">    public static class UserProfile {</span>
        private Long id;
        private String fullName;
        private String phone;
        private String email;
        private String role;
        private boolean active;
        private double walletBalance;
        private String createdAt;

        // Getters and Setters
<span class="nc" id="L1658">        public Long getId() { return id; }</span>
<span class="nc" id="L1659">        public void setId(Long id) { this.id = id; }</span>
        
<span class="nc" id="L1661">        public String getFullName() { return fullName; }</span>
<span class="nc" id="L1662">        public void setFullName(String fullName) { this.fullName = fullName; }</span>
        
<span class="nc" id="L1664">        public String getPhone() { return phone; }</span>
<span class="nc" id="L1665">        public void setPhone(String phone) { this.phone = phone; }</span>
        
<span class="nc" id="L1667">        public String getEmail() { return email; }</span>
<span class="nc" id="L1668">        public void setEmail(String email) { this.email = email; }</span>
        
<span class="nc" id="L1670">        public String getRole() { return role; }</span>
<span class="nc" id="L1671">        public void setRole(String role) { this.role = role; }</span>
        
<span class="nc" id="L1673">        public boolean isActive() { return active; }</span>
<span class="nc" id="L1674">        public void setActive(boolean active) { this.active = active; }</span>
        
<span class="nc" id="L1676">        public double getWalletBalance() { return walletBalance; }</span>
<span class="nc" id="L1677">        public void setWalletBalance(double walletBalance) { this.walletBalance = walletBalance; }</span>
        
<span class="nc" id="L1679">        public String getCreatedAt() { return createdAt; }</span>
<span class="nc" id="L1680">        public void setCreatedAt(String createdAt) { this.createdAt = createdAt; }</span>
    }

    /**
     * کلاس مدل آیتم آدرس
     */
<span class="fc" id="L1686">    public static class AddressItem {</span>
        private Long id;
        private String title;
        private String address;
        private boolean isDefault;

        // Getters and Setters
<span class="nc" id="L1693">        public Long getId() { return id; }</span>
<span class="fc" id="L1694">        public void setId(Long id) { this.id = id; }</span>
        
<span class="nc" id="L1696">        public String getTitle() { return title; }</span>
<span class="fc" id="L1697">        public void setTitle(String title) { this.title = title; }</span>
        
<span class="nc" id="L1699">        public String getAddress() { return address; }</span>
<span class="fc" id="L1700">        public void setAddress(String address) { this.address = address; }</span>
        
<span class="nc" id="L1702">        public boolean isDefault() { return isDefault; }</span>
<span class="fc" id="L1703">        public void setDefault(boolean isDefault) { this.isDefault = isDefault; }</span>
        
        @Override
        public String toString() {
<span class="nc bnc" id="L1707" title="All 2 branches missed.">            return title + (isDefault ? &quot; (پیش‌فرض)&quot; : &quot;&quot;) + &quot;\n&quot; + address;</span>
        }
    }

    /**
     * کلاس مدل آیتم تاریخچه سفارش
     */
<span class="fc" id="L1714">    public static class OrderHistoryItem {</span>
        private String orderId;
        private String orderDate;
        private String restaurantName;
        private String totalAmount;
        private String status;
        private List&lt;String&gt; items;

        // Getters and Setters
<span class="fc" id="L1723">        public String getOrderId() { return orderId; }</span>
<span class="fc" id="L1724">        public void setOrderId(String orderId) { this.orderId = orderId; }</span>
        
<span class="fc" id="L1726">        public String getOrderDate() { return orderDate; }</span>
<span class="fc" id="L1727">        public void setOrderDate(String orderDate) { this.orderDate = orderDate; }</span>
        
<span class="fc" id="L1729">        public String getRestaurantName() { return restaurantName; }</span>
<span class="fc" id="L1730">        public void setRestaurantName(String restaurantName) { this.restaurantName = restaurantName; }</span>
        
<span class="fc" id="L1732">        public String getTotalAmount() { return totalAmount; }</span>
<span class="fc" id="L1733">        public void setTotalAmount(String totalAmount) { this.totalAmount = totalAmount; }</span>
        
<span class="fc" id="L1735">        public String getStatus() { return status; }</span>
<span class="fc" id="L1736">        public void setStatus(String status) { this.status = status; }</span>
        
<span class="fc" id="L1738">        public List&lt;String&gt; getItems() { return items; }</span>
<span class="nc" id="L1739">        public void setItems(List&lt;String&gt; items) { this.items = items; }</span>
    }

    /**
     * کلاس مدل آیتم تراکنش
     */
<span class="fc" id="L1745">    public static class TransactionItem {</span>
        private String transactionId;
        private String date;
        private String type;
        private String amount;
        private String description;
        private String balanceAfter;

        // Getters and Setters
<span class="fc" id="L1754">        public String getTransactionId() { return transactionId; }</span>
<span class="fc" id="L1755">        public void setTransactionId(String transactionId) { this.transactionId = transactionId; }</span>
        
<span class="fc" id="L1757">        public String getDate() { return date; }</span>
<span class="fc" id="L1758">        public void setDate(String date) { this.date = date; }</span>
        
<span class="fc" id="L1760">        public String getType() { return type; }</span>
<span class="fc" id="L1761">        public void setType(String type) { this.type = type; }</span>
        
<span class="fc" id="L1763">        public String getAmount() { return amount; }</span>
<span class="fc" id="L1764">        public void setAmount(String amount) { this.amount = amount; }</span>
        
<span class="fc" id="L1766">        public String getDescription() { return description; }</span>
<span class="fc" id="L1767">        public void setDescription(String description) { this.description = description; }</span>
        
<span class="fc" id="L1769">        public String getBalanceAfter() { return balanceAfter; }</span>
<span class="fc" id="L1770">        public void setBalanceAfter(String balanceAfter) { this.balanceAfter = balanceAfter; }</span>
    }

    /**
     * کلاس مدل رستوران مورد علاقه
     */
<span class="fc" id="L1776">    public static class FavoriteRestaurant {</span>
        private Long id;
        private Long restaurantId;
        private String name;
        private double rating;
        private int orderCount;

        // Getters and Setters
<span class="nc" id="L1784">        public Long getId() { return id; }</span>
<span class="fc" id="L1785">        public void setId(Long id) { this.id = id; }</span>
        
<span class="nc" id="L1787">        public Long getRestaurantId() { return restaurantId; }</span>
<span class="nc" id="L1788">        public void setRestaurantId(Long restaurantId) { this.restaurantId = restaurantId; }</span>
        
<span class="nc" id="L1790">        public String getName() { return name; }</span>
<span class="fc" id="L1791">        public void setName(String name) { this.name = name; }</span>
        
<span class="nc" id="L1793">        public double getRating() { return rating; }</span>
<span class="fc" id="L1794">        public void setRating(double rating) { this.rating = rating; }</span>
        
<span class="nc" id="L1796">        public int getOrderCount() { return orderCount; }</span>
<span class="fc" id="L1797">        public void setOrderCount(int orderCount) { this.orderCount = orderCount; }</span>
        
        @Override
        public String toString() {
<span class="nc" id="L1801">            return name + &quot; (&quot; + rating + &quot; ⭐) - &quot; + orderCount + &quot; سفارش&quot;;</span>
        }
    }

    /**
     * کلاس مدل آیتم مورد علاقه
     */
<span class="fc" id="L1808">    public static class FavoriteItem {</span>
        private Long id;
        private Long itemId;
        private String name;
        private String restaurantName;
        private double price;

        // Getters and Setters
<span class="nc" id="L1816">        public Long getId() { return id; }</span>
<span class="fc" id="L1817">        public void setId(Long id) { this.id = id; }</span>
        
<span class="nc" id="L1819">        public Long getItemId() { return itemId; }</span>
<span class="nc" id="L1820">        public void setItemId(Long itemId) { this.itemId = itemId; }</span>
        
<span class="nc" id="L1822">        public String getName() { return name; }</span>
<span class="fc" id="L1823">        public void setName(String name) { this.name = name; }</span>
        
<span class="nc" id="L1825">        public String getRestaurantName() { return restaurantName; }</span>
<span class="fc" id="L1826">        public void setRestaurantName(String restaurantName) { this.restaurantName = restaurantName; }</span>
        
<span class="nc" id="L1828">        public double getPrice() { return price; }</span>
<span class="fc" id="L1829">        public void setPrice(double price) { this.price = price; }</span>
        
        @Override
        public String toString() {
<span class="nc" id="L1833">            return name + &quot; - &quot; + restaurantName + &quot; (&quot; + String.format(&quot;%,.0f تومان&quot;, price) + &quot;)&quot;;</span>
        }
    }

    /**
     * کلاس مدل تنظیمات کاربر
     */
<span class="fc" id="L1840">    public static class UserSettings {</span>
<span class="fc" id="L1841">        private boolean emailNotifications = true;</span>
<span class="fc" id="L1842">        private boolean smsNotifications = false;</span>
<span class="fc" id="L1843">        private boolean pushNotifications = true;</span>
<span class="fc" id="L1844">        private String language = &quot;فارسی&quot;;</span>
<span class="fc" id="L1845">        private String theme = &quot;روشن&quot;;</span>
<span class="fc" id="L1846">        private boolean shareData = false;</span>
<span class="fc" id="L1847">        private boolean showProfile = true;</span>

        // Getters and Setters
<span class="fc" id="L1850">        public boolean isEmailNotifications() { return emailNotifications; }</span>
<span class="nc" id="L1851">        public void setEmailNotifications(boolean emailNotifications) { this.emailNotifications = emailNotifications; }</span>
        
<span class="fc" id="L1853">        public boolean isSmsNotifications() { return smsNotifications; }</span>
<span class="nc" id="L1854">        public void setSmsNotifications(boolean smsNotifications) { this.smsNotifications = smsNotifications; }</span>
        
<span class="fc" id="L1856">        public boolean isPushNotifications() { return pushNotifications; }</span>
<span class="nc" id="L1857">        public void setPushNotifications(boolean pushNotifications) { this.pushNotifications = pushNotifications; }</span>
        
<span class="fc" id="L1859">        public String getLanguage() { return language; }</span>
<span class="nc" id="L1860">        public void setLanguage(String language) { this.language = language; }</span>
        
<span class="fc" id="L1862">        public String getTheme() { return theme; }</span>
<span class="nc" id="L1863">        public void setTheme(String theme) { this.theme = theme; }</span>
        
<span class="fc" id="L1865">        public boolean isShareData() { return shareData; }</span>
<span class="nc" id="L1866">        public void setShareData(boolean shareData) { this.shareData = shareData; }</span>
        
<span class="fc" id="L1868">        public boolean isShowProfile() { return showProfile; }</span>
<span class="nc" id="L1869">        public void setShowProfile(boolean showProfile) { this.showProfile = showProfile; }</span>
    }

    /**
     * کلاس مدل آمار کاربر
     */
<span class="nc" id="L1875">    public static class UserAnalytics {</span>
        private int totalOrders;
        private double totalSpent;
        private double averageOrderValue;
        private String topRestaurant;
        private String topFoodItem;
        private Map&lt;String, Integer&gt; orderDistribution;
        private Map&lt;String, Double&gt; monthlySpending;

        // Getters and Setters
<span class="nc" id="L1885">        public int getTotalOrders() { return totalOrders; }</span>
<span class="nc" id="L1886">        public void setTotalOrders(int totalOrders) { this.totalOrders = totalOrders; }</span>
        
<span class="nc" id="L1888">        public double getTotalSpent() { return totalSpent; }</span>
<span class="nc" id="L1889">        public void setTotalSpent(double totalSpent) { this.totalSpent = totalSpent; }</span>
        
<span class="nc" id="L1891">        public double getAverageOrderValue() { return averageOrderValue; }</span>
<span class="nc" id="L1892">        public void setAverageOrderValue(double averageOrderValue) { this.averageOrderValue = averageOrderValue; }</span>
        
<span class="nc" id="L1894">        public String getTopRestaurant() { return topRestaurant; }</span>
<span class="nc" id="L1895">        public void setTopRestaurant(String topRestaurant) { this.topRestaurant = topRestaurant; }</span>
        
<span class="nc" id="L1897">        public String getTopFoodItem() { return topFoodItem; }</span>
<span class="nc" id="L1898">        public void setTopFoodItem(String topFoodItem) { this.topFoodItem = topFoodItem; }</span>
        
<span class="nc" id="L1900">        public Map&lt;String, Integer&gt; getOrderDistribution() { return orderDistribution; }</span>
<span class="nc" id="L1901">        public void setOrderDistribution(Map&lt;String, Integer&gt; orderDistribution) { this.orderDistribution = orderDistribution; }</span>
        
<span class="nc" id="L1903">        public Map&lt;String, Double&gt; getMonthlySpending() { return monthlySpending; }</span>
<span class="nc" id="L1904">        public void setMonthlySpending(Map&lt;String, Double&gt; monthlySpending) { this.monthlySpending = monthlySpending; }</span>
    }
} 
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>