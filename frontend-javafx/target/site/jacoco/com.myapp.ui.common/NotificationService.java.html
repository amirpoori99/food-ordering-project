<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NotificationService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">food-ordering-frontend</a> &gt; <a href="index.source.html" class="el_package">com.myapp.ui.common</a> &gt; <span class="el_source">NotificationService.java</span></div><h1>NotificationService.java</h1><pre class="source lang-java linenums">package com.myapp.ui.common;

import javafx.application.Platform;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.control.Alert;
import javafx.scene.control.ButtonType;
import javafx.scene.control.Label;
import javafx.scene.layout.Background;
import javafx.scene.layout.BackgroundFill;
import javafx.scene.layout.CornerRadii;
import javafx.scene.layout.HBox;
import javafx.scene.paint.Color;
import javafx.stage.Popup;
import javafx.stage.Stage;
import javafx.util.Duration;

import java.util.Optional;
import java.util.concurrent.CompletableFuture;

/**
 * سرویس مدیریت اعلان‌ها و پیام‌های سیستم
 * 
 * این کلاس مسئول نمایش انواع مختلف اعلان‌ها و پیام‌ها شامل:
 * - اعلان‌های Toast (پیام‌های کوتاه موقت)
 * - Dialog های تأیید
 * - پیام‌های خطا، موفقیت، هشدار و اطلاعات
 * - اعلان‌های پیشرفته با انیمیشن
 * - مدیریت موقعیت نمایش
 * 
 * Pattern های استفاده شده:
 * - Singleton Pattern: یک instance در کل برنامه
 * - Builder Pattern: برای ساخت notification های پیچیده
 * - Observer Pattern: برای callback ها
 * - Factory Pattern: برای انواع مختلف notification
 * 
 * @author Food Ordering System Team
 * @version 1.0
 * @since 2024
 */
public class NotificationService {
    
    /** instance singleton */
    private static NotificationService instance;
    
    /** Stage اصلی برنامه برای محاسبه موقعیت */
    private Stage primaryStage;
    
    /**
     * سازنده private برای پیاده‌سازی Singleton
     */
    private NotificationService() {}
    
    /**
     * دریافت instance singleton
     * 
     * @return instance NotificationService
     */
    public static NotificationService getInstance() {
<span class="nc bnc" id="L60" title="All 2 branches missed.">        if (instance == null) {</span>
<span class="nc" id="L61">            instance = new NotificationService();</span>
        }
<span class="nc" id="L63">        return instance;</span>
    }
    
    /**
     * مقداردهی اولیه NotificationService
     * 
     * @param primaryStage Stage اصلی برنامه
     */
    public void initialize(Stage primaryStage) {
<span class="nc" id="L72">        this.primaryStage = primaryStage;</span>
<span class="nc" id="L73">    }</span>
    
    // ==================== TOAST NOTIFICATIONS ====================
    
    /**
     * نمایش اعلان Toast با نوع موفقیت
     * 
     * @param message متن پیام
     */
    public void showSuccess(String message) {
<span class="nc" id="L83">        showToast(message, NotificationType.SUCCESS, Duration.seconds(3));</span>
<span class="nc" id="L84">    }</span>
    
    /**
     * نمایش اعلان Toast با نوع خطا
     * 
     * @param message متن پیام
     */
    public void showError(String message) {
<span class="nc" id="L92">        showToast(message, NotificationType.ERROR, Duration.seconds(5));</span>
<span class="nc" id="L93">    }</span>
    
    /**
     * نمایش اعلان Toast با نوع هشدار
     * 
     * @param message متن پیام
     */
    public void showWarning(String message) {
<span class="nc" id="L101">        showToast(message, NotificationType.WARNING, Duration.seconds(4));</span>
<span class="nc" id="L102">    }</span>
    
    /**
     * نمایش اعلان Toast با نوع اطلاعات
     * 
     * @param message متن پیام
     */
    public void showInfo(String message) {
<span class="nc" id="L110">        showToast(message, NotificationType.INFO, Duration.seconds(3));</span>
<span class="nc" id="L111">    }</span>
    
    /**
     * نمایش اعلان Toast با پارامترهای کامل
     * 
     * @param message متن پیام
     * @param type نوع اعلان
     * @param duration مدت زمان نمایش
     */
    public void showToast(String message, NotificationType type, Duration duration) {
<span class="nc bnc" id="L121" title="All 2 branches missed.">        if (!Platform.isFxApplicationThread()) {</span>
<span class="nc" id="L122">            Platform.runLater(() -&gt; showToast(message, type, duration));</span>
<span class="nc" id="L123">            return;</span>
        }
        
        // ایجاد Toast UI
<span class="nc" id="L127">        Label toastLabel = createToastLabel(message, type);</span>
<span class="nc" id="L128">        HBox toastContainer = new HBox(toastLabel);</span>
<span class="nc" id="L129">        toastContainer.setAlignment(Pos.CENTER);</span>
<span class="nc" id="L130">        toastContainer.setPadding(new Insets(10, 20, 10, 20));</span>
<span class="nc" id="L131">        toastContainer.setBackground(new Background(new BackgroundFill(</span>
<span class="nc" id="L132">            getBackgroundColor(type), </span>
<span class="nc" id="L133">            new CornerRadii(5), </span>
<span class="nc" id="L134">            Insets.EMPTY</span>
        )));
        
        // ایجاد Popup
<span class="nc" id="L138">        Popup popup = new Popup();</span>
<span class="nc" id="L139">        popup.getContent().add(toastContainer);</span>
<span class="nc" id="L140">        popup.setAutoHide(true);</span>
<span class="nc" id="L141">        popup.setHideOnEscape(true);</span>
        
        // محاسبه موقعیت نمایش
<span class="nc bnc" id="L144" title="All 2 branches missed.">        if (primaryStage != null) {</span>
<span class="nc" id="L145">            double x = primaryStage.getX() + primaryStage.getWidth() - 350;</span>
<span class="nc" id="L146">            double y = primaryStage.getY() + 50;</span>
<span class="nc" id="L147">            popup.show(primaryStage, x, y);</span>
<span class="nc" id="L148">        } else {</span>
<span class="nc" id="L149">            popup.show(null);</span>
        }
        
        // بستن خودکار بعد از مدت زمان مشخص
<span class="nc" id="L153">        CompletableFuture.delayedExecutor((long) duration.toMillis(), </span>
<span class="nc" id="L154">            java.util.concurrent.TimeUnit.MILLISECONDS)</span>
<span class="nc" id="L155">            .execute(() -&gt; Platform.runLater(popup::hide));</span>
<span class="nc" id="L156">    }</span>
    
    /**
     * ایجاد Label برای Toast
     * 
     * @param message متن پیام
     * @param type نوع اعلان
     * @return Label آماده نمایش
     */
    private Label createToastLabel(String message, NotificationType type) {
<span class="nc" id="L166">        Label label = new Label(message);</span>
<span class="nc" id="L167">        label.setTextFill(Color.WHITE);</span>
<span class="nc" id="L168">        label.setStyle(&quot;-fx-font-size: 14px; -fx-font-weight: bold;&quot;);</span>
<span class="nc" id="L169">        label.setMaxWidth(300);</span>
<span class="nc" id="L170">        label.setWrapText(true);</span>
<span class="nc" id="L171">        return label;</span>
    }
    
    /**
     * دریافت رنگ پس‌زمینه بر اساس نوع اعلان
     * 
     * @param type نوع اعلان
     * @return رنگ پس‌زمینه
     */
    private Color getBackgroundColor(NotificationType type) {
<span class="nc bnc" id="L181" title="All 5 branches missed.">        switch (type) {</span>
<span class="nc" id="L182">            case SUCCESS: return Color.web(&quot;#28a745&quot;);</span>
<span class="nc" id="L183">            case ERROR: return Color.web(&quot;#dc3545&quot;);</span>
<span class="nc" id="L184">            case WARNING: return Color.web(&quot;#ffc107&quot;);</span>
<span class="nc" id="L185">            case INFO: return Color.web(&quot;#17a2b8&quot;);</span>
<span class="nc" id="L186">            default: return Color.web(&quot;#6c757d&quot;);</span>
        }
    }
    
    // ==================== DIALOG NOTIFICATIONS ====================
    
    /**
     * نمایش dialog اطلاعات
     * 
     * @param title عنوان dialog
     * @param message متن پیام
     */
    public void showInfoDialog(String title, String message) {
<span class="nc" id="L199">        Platform.runLater(() -&gt; {</span>
<span class="nc" id="L200">            Alert alert = new Alert(Alert.AlertType.INFORMATION);</span>
<span class="nc" id="L201">            alert.setTitle(title);</span>
<span class="nc" id="L202">            alert.setHeaderText(null);</span>
<span class="nc" id="L203">            alert.setContentText(message);</span>
<span class="nc" id="L204">            alert.showAndWait();</span>
<span class="nc" id="L205">        });</span>
<span class="nc" id="L206">    }</span>
    
    /**
     * نمایش dialog خطا
     * 
     * @param title عنوان dialog
     * @param message متن پیام خطا
     */
    public void showErrorDialog(String title, String message) {
<span class="nc" id="L215">        Platform.runLater(() -&gt; {</span>
<span class="nc" id="L216">            Alert alert = new Alert(Alert.AlertType.ERROR);</span>
<span class="nc" id="L217">            alert.setTitle(title);</span>
<span class="nc" id="L218">            alert.setHeaderText(null);</span>
<span class="nc" id="L219">            alert.setContentText(message);</span>
<span class="nc" id="L220">            alert.showAndWait();</span>
<span class="nc" id="L221">        });</span>
<span class="nc" id="L222">    }</span>
    
    /**
     * نمایش dialog هشدار
     * 
     * @param title عنوان dialog
     * @param message متن پیام هشدار
     */
    public void showWarningDialog(String title, String message) {
<span class="nc" id="L231">        Platform.runLater(() -&gt; {</span>
<span class="nc" id="L232">            Alert alert = new Alert(Alert.AlertType.WARNING);</span>
<span class="nc" id="L233">            alert.setTitle(title);</span>
<span class="nc" id="L234">            alert.setHeaderText(null);</span>
<span class="nc" id="L235">            alert.setContentText(message);</span>
<span class="nc" id="L236">            alert.showAndWait();</span>
<span class="nc" id="L237">        });</span>
<span class="nc" id="L238">    }</span>
    
    /**
     * نمایش dialog تأیید و دریافت پاسخ کاربر
     * 
     * @param title عنوان dialog
     * @param message متن پیام
     * @return CompletableFuture&lt;Boolean&gt; که true برای تأیید و false برای لغو
     */
    public CompletableFuture&lt;Boolean&gt; showConfirmDialog(String title, String message) {
<span class="nc" id="L248">        CompletableFuture&lt;Boolean&gt; future = new CompletableFuture&lt;&gt;();</span>
        
<span class="nc" id="L250">        Platform.runLater(() -&gt; {</span>
<span class="nc" id="L251">            Alert alert = new Alert(Alert.AlertType.CONFIRMATION);</span>
<span class="nc" id="L252">            alert.setTitle(title);</span>
<span class="nc" id="L253">            alert.setHeaderText(null);</span>
<span class="nc" id="L254">            alert.setContentText(message);</span>
<span class="nc" id="L255">            alert.getButtonTypes().setAll(ButtonType.YES, ButtonType.NO);</span>
            
<span class="nc" id="L257">            Optional&lt;ButtonType&gt; result = alert.showAndWait();</span>
<span class="nc bnc" id="L258" title="All 4 branches missed.">            future.complete(result.isPresent() &amp;&amp; result.get() == ButtonType.YES);</span>
<span class="nc" id="L259">        });</span>
        
<span class="nc" id="L261">        return future;</span>
    }
    
    /**
     * نمایش dialog تأیید برای خروج
     * 
     * @return CompletableFuture&lt;Boolean&gt; که true برای تأیید خروج
     */
    public CompletableFuture&lt;Boolean&gt; showLogoutConfirm() {
<span class="nc" id="L270">        return showConfirmDialog(&quot;تأیید خروج&quot;, </span>
<span class="nc" id="L271">            &quot;آیا مطمئن هستید که می‌خواهید از حساب کاربری خود خارج شوید؟&quot;);</span>
    }
    
    /**
     * نمایش dialog تأیید برای حذف
     * 
     * @param itemName نام آیتم برای حذف
     * @return CompletableFuture&lt;Boolean&gt; که true برای تأیید حذف
     */
    public CompletableFuture&lt;Boolean&gt; showDeleteConfirm(String itemName) {
<span class="nc" id="L281">        return showConfirmDialog(&quot;تأیید حذف&quot;, </span>
<span class="nc" id="L282">            &quot;آیا مطمئن هستید که می‌خواهید &quot; + itemName + &quot; را حذف کنید؟\n&quot; +</span>
            &quot;این عمل قابل بازگشت نیست.&quot;);
    }
    
    // ==================== UTILITY METHODS ====================
    
    /**
     * نمایش پیام در console (برای debugging)
     * 
     * @param message متن پیام
     * @param type نوع پیام
     */
    public void logMessage(String message, NotificationType type) {
<span class="nc" id="L295">        String prefix = &quot;[&quot; + type.name() + &quot;] &quot;;</span>
<span class="nc" id="L296">        System.out.println(prefix + message);</span>
<span class="nc" id="L297">    }</span>
    
    /**
     * بررسی در دسترس بودن سرویس notification
     * 
     * @return true اگر سرویس آماده استفاده باشد
     */
    public boolean isAvailable() {
<span class="nc bnc" id="L305" title="All 2 branches missed.">        return primaryStage != null;</span>
    }
    
    /**
     * ریست کردن instance singleton (برای تست)
     */
    public static void resetInstance() {
<span class="nc" id="L312">        instance = null;</span>
<span class="nc" id="L313">    }</span>
    
    // ==================== NOTIFICATION BUILDER ====================
    
    /**
     * Builder pattern برای ساخت notification های پیچیده
     */
<span class="nc" id="L320">    public static class NotificationBuilder {</span>
        private String message;
        private String title;
<span class="nc" id="L323">        private NotificationType type = NotificationType.INFO;</span>
<span class="nc" id="L324">        private Duration duration = Duration.seconds(3);</span>
<span class="nc" id="L325">        private boolean showAsDialog = false;</span>
        
        public NotificationBuilder message(String message) {
<span class="nc" id="L328">            this.message = message;</span>
<span class="nc" id="L329">            return this;</span>
        }
        
        public NotificationBuilder title(String title) {
<span class="nc" id="L333">            this.title = title;</span>
<span class="nc" id="L334">            return this;</span>
        }
        
        public NotificationBuilder type(NotificationType type) {
<span class="nc" id="L338">            this.type = type;</span>
<span class="nc" id="L339">            return this;</span>
        }
        
        public NotificationBuilder duration(Duration duration) {
<span class="nc" id="L343">            this.duration = duration;</span>
<span class="nc" id="L344">            return this;</span>
        }
        
        public NotificationBuilder asDialog() {
<span class="nc" id="L348">            this.showAsDialog = true;</span>
<span class="nc" id="L349">            return this;</span>
        }
        
        public void show() {
<span class="nc" id="L353">            NotificationService service = NotificationService.getInstance();</span>
            
<span class="nc bnc" id="L355" title="All 2 branches missed.">            if (showAsDialog) {</span>
<span class="nc bnc" id="L356" title="All 4 branches missed.">                switch (type) {</span>
                    case SUCCESS:
                    case INFO:
<span class="nc bnc" id="L359" title="All 2 branches missed.">                        service.showInfoDialog(title != null ? title : &quot;اطلاع&quot;, message);</span>
<span class="nc" id="L360">                        break;</span>
                    case ERROR:
<span class="nc bnc" id="L362" title="All 2 branches missed.">                        service.showErrorDialog(title != null ? title : &quot;خطا&quot;, message);</span>
<span class="nc" id="L363">                        break;</span>
                    case WARNING:
<span class="nc bnc" id="L365" title="All 2 branches missed.">                        service.showWarningDialog(title != null ? title : &quot;هشدار&quot;, message);</span>
                        break;
                }
<span class="nc" id="L368">            } else {</span>
<span class="nc" id="L369">                service.showToast(message, type, duration);</span>
            }
<span class="nc" id="L371">        }</span>
    }
    
    /**
     * ایجاد NotificationBuilder جدید
     * 
     * @return instance جدید NotificationBuilder
     */
    public static NotificationBuilder create() {
<span class="nc" id="L380">        return new NotificationBuilder();</span>
    }
    
    // ==================== ENUMS ====================
    
    /**
     * انواع اعلان‌های موجود
     */
<span class="nc" id="L388">    public enum NotificationType {</span>
<span class="nc" id="L389">        /** اعلان موفقیت (سبز) */</span>
<span class="nc" id="L390">        SUCCESS,</span>
        
<span class="nc" id="L392">        /** اعلان خطا (قرمز) */</span>
<span class="nc" id="L393">        ERROR,</span>
        
<span class="nc" id="L395">        /** اعلان هشدار (زرد) */</span>
<span class="nc" id="L396">        WARNING,</span>
        
<span class="nc" id="L398">        /** اعلان اطلاعات (آبی) */</span>
<span class="nc" id="L399">        INFO</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>